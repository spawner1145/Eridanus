(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[166],{23430:function(B,oe,N){"use strict";N.d(oe,{Z:function(){return Y}});var re=N(67294),J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},F=J,V=N(84089);function K(){return K=Object.assign?Object.assign.bind():function(ie){for(var R=1;R<arguments.length;R++){var I=arguments[R];for(var Z in I)Object.prototype.hasOwnProperty.call(I,Z)&&(ie[Z]=I[Z])}return ie},K.apply(this,arguments)}const ne=(ie,R)=>re.createElement(V.Z,K({},ie,{ref:R,icon:F}));var Y=re.forwardRef(ne)},24078:function(){"use strict"},25098:function(B){function oe(N){if(N===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N}B.exports=oe,B.exports.__esModule=!0,B.exports.default=B.exports},44987:function(B){function oe(re){var J,F,V,K=2;for(typeof Symbol!="undefined"&&(F=Symbol.asyncIterator,V=Symbol.iterator);K--;){if(F&&(J=re[F])!=null)return J.call(re);if(V&&(J=re[V])!=null)return new N(J.call(re));F="@@asyncIterator",V="@@iterator"}throw new TypeError("Object is not async iterable")}function N(re){function J(F){if(Object(F)!==F)return Promise.reject(new TypeError(F+" is not an object."));var V=F.done;return Promise.resolve(F.value).then(function(K){return{value:K,done:V}})}return N=function(V){this.s=V,this.n=V.next},N.prototype={s:null,n:null,next:function(){return J(this.n.apply(this.s,arguments))},return:function(V){var K=this.s.return;return K===void 0?Promise.resolve({value:V,done:!0}):J(K.apply(this.s,arguments))},throw:function(V){var K=this.s.return;return K===void 0?Promise.reject(V):J(K.apply(this.s,arguments))}},new N(re)}B.exports=oe,B.exports.__esModule=!0,B.exports.default=B.exports},42672:function(B,oe,N){var re=N(21314),J=N(21771);function F(V,K,ne){return J()?(B.exports=F=Reflect.construct.bind(),B.exports.__esModule=!0,B.exports.default=B.exports):(B.exports=F=function(Y,ie,R){var I=[null];I.push.apply(I,ie);var Z=Function.bind.apply(Y,I),Ie=new Z;return R&&re(Ie,R.prototype),Ie},B.exports.__esModule=!0,B.exports.default=B.exports),F.apply(null,arguments)}B.exports=F,B.exports.__esModule=!0,B.exports.default=B.exports},64599:function(B,oe,N){var re=N(96263);function J(F,V){var K=typeof Symbol!="undefined"&&F[Symbol.iterator]||F["@@iterator"];if(!K){if(Array.isArray(F)||(K=re(F))||V&&F&&typeof F.length=="number"){K&&(F=K);var ne=0,ae=function(){};return{s:ae,n:function(){return ne>=F.length?{done:!0}:{done:!1,value:F[ne++]}},e:function(Z){throw Z},f:ae}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Y=!0,ie=!1,R;return{s:function(){K=K.call(F)},n:function(){var Z=K.next();return Y=Z.done,Z},e:function(Z){ie=!0,R=Z},f:function(){try{!Y&&K.return!=null&&K.return()}finally{if(ie)throw R}}}}B.exports=J,B.exports.__esModule=!0,B.exports.default=B.exports},26037:function(B,oe,N){var re=N(48374),J=N(21771),F=N(73408);function V(K){var ne=J();return function(){var Y=re(K),ie;if(ne){var R=re(this).constructor;ie=Reflect.construct(Y,arguments,R)}else ie=Y.apply(this,arguments);return F(this,ie)}}B.exports=V,B.exports.__esModule=!0,B.exports.default=B.exports},28785:function(B,oe,N){var re=N(70426);function J(){return typeof Reflect!="undefined"&&Reflect.get?(B.exports=J=Reflect.get.bind(),B.exports.__esModule=!0,B.exports.default=B.exports):(B.exports=J=function(V,K,ne){var ae=re(V,K);if(ae){var Y=Object.getOwnPropertyDescriptor(ae,K);return Y.get?Y.get.call(arguments.length<3?V:ne):Y.value}},B.exports.__esModule=!0,B.exports.default=B.exports),J.apply(this,arguments)}B.exports=J,B.exports.__esModule=!0,B.exports.default=B.exports},48374:function(B){function oe(N){return B.exports=oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(J){return J.__proto__||Object.getPrototypeOf(J)},B.exports.__esModule=!0,B.exports.default=B.exports,oe(N)}B.exports=oe,B.exports.__esModule=!0,B.exports.default=B.exports},31996:function(B,oe,N){var re=N(21314);function J(F,V){if(typeof V!="function"&&V!==null)throw new TypeError("Super expression must either be null or a function");F.prototype=Object.create(V&&V.prototype,{constructor:{value:F,writable:!0,configurable:!0}}),Object.defineProperty(F,"prototype",{writable:!1}),V&&re(F,V)}B.exports=J,B.exports.__esModule=!0,B.exports.default=B.exports},15143:function(B){function oe(N){try{return Function.toString.call(N).indexOf("[native code]")!==-1}catch(re){return typeof N=="function"}}B.exports=oe,B.exports.__esModule=!0,B.exports.default=B.exports},21771:function(B){function oe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}B.exports=oe,B.exports.__esModule=!0,B.exports.default=B.exports},73408:function(B,oe,N){var re=N(52677).default,J=N(25098);function F(V,K){if(K&&(re(K)==="object"||typeof K=="function"))return K;if(K!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return J(V)}B.exports=F,B.exports.__esModule=!0,B.exports.default=B.exports},21314:function(B){function oe(N,re){return B.exports=oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(F,V){return F.__proto__=V,F},B.exports.__esModule=!0,B.exports.default=B.exports,oe(N,re)}B.exports=oe,B.exports.__esModule=!0,B.exports.default=B.exports},70426:function(B,oe,N){var re=N(48374);function J(F,V){for(;!Object.prototype.hasOwnProperty.call(F,V)&&(F=re(F),F!==null););return F}B.exports=J,B.exports.__esModule=!0,B.exports.default=B.exports},12665:function(B,oe,N){var re=N(48374),J=N(21314),F=N(15143),V=N(42672);function K(ne){var ae=typeof Map=="function"?new Map:void 0;return B.exports=K=function(ie){if(ie===null||!F(ie))return ie;if(typeof ie!="function")throw new TypeError("Super expression must either be null or a function");if(typeof ae!="undefined"){if(ae.has(ie))return ae.get(ie);ae.set(ie,R)}function R(){return V(ie,arguments,re(this).constructor)}return R.prototype=Object.create(ie.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),J(R,ie)},B.exports.__esModule=!0,B.exports.default=B.exports,K(ne)}B.exports=K,B.exports.__esModule=!0,B.exports.default=B.exports},5008:function(B,oe,N){"use strict";N.d(oe,{X:function(){return K}});var re=N(12444),J=N(72004);var F=2,V=1,K=function(){function ne(){re(this,ne)}return J(ne,[{key:"activate",value:function(Y){this._terminal=Y}},{key:"dispose",value:function(){}},{key:"fit",value:function(){var Y=this.proposeDimensions();if(!(!Y||!this._terminal||isNaN(Y.cols)||isNaN(Y.rows))){var ie=this._terminal._core;(this._terminal.rows!==Y.rows||this._terminal.cols!==Y.cols)&&(ie._renderService.clear(),this._terminal.resize(Y.cols,Y.rows))}}},{key:"proposeDimensions",value:function(){var Y;if(!(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)){var ie=this._terminal._core._renderService.dimensions;if(!(ie.css.cell.width===0||ie.css.cell.height===0)){var R=this._terminal.options.scrollback===0?0:((Y=this._terminal.options.overviewRuler)===null||Y===void 0?void 0:Y.width)||14,I=window.getComputedStyle(this._terminal.element.parentElement),Z=parseInt(I.getPropertyValue("height")),Ie=Math.max(0,parseInt(I.getPropertyValue("width"))),Ye=window.getComputedStyle(this._terminal.element),z={top:parseInt(Ye.getPropertyValue("padding-top")),bottom:parseInt(Ye.getPropertyValue("padding-bottom")),right:parseInt(Ye.getPropertyValue("padding-right")),left:parseInt(Ye.getPropertyValue("padding-left"))},U=z.top+z.bottom,S=z.right+z.left,k=Z-U,mt=Ie-S-R;return{cols:Math.max(F,Math.floor(mt/ie.css.cell.width)),rows:Math.max(V,Math.floor(k/ie.css.cell.height))}}}}}]),ne}()},86656:function(B,oe,N){"use strict";N.d(oe,{o:function(){return xc}});var re=N(42672),J=N(97857),F=N(73408),V=N(28785),K=N(48374),ne=N(5574),ae=N(19632),Y=N(99289),ie=N(9783),R=N(52677),I=N(15009),Z=N(64599),Ie=N(25098),Ye=N(12665),z=N(31996),U=N(26037),S=N(12444),k=N(72004),mt=N(44987),fe=N(34155),Us,Ks,Vs,Fr;var Ji=Object.defineProperty,Zs=Object.getOwnPropertyDescriptor,js=function(o,r){for(var t in r)Ji(o,t,{get:r[t],enumerable:!0})},ge=function(o,r,t,e){for(var i=e>1?void 0:e?Zs(r,t):r,n=o.length-1,a;n>=0;n--)(a=o[n])&&(i=(e?a(r,t,i):a(i))||i);return e&&i&&Ji(r,t,i),i},T=function(o,r){return function(t,e){return r(t,e,o)}},Qi="Terminal input",zr={get:function(){return Qi},set:function(o){return Qi=o}},en="Too much output to announce, navigate to rows manually to read",Ur={get:function(){return en},set:function(o){return en=o}};function qs(s){return s.replace(/\r?\n/g,"\r")}function $s(s,o){return o?"\x1B[200~"+s+"\x1B[201~":s}function Ys(s,o){s.clipboardData&&s.clipboardData.setData("text/plain",o.selectionText),s.preventDefault()}function Gs(s,o,r,t){if(s.stopPropagation(),s.clipboardData){var e=s.clipboardData.getData("text/plain");tn(e,o,r,t)}}function tn(s,o,r,t){s=qs(s),s=$s(s,r.decPrivateModes.bracketedPasteMode&&t.rawOptions.ignoreBracketedPasteMode!==!0),r.triggerDataEvent(s,!0),o.value=""}function rn(s,o,r){var t=r.getBoundingClientRect(),e=s.clientX-t.left-10,i=s.clientY-t.top-10;o.style.width="20px",o.style.height="20px",o.style.left="".concat(e,"px"),o.style.top="".concat(i,"px"),o.style.zIndex="1000",o.focus()}function nn(s,o,r,t,e){rn(s,o,r),e&&t.rightClickSelect(s),o.value=t.selectionText,o.select()}function ct(s){return s>65535?(s-=65536,String.fromCharCode((s>>10)+55296)+String.fromCharCode(s%1024+56320)):String.fromCharCode(s)}function ar(s){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:s.length,t="",e=o;e<r;++e){var i=s[e];i>65535?(i-=65536,t+=String.fromCharCode((i>>10)+55296)+String.fromCharCode(i%1024+56320)):t+=String.fromCharCode(i)}return t}var Xs=function(){function s(){S(this,s),this._interim=0}return k(s,[{key:"clear",value:function(){this._interim=0}},{key:"decode",value:function(r,t){var e=r.length;if(!e)return 0;var i=0,n=0;if(this._interim){var a=r.charCodeAt(n++);56320<=a&&a<=57343?t[i++]=(this._interim-55296)*1024+a-56320+65536:(t[i++]=this._interim,t[i++]=a),this._interim=0}for(var l=n;l<e;++l){var u=r.charCodeAt(l);if(55296<=u&&u<=56319){if(++l>=e)return this._interim=u,i;var h=r.charCodeAt(l);56320<=h&&h<=57343?t[i++]=(u-55296)*1024+h-56320+65536:(t[i++]=u,t[i++]=h);continue}u!==65279&&(t[i++]=u)}return i}}]),s}(),Js=function(){function s(){S(this,s),this.interim=new Uint8Array(3)}return k(s,[{key:"clear",value:function(){this.interim.fill(0)}},{key:"decode",value:function(r,t){var e=r.length;if(!e)return 0;var i=0,n,a,l,u,h=0,c=0;if(this.interim[0]){var d=!1,_=this.interim[0];_&=(_&224)===192?31:(_&240)===224?15:7;for(var v=0,f;(f=this.interim[++v]&63)&&v<4;)_<<=6,_|=f;for(var m=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,g=m-v;c<g;){if(c>=e)return 0;if(f=r[c++],(f&192)!==128){c--,d=!0;break}else this.interim[v++]=f,_<<=6,_|=f&63}d||(m===2?_<128?c--:t[i++]=_:m===3?_<2048||_>=55296&&_<=57343||_===65279||(t[i++]=_):_<65536||_>1114111||(t[i++]=_)),this.interim.fill(0)}for(var w=e-4,y=c;y<e;){for(;y<w&&!((n=r[y])&128)&&!((a=r[y+1])&128)&&!((l=r[y+2])&128)&&!((u=r[y+3])&128);)t[i++]=n,t[i++]=a,t[i++]=l,t[i++]=u,y+=4;if(n=r[y++],n<128)t[i++]=n;else if((n&224)===192){if(y>=e)return this.interim[0]=n,i;if(a=r[y++],(a&192)!==128){y--;continue}if(h=(n&31)<<6|a&63,h<128){y--;continue}t[i++]=h}else if((n&240)===224){if(y>=e)return this.interim[0]=n,i;if(a=r[y++],(a&192)!==128){y--;continue}if(y>=e)return this.interim[0]=n,this.interim[1]=a,i;if(l=r[y++],(l&192)!==128){y--;continue}if(h=(n&15)<<12|(a&63)<<6|l&63,h<2048||h>=55296&&h<=57343||h===65279)continue;t[i++]=h}else if((n&248)===240){if(y>=e)return this.interim[0]=n,i;if(a=r[y++],(a&192)!==128){y--;continue}if(y>=e)return this.interim[0]=n,this.interim[1]=a,i;if(l=r[y++],(l&192)!==128){y--;continue}if(y>=e)return this.interim[0]=n,this.interim[1]=a,this.interim[2]=l,i;if(u=r[y++],(u&192)!==128){y--;continue}if(h=(n&7)<<18|(a&63)<<12|(l&63)<<6|u&63,h<65536||h>1114111)continue;t[i++]=h}}return i}}]),s}(),sn="",ut=" ",Rt=function(){function s(){S(this,s),this.fg=0,this.bg=0,this.extended=new lr}return k(s,[{key:"clone",value:function(){var r=new s;return r.fg=this.fg,r.bg=this.bg,r.extended=this.extended.clone(),r}},{key:"isInverse",value:function(){return this.fg&67108864}},{key:"isBold",value:function(){return this.fg&134217728}},{key:"isUnderline",value:function(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}},{key:"isBlink",value:function(){return this.fg&536870912}},{key:"isInvisible",value:function(){return this.fg&1073741824}},{key:"isItalic",value:function(){return this.bg&67108864}},{key:"isDim",value:function(){return this.bg&134217728}},{key:"isStrikethrough",value:function(){return this.fg&2147483648}},{key:"isProtected",value:function(){return this.bg&536870912}},{key:"isOverline",value:function(){return this.bg&1073741824}},{key:"getFgColorMode",value:function(){return this.fg&50331648}},{key:"getBgColorMode",value:function(){return this.bg&50331648}},{key:"isFgRGB",value:function(){return(this.fg&50331648)===50331648}},{key:"isBgRGB",value:function(){return(this.bg&50331648)===50331648}},{key:"isFgPalette",value:function(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}},{key:"isBgPalette",value:function(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}},{key:"isFgDefault",value:function(){return(this.fg&50331648)===0}},{key:"isBgDefault",value:function(){return(this.bg&50331648)===0}},{key:"isAttributeDefault",value:function(){return this.fg===0&&this.bg===0}},{key:"getFgColor",value:function(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}},{key:"getBgColor",value:function(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}},{key:"hasExtendedAttrs",value:function(){return this.bg&268435456}},{key:"updateExtended",value:function(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}},{key:"getUnderlineColor",value:function(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}},{key:"getUnderlineColorMode",value:function(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}},{key:"isUnderlineColorRGB",value:function(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}},{key:"isUnderlineColorPalette",value:function(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}},{key:"isUnderlineColorDefault",value:function(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}},{key:"getUnderlineStyle",value:function(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}},{key:"getUnderlineVariantOffset",value:function(){return this.extended.underlineVariantOffset}}],[{key:"toColorRGB",value:function(r){return[r>>>16&255,r>>>8&255,r&255]}},{key:"fromColorRGB",value:function(r){return(r[0]&255)<<16|(r[1]&255)<<8|r[2]&255}}]),s}(),lr=function(){function s(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;S(this,s),this._ext=0,this._urlId=0,this._ext=o,this._urlId=r}return k(s,[{key:"ext",get:function(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext},set:function(r){this._ext=r}},{key:"underlineStyle",get:function(){return this._urlId?5:(this._ext&469762048)>>26},set:function(r){this._ext&=-469762049,this._ext|=r<<26&469762048}},{key:"underlineColor",get:function(){return this._ext&67108863},set:function(r){this._ext&=-67108864,this._ext|=r&67108863}},{key:"urlId",get:function(){return this._urlId},set:function(r){this._urlId=r}},{key:"underlineVariantOffset",get:function(){var r=(this._ext&3758096384)>>29;return r<0?r^4294967288:r},set:function(r){this._ext&=536870911,this._ext|=r<<29&3758096384}},{key:"clone",value:function(){return new s(this._ext,this._urlId)}},{key:"isEmpty",value:function(){return this.underlineStyle===0&&this._urlId===0}}]),s}(),ze=function(s){z(r,s);var o=U(r);function r(){var t;return S(this,r),t=o.apply(this,arguments),t.content=0,t.fg=0,t.bg=0,t.extended=new lr,t.combinedData="",t}return k(r,[{key:"isCombined",value:function(){return this.content&2097152}},{key:"getWidth",value:function(){return this.content>>22}},{key:"getChars",value:function(){return this.content&2097152?this.combinedData:this.content&2097151?ct(this.content&2097151):""}},{key:"getCode",value:function(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}},{key:"setFromCharData",value:function(e){this.fg=e[0],this.bg=0;var i=!1;if(e[1].length>2)i=!0;else if(e[1].length===2){var n=e[1].charCodeAt(0);if(55296<=n&&n<=56319){var a=e[1].charCodeAt(1);56320<=a&&a<=57343?this.content=(n-55296)*1024+a-56320+65536|e[2]<<22:i=!0}else i=!0}else this.content=e[1].charCodeAt(0)|e[2]<<22;i&&(this.combinedData=e[1],this.content=2097152|e[2]<<22)}},{key:"getAsCharData",value:function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}],[{key:"fromCharData",value:function(e){var i=new r;return i.setFromCharData(e),i}}]),r}(Rt),on="di$target",Kr="di$dependencies",Vr=new Map;function Qs(s){return s[Kr]||[]}function Ee(s){if(Vr.has(s))return Vr.get(s);var o=function r(t,e,i){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");eo(r,t,i)};return o._id=s,Vr.set(s,o),o}function eo(s,o,r){o[on]===o?o[Kr].push({id:s,index:r}):(o[Kr]=[{id:s,index:r}],o[on]=o)}var Te=Ee("BufferService"),an=Ee("CoreMouseService"),yt=Ee("CoreService"),to=Ee("CharsetService"),Zr=Ee("InstantiationService"),ln=Ee("LogService"),Oe=Ee("OptionsService"),cn=Ee("OscLinkService"),ro=Ee("UnicodeService"),Mt=Ee("DecorationService"),jr=function(){function s(o,r,t){S(this,s),this._bufferService=o,this._optionsService=r,this._oscLinkService=t}return k(s,[{key:"provideLinks",value:function(r,t){var e=this._bufferService.buffer.lines.get(r-1);if(!e){t(void 0);return}for(var i=[],n=this._optionsService.rawOptions.linkHandler,a=new ze,l=e.getTrimmedLength(),u=-1,h=-1,c=!1,d=0;d<l;d++)if(!(h===-1&&!e.hasContent(d))){if(e.loadCell(d,a),a.hasExtendedAttrs()&&a.extended.urlId)if(h===-1){h=d,u=a.extended.urlId;continue}else c=a.extended.urlId!==u;else h!==-1&&(c=!0);if(c||h!==-1&&d===l-1){var _,v=(_=this._oscLinkService.getLinkData(u))===null||_===void 0?void 0:_.uri;if(v){var f={start:{x:h+1,y:r},end:{x:d+(!c&&d===l-1?1:0),y:r}},m=!1;if(!(n!=null&&n.allowNonHttpProtocols))try{var g=new URL(v);["http:","https:"].includes(g.protocol)||(m=!0)}catch(w){m=!0}m||i.push({text:v,range:f,activate:function(y,b){return n?n.activate(y,b,f):io(y,b)},hover:function(y,b){var A;return n==null||(A=n.hover)===null||A===void 0?void 0:A.call(n,y,b,f)},leave:function(y,b){var A;return n==null||(A=n.leave)===null||A===void 0?void 0:A.call(n,y,b,f)}})}c=!1,a.hasExtendedAttrs()&&a.extended.urlId?(h=d,u=a.extended.urlId):(h=-1,u=-1)}}t(i)}}]),s}();jr=ge([T(0,Te),T(1,Oe),T(2,cn)],jr);function io(s,o){if(confirm("Do you want to navigate to ".concat(o,`?

WARNING: This link could potentially be dangerous`))){var r=window.open();if(r){try{r.opener=null}catch(t){}r.location.href=o}else console.warn("Opening link blocked as opener could not be cleared")}}var cr=Ee("CharSizeService"),tt=Ee("CoreBrowserService"),qr=Ee("MouseService"),rt=Ee("RenderService"),no=Ee("SelectionService"),un=Ee("CharacterJoinerService"),Dt=Ee("ThemeService"),hn=Ee("LinkProviderService"),so=function(){function s(){S(this,s),this.listeners=[],this.unexpectedErrorHandler=function(o){setTimeout(function(){throw o.stack?dn.isErrorNoTelemetry(o)?new dn(o.message+`

`+o.stack):new Error(o.message+`

`+o.stack):o},0)}}return k(s,[{key:"addListener",value:function(r){var t=this;return this.listeners.push(r),function(){t._removeListener(r)}}},{key:"emit",value:function(r){this.listeners.forEach(function(t){t(r)})}},{key:"_removeListener",value:function(r){this.listeners.splice(this.listeners.indexOf(r),1)}},{key:"setUnexpectedErrorHandler",value:function(r){this.unexpectedErrorHandler=r}},{key:"getUnexpectedErrorHandler",value:function(){return this.unexpectedErrorHandler}},{key:"onUnexpectedError",value:function(r){this.unexpectedErrorHandler(r),this.emit(r)}},{key:"onUnexpectedExternalError",value:function(r){this.unexpectedErrorHandler(r)}}]),s}(),oo=new so;function ur(s){ao(s)||oo.onUnexpectedError(s)}var $r="Canceled";function ao(s){return s instanceof lo?!0:s instanceof Error&&s.name===$r&&s.message===$r}var lo=function(s){z(r,s);var o=U(r);function r(){var t;return S(this,r),t=o.call(this,$r),t.name=t.message,t}return k(r)}(Ye(Error));function co(s){return s?new Error("Illegal argument: ".concat(s)):new Error("Illegal argument")}var dn=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this,t),e.name="CodeExpectedError",e}return k(r,null,[{key:"fromError",value:function(e){if(e instanceof r)return e;var i=new r;return i.message=e.message,i.stack=e.stack,i}},{key:"isErrorNoTelemetry",value:function(e){return e.name==="CodeExpectedError"}}]),r}(Ye(Error)),Yr=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this,t||"An unexpected bug occurred."),Object.setPrototypeOf(Ie(e),r.prototype),e}return k(r)}(Ye(Error));function uo(s,o){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.length,e=r,i=t;e<i;){var n=Math.floor((e+i)/2);o(s[n])?e=n+1:i=n}return e-1}var ho=function(){function s(o){S(this,s),this._array=o,this._findLastMonotonousLastIdx=0}return k(s,[{key:"findLastMonotonous",value:function(r){if(s.assertInvariants){if(this._prevFindLastPredicate){var t=Z(this._array),e;try{for(t.s();!(e=t.n()).done;){var i=e.value;if(this._prevFindLastPredicate(i)&&!r(i))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}}catch(a){t.e(a)}finally{t.f()}}this._prevFindLastPredicate=r}var n=uo(this._array,r,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=n+1,n===-1?void 0:this._array[n]}}]),s}();ho.assertInvariants=!1;var Bc=null;function He(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return s[s.length-(1+o)]}var Gr;(function(s){function o(i){return i<0}s.isLessThan=o;function r(i){return i<=0}s.isLessThanOrEqual=r;function t(i){return i>0}s.isGreaterThan=t;function e(i){return i===0}s.isNeitherLessOrGreaterThan=e,s.greaterThan=1,s.lessThan=-1,s.neitherLessOrGreaterThan=0})(Gr||(Gr={}));function fo(s,o){return function(r,t){return o(s(r),s(t))}}var _o=function(o,r){return o-r},fn=function(){function s(o){S(this,s),this.iterate=o}return k(s,[{key:"forEach",value:function(r){this.iterate(function(t){return r(t),!0})}},{key:"toArray",value:function(){var r=[];return this.iterate(function(t){return r.push(t),!0}),r}},{key:"filter",value:function(r){var t=this;return new s(function(e){return t.iterate(function(i){return r(i)?e(i):!0})})}},{key:"map",value:function(r){var t=this;return new s(function(e){return t.iterate(function(i){return e(r(i))})})}},{key:"some",value:function(r){var t=!1;return this.iterate(function(e){return t=r(e),!t}),t}},{key:"findFirst",value:function(r){var t;return this.iterate(function(e){return r(e)?(t=e,!1):!0}),t}},{key:"findLast",value:function(r){var t;return this.iterate(function(e){return r(e)&&(t=e),!0}),t}},{key:"findLastMaxBy",value:function(r){var t,e=!0;return this.iterate(function(i){return(e||Gr.isGreaterThan(r(i,t)))&&(e=!1,t=i),!0}),t}}]),s}();fn.empty=new fn(function(s){});var Rc=null;function vo(s,o){var r=Object.create(null),t=Z(s),e;try{for(t.s();!(e=t.n()).done;){var i=e.value,n=o(i),a=r[n];a||(a=r[n]=[]),a.push(i)}}catch(l){t.e(l)}finally{t.f()}return r}var _n,vn,Mc=function(s){function o(r,t){S(this,o),this.toKey=t,this._map=new Map,this[_n]="SetWithKey";var e=Z(r),i;try{for(e.s();!(i=e.n()).done;){var n=i.value;this.add(n)}}catch(a){e.e(a)}finally{e.f()}}return k(o,[{key:"size",get:function(){return this._map.size}},{key:"add",value:function(t){var e=this.toKey(t);return this._map.set(e,t),this}},{key:"delete",value:function(t){return this._map.delete(this.toKey(t))}},{key:"has",value:function(t){return this._map.has(this.toKey(t))}},{key:"entries",value:I().mark(function r(){var t,e,i;return I().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t=Z(this._map.values()),a.prev=1,t.s();case 3:if((e=t.n()).done){a.next=9;break}return i=e.value,a.next=7,[i,i];case 7:a.next=3;break;case 9:a.next=14;break;case 11:a.prev=11,a.t0=a.catch(1),t.e(a.t0);case 14:return a.prev=14,t.f(),a.finish(14);case 17:case"end":return a.stop()}},r,this,[[1,11,14,17]])})},{key:"keys",value:function(){return this.values()}},{key:"values",value:I().mark(function r(){var t,e,i;return I().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t=Z(this._map.values()),a.prev=1,t.s();case 3:if((e=t.n()).done){a.next=9;break}return i=e.value,a.next=7,i;case 7:a.next=3;break;case 9:a.next=14;break;case 11:a.prev=11,a.t0=a.catch(1),t.e(a.t0);case 14:return a.prev=14,t.f(),a.finish(14);case 17:case"end":return a.stop()}},r,this,[[1,11,14,17]])})},{key:"clear",value:function(){this._map.clear()}},{key:"forEach",value:function(t,e){var i=this;this._map.forEach(function(n){return t.call(e,n,n,i)})}},{key:s,value:function(){return this.values()}}]),o}((vn=Symbol.iterator,_n=Symbol.toStringTag,vn)),go=function(){function s(){S(this,s),this.map=new Map}return k(s,[{key:"add",value:function(r,t){var e=this.map.get(r);e||(e=new Set,this.map.set(r,e)),e.add(t)}},{key:"delete",value:function(r,t){var e=this.map.get(r);e&&(e.delete(t),e.size===0&&this.map.delete(r))}},{key:"forEach",value:function(r,t){var e=this.map.get(r);e&&e.forEach(t)}},{key:"get",value:function(r){var t=this.map.get(r);return t||new Set}}]),s}();function po(s,o){var r=this,t=!1,e;return function(){if(t)return e;if(t=!0,o)try{e=s.apply(r,arguments)}finally{o()}else e=s.apply(r,arguments);return e}}var Xr;(function(s){var o=I().mark(h),r=I().mark(_),t=I().mark(w),e=I().mark(y),i=I().mark(b),n=I().mark(A);function a(O){return O&&R(O)=="object"&&typeof O[Symbol.iterator]=="function"}s.is=a;var l=Object.freeze([]);function u(){return l}s.empty=u;function h(O){return I().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,O;case 2:case"end":return C.stop()}},o)}s.single=h;function c(O){return a(O)?O:h(O)}s.wrap=c;function d(O){return O||l}s.from=d;function _(O){var W;return I().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:W=O.length-1;case 1:if(!(W>=0)){p.next=7;break}return p.next=4,O[W];case 4:W--,p.next=1;break;case 7:case"end":return p.stop()}},r)}s.reverse=_;function v(O){return!O||O[Symbol.iterator]().next().done===!0}s.isEmpty=v;function f(O){return O[Symbol.iterator]().next().value}s.first=f;function m(O,W){var C=0,p=Z(O),x;try{for(p.s();!(x=p.n()).done;){var D=x.value;if(W(D,C++))return!0}}catch(P){p.e(P)}finally{p.f()}return!1}s.some=m;function g(O,W){var C=Z(O),p;try{for(C.s();!(p=C.n()).done;){var x=p.value;if(W(x))return x}}catch(D){C.e(D)}finally{C.f()}}s.find=g;function w(O,W){var C,p,x;return I().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:C=Z(O),P.prev=1,C.s();case 3:if((p=C.n()).done){P.next=11;break}if(x=p.value,P.t0=W(x),!P.t0){P.next=9;break}return P.next=9,x;case 9:P.next=3;break;case 11:P.next=16;break;case 13:P.prev=13,P.t1=P.catch(1),C.e(P.t1);case 16:return P.prev=16,C.f(),P.finish(16);case 19:case"end":return P.stop()}},t,null,[[1,13,16,19]])}s.filter=w;function y(O,W){var C,p,x,D;return I().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:C=0,p=Z(O),L.prev=2,p.s();case 4:if((x=p.n()).done){L.next=10;break}return D=x.value,L.next=8,W(D,C++);case 8:L.next=4;break;case 10:L.next=15;break;case 12:L.prev=12,L.t0=L.catch(2),p.e(L.t0);case 15:return L.prev=15,p.f(),L.finish(15);case 18:case"end":return L.stop()}},e,null,[[2,12,15,18]])}s.map=y;function b(O,W){var C,p,x,D;return I().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:C=0,p=Z(O),L.prev=2,p.s();case 4:if((x=p.n()).done){L.next=9;break}return D=x.value,L.delegateYield(W(D,C++),"t0",7);case 7:L.next=4;break;case 9:L.next=14;break;case 11:L.prev=11,L.t1=L.catch(2),p.e(L.t1);case 14:return L.prev=14,p.f(),L.finish(14);case 17:case"end":return L.stop()}},i,null,[[2,11,14,17]])}s.flatMap=b;function A(){var O,W,C,p,x,D,P=arguments;return I().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:for(O=P.length,W=new Array(O),C=0;C<O;C++)W[C]=P[C];p=0,x=W;case 2:if(!(p<x.length)){H.next=8;break}return D=x[p],H.delegateYield(D,"t0",5);case 5:p++,H.next=2;break;case 8:case"end":return H.stop()}},n)}s.concat=A;function ee(O,W,C){var p=C,x=Z(O),D;try{for(x.s();!(D=x.n()).done;){var P=D.value;p=W(p,P)}}catch(L){x.e(L)}finally{x.f()}return p}s.reduce=ee;function se(O,W){var C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:O.length;return I().mark(function p(){return I().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:W<0&&(W+=O.length),C<0?C+=O.length:C>O.length&&(C=O.length);case 1:if(!(W<C)){D.next=7;break}return D.next=4,O[W];case 4:W++,D.next=1;break;case 7:case"end":return D.stop()}},p)})()}s.slice=se;function he(O){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.POSITIVE_INFINITY,C=[];if(W===0)return[C,O];for(var p=O[Symbol.iterator](),x=0;x<W;x++){var D=p.next();if(D.done)return[C,s.empty()];C.push(D.value)}return[C,ie({},Symbol.iterator,function(){return p})]}s.consume=he;function te(O){return Se.apply(this,arguments)}function Se(){return Se=Y(I().mark(function O(W){var C,p,x,D,P,L,H;return I().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:C=[],p=!1,x=!1,j.prev=3,P=mt(W);case 5:return j.next=7,P.next();case 7:if(!(p=!(L=j.sent).done)){j.next=13;break}H=L.value,C.push(H);case 10:p=!1,j.next=5;break;case 13:j.next=19;break;case 15:j.prev=15,j.t0=j.catch(3),x=!0,D=j.t0;case 19:if(j.prev=19,j.prev=20,!(p&&P.return!=null)){j.next=24;break}return j.next=24,P.return();case 24:if(j.prev=24,!x){j.next=27;break}throw D;case 27:return j.finish(24);case 28:return j.finish(19);case 29:return j.abrupt("return",Promise.resolve(C));case 30:case"end":return j.stop()}},O,null,[[3,15,19,29],[20,,24,28]])})),Se.apply(this,arguments)}s.asyncToArray=te})(Xr||(Xr={}));var mo=!1,St=null,yo=function(){function s(){S(this,s),this.livingDisposables=new Map}return k(s,[{key:"getDisposableData",value:function(r){var t=this.livingDisposables.get(r);return t||(t={parent:null,source:null,isSingleton:!1,value:r,idx:s.idx++},this.livingDisposables.set(r,t)),t}},{key:"trackDisposable",value:function(r){var t=this.getDisposableData(r);t.source||(t.source=new Error().stack)}},{key:"setParent",value:function(r,t){var e=this.getDisposableData(r);e.parent=t}},{key:"markAsDisposed",value:function(r){this.livingDisposables.delete(r)}},{key:"markAsSingleton",value:function(r){this.getDisposableData(r).isSingleton=!0}},{key:"getRootParent",value:function(r,t){var e=t.get(r);if(e)return e;var i=r.parent?this.getRootParent(this.getDisposableData(r.parent),t):r;return t.set(r,i),i}},{key:"getTrackedDisposables",value:function(){var r=this,t=new Map;return ae(this.livingDisposables.entries()).filter(function(e){var i=ne(e,2),n=i[1];return n.source!==null&&!r.getRootParent(n,t).isSingleton}).flatMap(function(e){var i=ne(e,1),n=i[0];return n})}},{key:"computeLeakingDisposables",value:function(){var r=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0,i;if(e)i=e;else{var n=new Map,a=ae(this.livingDisposables.values()).filter(function(te){return te.source!==null&&!r.getRootParent(te,n).isSingleton});if(a.length===0)return;var l=new Set(a.map(function(te){return te.value}));if(i=a.filter(function(te){return!(te.parent&&l.has(te.parent))}),i.length===0)throw new Error("There are cyclic diposable chains!")}if(!i)return;function u(te){function Se(W,C){for(;W.length>0&&C.some(function(p){return typeof p=="string"?p===W[0]:W[0].match(p)});)W.shift()}var O=te.source.split(`
`).map(function(W){return W.trim().replace("at ","")}).filter(function(W){return W!==""});return Se(O,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),O.reverse()}var h=new go,c=Z(i),d;try{for(c.s();!(d=c.n()).done;)for(var _=d.value,v=u(_),f=0;f<=v.length;f++)h.add(v.slice(0,f).join(`
`),_)}catch(te){c.e(te)}finally{c.f()}i.sort(fo(function(te){return te.idx},_o));var m="",g=0,w=Z(i.slice(0,t)),y;try{for(w.s();!(y=w.n()).done;){var b=y.value;g++;for(var A=u(b),ee=[],se=function(Se){var O=A[Se];O="(shared with ".concat(h.get(A.slice(0,Se+1).join(`
`)).size,"/").concat(i.length," leaks) at ").concat(O);var W=h.get(A.slice(0,Se).join(`
`)),C=vo(ae(W).map(function(H){return u(H)[Se]}),function(H){return H});delete C[A[Se]];for(var p=0,x=Object.entries(C);p<x.length;p++){var D=ne(x[p],2),P=D[0],L=D[1];ee.unshift("    - stacktraces of ".concat(L.length," other leaks continue with ").concat(P))}ee.unshift(O)},he=0;he<A.length;he++)se(he);m+=`


==================== Leaking disposable `.concat(g,"/").concat(i.length,": ").concat(b.value.constructor.name,` ====================
`).concat(ee.join(`
`),`
============================================================

`)}}catch(te){w.e(te)}finally{w.f()}return i.length>t&&(m+=`


... and `.concat(i.length-t,` more leaking disposables

`)),{leaks:i,details:m}}}]),s}();yo.idx=0;var Ac=null;function So(s){St=s}if(mo){var Jr="__is_disposable_tracked__";So(new(function(){function s(){S(this,s)}return k(s,[{key:"trackDisposable",value:function(r){var t=new Error("Potentially leaked disposable").stack;setTimeout(function(){r[Jr]||console.log(t)},3e3)}},{key:"setParent",value:function(r,t){if(r&&r!==G.None)try{r[Jr]=!0}catch(e){}}},{key:"markAsDisposed",value:function(r){if(r&&r!==G.None)try{r[Jr]=!0}catch(t){}}},{key:"markAsSingleton",value:function(r){}}]),s}()))}function hr(s){var o;return(o=St)!==null&&o!==void 0&&o.trackDisposable(s),s}function dr(s){var o;(o=St)===null||o===void 0||o.markAsDisposed(s)}function At(s,o){var r;(r=St)===null||r===void 0||r.setParent(s,o)}function ko(s,o){if(St){var r=Z(s),t;try{for(r.s();!(t=r.n()).done;){var e=t.value;St.setParent(e,o)}}catch(i){r.e(i)}finally{r.f()}}}function gn(s){var o;return(o=St)!==null&&o!==void 0&&o.markAsSingleton(s),s}function kt(s){if(Xr.is(s)){var o=[],r=Z(s),t;try{for(r.s();!(t=r.n()).done;){var e=t.value;if(e)try{e.dispose()}catch(i){o.push(i)}}}catch(i){r.e(i)}finally{r.f()}if(o.length===1)throw o[0];if(o.length>1)throw new AggregateError(o,"Encountered errors while disposing of store");return Array.isArray(s)?[]:s}else if(s)return s.dispose(),s}function bo(){for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];var t=ue(function(){return kt(o)});return ko(o,t),t}function ue(s){var o=hr({dispose:po(function(){dr(o),s()})});return o}var pn=function(){function s(){S(this,s),this._toDispose=new Set,this._isDisposed=!1,hr(this)}return k(s,[{key:"dispose",value:function(){this._isDisposed||(dr(this),this._isDisposed=!0,this.clear())}},{key:"isDisposed",get:function(){return this._isDisposed}},{key:"clear",value:function(){if(this._toDispose.size!==0)try{kt(this._toDispose)}finally{this._toDispose.clear()}}},{key:"add",value:function(r){if(!r)return r;if(r===this)throw new Error("Cannot register a disposable on itself!");return At(r,this),this._isDisposed?s.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(r),r}},{key:"delete",value:function(r){if(r){if(r===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(r),r.dispose()}}},{key:"deleteAndLeak",value:function(r){r&&this._toDispose.has(r)&&(this._toDispose.delete(r),At(r,null))}}]),s}();pn.DISABLE_DISPOSED_WARNING=!1;var ht=pn,G=function(){function s(){S(this,s),this._store=new ht,hr(this),At(this._store,this)}return k(s,[{key:"dispose",value:function(){dr(this),this._store.dispose()}},{key:"_register",value:function(r){if(r===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(r)}}]),s}();G.None=Object.freeze({dispose:function(){}});var Pt=function(){function s(){S(this,s),this._isDisposed=!1,hr(this)}return k(s,[{key:"value",get:function(){return this._isDisposed?void 0:this._value},set:function(r){var t;this._isDisposed||r===this._value||((t=this._value)!==null&&t!==void 0&&t.dispose(),r&&At(r,this),this._value=r)}},{key:"clear",value:function(){this.value=void 0}},{key:"dispose",value:function(){var r;this._isDisposed=!0,dr(this),(r=this._value)!==null&&r!==void 0&&r.dispose(),this._value=void 0}},{key:"clearAndLeak",value:function(){var r=this._value;return this._value=void 0,r&&At(r,null),r}}]),s}(),We=(typeof window=="undefined"?"undefined":R(window))=="object"?window:globalThis,Qr=k(function s(o){S(this,s),this.element=o,this.next=s.Undefined,this.prev=s.Undefined});Qr.Undefined=new Qr(void 0);var _e=Qr,mn=function(s){function o(){S(this,o),this._first=_e.Undefined,this._last=_e.Undefined,this._size=0}return k(o,[{key:"size",get:function(){return this._size}},{key:"isEmpty",value:function(){return this._first===_e.Undefined}},{key:"clear",value:function(){for(var t=this._first;t!==_e.Undefined;){var e=t.next;t.prev=_e.Undefined,t.next=_e.Undefined,t=e}this._first=_e.Undefined,this._last=_e.Undefined,this._size=0}},{key:"unshift",value:function(t){return this._insert(t,!1)}},{key:"push",value:function(t){return this._insert(t,!0)}},{key:"_insert",value:function(t,e){var i=this,n=new _e(t);if(this._first===_e.Undefined)this._first=n,this._last=n;else if(e){var a=this._last;this._last=n,n.prev=a,a.next=n}else{var l=this._first;this._first=n,n.next=l,l.prev=n}this._size+=1;var u=!1;return function(){u||(u=!0,i._remove(n))}}},{key:"shift",value:function(){if(this._first!==_e.Undefined){var t=this._first.element;return this._remove(this._first),t}}},{key:"pop",value:function(){if(this._last!==_e.Undefined){var t=this._last.element;return this._remove(this._last),t}}},{key:"_remove",value:function(t){if(t.prev!==_e.Undefined&&t.next!==_e.Undefined){var e=t.prev;e.next=t.next,t.next.prev=e}else t.prev===_e.Undefined&&t.next===_e.Undefined?(this._first=_e.Undefined,this._last=_e.Undefined):t.next===_e.Undefined?(this._last=this._last.prev,this._last.next=_e.Undefined):t.prev===_e.Undefined&&(this._first=this._first.next,this._first.prev=_e.Undefined);this._size-=1}},{key:s,value:I().mark(function r(){var t;return I().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:t=this._first;case 1:if(t===_e.Undefined){i.next=7;break}return i.next=4,t.element;case 4:t=t.next;case 5:i.next=1;break;case 7:case"end":return i.stop()}},r,this)})}]),o}(Symbol.iterator),wo=globalThis.performance&&typeof globalThis.performance.now=="function",Co=function(){function s(o){S(this,s),this._now=wo&&o===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}return k(s,[{key:"stop",value:function(){this._stopTime=this._now()}},{key:"reset",value:function(){this._startTime=this._now(),this._stopTime=-1}},{key:"elapsed",value:function(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}}],[{key:"create",value:function(r){return new s(r)}}]),s}(),Eo=!1,yn=!1,xo=!1,xe;(function(s){s.None=function(){return G.None};function o(C){if(xo){var p=C.onDidAddListener,x=ti.create(),D=0;C.onDidAddListener=function(){++D===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),x.print()),p==null||p()}}}function r(C,p){return d(C,function(){},0,void 0,!0,void 0,p)}s.defer=r;function t(C){return function(p){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,P=!1,L;return L=C(function(H){if(!P)return L?L.dispose():P=!0,p.call(x,H)},null,D),P&&L.dispose(),L}}s.once=t;function e(C,p,x){return h(function(D){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;return C(function(H){return D.call(P,p(H))},null,L)},x)}s.map=e;function i(C,p,x){return h(function(D){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;return C(function(H){p(H),D.call(P,H)},null,L)},x)}s.forEach=i;function n(C,p,x){return h(function(D){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;return C(function(H){return p(H)&&D.call(P,H)},null,L)},x)}s.filter=n;function a(C){return C}s.signal=a;function l(){for(var C=arguments.length,p=new Array(C),x=0;x<C;x++)p[x]=arguments[x];return function(D){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,H=bo.apply(void 0,ae(p.map(function(q){return q(function(j){return D.call(P,j)})})));return c(H,L)}}s.any=l;function u(C,p,x,D){var P=x;return e(C,function(L){return P=p(P,L),P},D)}s.reduce=u;function h(C,p){var x,D={onWillAddFirstListener:function(){x=C(P.fire,P)},onDidRemoveLastListener:function(){var H;(H=x)===null||H===void 0||H.dispose()}};p||o(D);var P=new M(D);return p!=null&&p.add(P),P.event}function c(C,p){return p instanceof Array?p.push(C):p&&p.add(C),C}function d(C,p){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:100,D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,P=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,L=arguments.length>5?arguments[5]:void 0,H=arguments.length>6?arguments[6]:void 0,q,j,ve,Re=0,at,X={leakWarningThreshold:L,onWillAddFirstListener:function(){q=C(function($e){Re++,j=p(j,$e),D&&!ve&&(Ae.fire(j),j=void 0),at=function(){var ir=j;j=void 0,ve=void 0,(!D||Re>1)&&Ae.fire(ir),Re=0},typeof x=="number"?(clearTimeout(ve),ve=setTimeout(at,x)):ve===void 0&&(ve=0,queueMicrotask(at))})},onWillRemoveListener:function(){var $e;P&&Re>0&&(($e=at)===null||$e===void 0||$e())},onDidRemoveLastListener:function(){at=void 0,q.dispose()}};H||o(X);var Ae=new M(X);return H!=null&&H.add(Ae),Ae.event}s.debounce=d;function _(C){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;return s.debounce(C,function(D,P){return D?(D.push(P),D):[P]},p,void 0,!0,void 0,x)}s.accumulate=_;function v(C){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(L,H){return L===H},x=arguments.length>2?arguments[2]:void 0,D=!0,P;return n(C,function(L){var H=D||!p(L,P);return D=!1,P=L,H},x)}s.latch=v;function f(C,p,x){return[s.filter(C,p,x),s.filter(C,function(D){return!p(D)},x)]}s.split=f;function m(C){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],D=arguments.length>3?arguments[3]:void 0,P=x.slice(),L=C(function(j){P?P.push(j):q.fire(j)});D&&D.add(L);var H=function(){var ve;(ve=P)!==null&&ve!==void 0&&ve.forEach(function(Re){return q.fire(Re)}),P=null},q=new M({onWillAddFirstListener:function(){L||(L=C(function(ve){return q.fire(ve)}),D&&D.add(L))},onDidAddFirstListener:function(){P&&(p?setTimeout(H):H())},onDidRemoveLastListener:function(){L&&L.dispose(),L=null}});return D&&D.add(q),q.event}s.buffer=m;function g(C,p){return function(x,D,P){var L=p(new y);return C(function(H){var q=L.evaluate(H);q!==w&&x.call(D,q)},void 0,P)}}s.chain=g;var w=Symbol("HaltChainable"),y=function(){function C(){S(this,C),this.steps=[]}return k(C,[{key:"map",value:function(x){return this.steps.push(x),this}},{key:"forEach",value:function(x){return this.steps.push(function(D){return x(D),D}),this}},{key:"filter",value:function(x){return this.steps.push(function(D){return x(D)?D:w}),this}},{key:"reduce",value:function(x,D){var P=D;return this.steps.push(function(L){return P=x(P,L),P}),this}},{key:"latch",value:function(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(L,H){return L===H},D=!0,P;return this.steps.push(function(L){var H=D||!x(L,P);return D=!1,P=L,H?L:w}),this}},{key:"evaluate",value:function(x){var D=Z(this.steps),P;try{for(D.s();!(P=D.n()).done;){var L=P.value;if(x=L(x),x===w)break}}catch(H){D.e(H)}finally{D.f()}return x}}]),C}();function b(C,p){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(q){return q},D=function(){return H.fire(x.apply(void 0,arguments))},P=function(){return C.on(p,D)},L=function(){return C.removeListener(p,D)},H=new M({onWillAddFirstListener:P,onDidRemoveLastListener:L});return H.event}s.fromNodeEventEmitter=b;function A(C,p){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(q){return q},D=function(){return H.fire(x.apply(void 0,arguments))},P=function(){return C.addEventListener(p,D)},L=function(){return C.removeEventListener(p,D)},H=new M({onWillAddFirstListener:P,onDidRemoveLastListener:L});return H.event}s.fromDOMEventEmitter=A;function ee(C){return new Promise(function(p){return t(C)(p)})}s.toPromise=ee;function se(C){var p=new M;return C.then(function(x){p.fire(x)},function(){p.fire(void 0)}).finally(function(){p.dispose()}),p.event}s.fromPromise=se;function he(C,p){return C(function(x){return p.fire(x)})}s.forward=he;function te(C,p,x){return p(x),C(function(D){return p(D)})}s.runAndSubscribe=te;var Se=function(){function C(p,x){var D=this;S(this,C),this._observable=p,this._counter=0,this._hasChanged=!1;var P={onWillAddFirstListener:function(){p.addObserver(D)},onDidRemoveLastListener:function(){p.removeObserver(D)}};x||o(P),this.emitter=new M(P),x&&x.add(this.emitter)}return k(C,[{key:"beginUpdate",value:function(x){this._counter++}},{key:"handlePossibleChange",value:function(x){}},{key:"handleChange",value:function(x,D){this._hasChanged=!0}},{key:"endUpdate",value:function(x){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}]),C}();function O(C,p){return new Se(C,p).emitter.event}s.fromObservable=O;function W(C){return function(p,x,D){var P=0,L=!1,H={beginUpdate:function(){P++},endUpdate:function(){P--,P===0&&(C.reportChanges(),L&&(L=!1,p.call(x)))},handlePossibleChange:function(){},handleChange:function(){L=!0}};C.addObserver(H),C.reportChanges();var q={dispose:function(){C.removeObserver(H)}};return D instanceof ht?D.add(q):Array.isArray(D)&&D.push(q),q}}s.fromObservableLight=W})(xe||(xe={}));var ei=function(){function s(o){S(this,s),this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name="".concat(o,"_").concat(s._idPool++),s.all.add(this)}return k(s,[{key:"start",value:function(r){this._stopWatch=new Co,this.listenerCount=r}},{key:"stop",value:function(){if(this._stopWatch){var r=this._stopWatch.elapsed();this.durations.push(r),this.elapsedOverall+=r,this.invocationCount+=1,this._stopWatch=void 0}}}]),s}();ei.all=new Set,ei._idPool=0;var Do=ei,Sn=-1,kn=function(){function s(o,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s._idPool++).toString(16).padStart(3,"0");S(this,s),this._errorHandler=o,this.threshold=r,this.name=t,this._warnCountdown=0}return k(s,[{key:"dispose",value:function(){var r;(r=this._stacks)===null||r===void 0||r.clear()}},{key:"check",value:function(r,t){var e=this,i=this.threshold;if(!(i<=0||t<i)){this._stacks||(this._stacks=new Map);var n=this._stacks.get(r.value)||0;if(this._stacks.set(r.value,n+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=i*.5;var a=this.getMostFrequentStack(),l=ne(a,2),u=l[0],h=l[1],c="[".concat(this.name,"] potential listener LEAK detected, having ").concat(t," listeners already. MOST frequent listener (").concat(h,"):");console.warn(c),console.warn(u);var d=new Lo(c,u);this._errorHandler(d)}return function(){var _=e._stacks.get(r.value)||0;e._stacks.set(r.value,_-1)}}}},{key:"getMostFrequentStack",value:function(){if(this._stacks){var r,t=0,e=Z(this._stacks),i;try{for(e.s();!(i=e.n()).done;){var n=ne(i.value,2),a=n[0],l=n[1];(!r||t<l)&&(r=[a,l],t=l)}}catch(u){e.e(u)}finally{e.f()}return r}}}]),s}();kn._idPool=1;var Po=kn,ti=function(){function s(o){S(this,s),this.value=o}return k(s,[{key:"print",value:function(){console.warn(this.value.split(`
`).slice(2).join(`
`))}}],[{key:"create",value:function(){var r,t=new Error;return new s((r=t.stack)!==null&&r!==void 0?r:"")}}]),s}(),Lo=function(s){z(r,s);var o=U(r);function r(t,e){var i;return S(this,r),i=o.call(this,t),i.name="ListenerLeakError",i.stack=e,i}return k(r)}(Ye(Error)),Bo=function(s){z(r,s);var o=U(r);function r(t,e){var i;return S(this,r),i=o.call(this,t),i.name="ListenerRefusalError",i.stack=e,i}return k(r)}(Ye(Error)),Ro=0,fr=k(function s(o){S(this,s),this.value=o,this.id=Ro++}),Mo=2,Ao=function(o,r){if(o instanceof fr)r(o);else for(var t=0;t<o.length;t++){var e=o[t];e&&r(e)}},_r;if(Eo){var vr=[];setInterval(function(){vr.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(vr.join(`
`)),vr.length=0)},3e3),_r=new FinalizationRegistry(function(s){typeof s=="string"&&vr.push(s)})}var M=function(){function s(o){var r,t,e,i,n,a;S(this,s),this._size=0,this._options=o,this._leakageMon=Sn>0||(r=this._options)!==null&&r!==void 0&&r.leakWarningThreshold?new Po((t=o==null?void 0:o.onListenerError)!==null&&t!==void 0?t:ur,(e=(i=this._options)===null||i===void 0?void 0:i.leakWarningThreshold)!==null&&e!==void 0?e:Sn):void 0,this._perfMon=(n=this._options)!==null&&n!==void 0&&n._profName?new Do(this._options._profName):void 0,this._deliveryQueue=(a=this._options)===null||a===void 0?void 0:a.deliveryQueue}return k(s,[{key:"dispose",value:function(){if(!this._disposed){var r,t,e,i;if(this._disposed=!0,((r=this._deliveryQueue)===null||r===void 0?void 0:r.current)===this&&this._deliveryQueue.reset(),this._listeners){if(yn){var n=this._listeners;queueMicrotask(function(){Ao(n,function(a){var l;return(l=a.stack)===null||l===void 0?void 0:l.print()})})}this._listeners=void 0,this._size=0}(t=this._options)!==null&&t!==void 0&&(e=t.onDidRemoveLastListener)!==null&&e!==void 0&&e.call(t),(i=this._leakageMon)===null||i===void 0||i.dispose()}}},{key:"event",get:function(){var r,t=this;return(r=this._event)!==null&&r!==void 0||(this._event=function(e,i,n){var a,l,u,h,c;if(t._leakageMon&&t._size>Math.pow(t._leakageMon.threshold,2)){var d,_,v="[".concat(t._leakageMon.name,"] REFUSES to accept new listeners because it exceeded its threshold by far (").concat(t._size," vs ").concat(t._leakageMon.threshold,")");console.warn(v);var f=(d=t._leakageMon.getMostFrequentStack())!==null&&d!==void 0?d:["UNKNOWN stack",-1],m=new Bo("".concat(v,". HINT: Stack shows most frequent listener (").concat(f[1],"-times)"),f[0]);return(((_=t._options)===null||_===void 0?void 0:_.onListenerError)||ur)(m),G.None}if(t._disposed)return G.None;i&&(e=e.bind(i));var g=new fr(e),w,y;t._leakageMon&&t._size>=Math.ceil(t._leakageMon.threshold*.2)&&(g.stack=ti.create(),w=t._leakageMon.check(g.stack,t._size+1)),yn&&(g.stack=y!=null?y:ti.create()),t._listeners?t._listeners instanceof fr?((a=t._deliveryQueue)!==null&&a!==void 0||(t._deliveryQueue=new To),t._listeners=[t._listeners,g]):t._listeners.push(g):((l=t._options)!==null&&l!==void 0&&(u=l.onWillAddFirstListener)!==null&&u!==void 0&&u.call(l,t),t._listeners=g,(h=t._options)===null||h===void 0||(c=h.onDidAddFirstListener)===null||c===void 0||c.call(h,t)),t._size++;var b=ue(function(){var he,te;(he=_r)!==null&&he!==void 0&&he.unregister(b),(te=w)!==null&&te!==void 0&&te(),t._removeListener(g)});if(n instanceof ht?n.add(b):Array.isArray(n)&&n.push(b),_r){var A,ee=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),se=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(ee);_r.register(b,(A=se==null?void 0:se[2])!==null&&A!==void 0?A:ee,b)}return b}),this._event}},{key:"_removeListener",value:function(r){var t,e;if((t=this._options)!==null&&t!==void 0&&(e=t.onWillRemoveListener)!==null&&e!==void 0&&e.call(t,this),!!this._listeners){if(this._size===1){var i,n;this._listeners=void 0,(i=this._options)!==null&&i!==void 0&&(n=i.onDidRemoveLastListener)!==null&&n!==void 0&&n.call(i,this),this._size=0;return}var a=this._listeners,l=a.indexOf(r);if(l===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,a[l]=void 0;var u=this._deliveryQueue.current===this;if(this._size*Mo<=a.length){for(var h=0,c=0;c<a.length;c++)a[c]?a[h++]=a[c]:u&&(this._deliveryQueue.end--,h<this._deliveryQueue.i&&this._deliveryQueue.i--);a.length=h}}}},{key:"_deliver",value:function(r,t){var e;if(r){var i=((e=this._options)===null||e===void 0?void 0:e.onListenerError)||ur;if(!i){r.value(t);return}try{r.value(t)}catch(n){i(n)}}}},{key:"_deliverQueue",value:function(r){for(var t=r.current._listeners;r.i<r.end;)this._deliver(t[r.i++],r.value);r.reset()}},{key:"fire",value:function(r){var t,e,i,n;if((t=this._deliveryQueue)!==null&&t!==void 0&&t.current&&(this._deliverQueue(this._deliveryQueue),(e=this._perfMon)!==null&&e!==void 0&&e.stop()),(i=this._perfMon)!==null&&i!==void 0&&i.start(this._size),this._listeners)if(this._listeners instanceof fr)this._deliver(this._listeners,r);else{var a=this._deliveryQueue;a.enqueue(this,r,this._listeners.length),this._deliverQueue(a)}(n=this._perfMon)===null||n===void 0||n.stop()}},{key:"hasListeners",value:function(){return this._size>0}}]),s}(),To=function(){function s(){S(this,s),this.i=-1,this.end=0}return k(s,[{key:"enqueue",value:function(r,t,e){this.i=0,this.end=e,this.current=r,this.value=t}},{key:"reset",value:function(){this.i=this.end,this.current=void 0,this.value=void 0}}]),s}(),ri=function(){function s(){S(this,s),this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new M,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new M,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}return k(s,[{key:"getZoomLevel",value:function(r){var t;return(t=this.mapWindowIdToZoomLevel.get(this.getWindowId(r)))!==null&&t!==void 0?t:0}},{key:"setZoomLevel",value:function(r,t){if(this.getZoomLevel(t)!==r){var e=this.getWindowId(t);this.mapWindowIdToZoomLevel.set(e,r),this._onDidChangeZoomLevel.fire(e)}}},{key:"getZoomFactor",value:function(r){var t;return(t=this.mapWindowIdToZoomFactor.get(this.getWindowId(r)))!==null&&t!==void 0?t:1}},{key:"setZoomFactor",value:function(r,t){this.mapWindowIdToZoomFactor.set(this.getWindowId(t),r)}},{key:"setFullscreen",value:function(r,t){if(this.isFullscreen(t)!==r){var e=this.getWindowId(t);this.mapWindowIdToFullScreen.set(e,r),this._onDidChangeFullscreen.fire(e)}}},{key:"isFullscreen",value:function(r){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(r))}},{key:"getWindowId",value:function(r){return r.vscodeWindowId}}]),s}();ri.INSTANCE=new ri;var ii=ri;function Oo(s,o,r){typeof o=="string"&&(o=s.matchMedia(o)),o.addEventListener("change",r)}var Tc=ii.INSTANCE.onDidChangeZoomLevel;function Io(s){return ii.INSTANCE.getZoomFactor(s)}var Oc=ii.INSTANCE.onDidChangeFullscreen,Lt=(typeof navigator=="undefined"?"undefined":R(navigator))=="object"?navigator.userAgent:"",ni=Lt.indexOf("Firefox")>=0,gr=Lt.indexOf("AppleWebKit")>=0,si=Lt.indexOf("Chrome")>=0,bn=!si&&Lt.indexOf("Safari")>=0,Ic=Lt.indexOf("Electron/")>=0,Nc=Lt.indexOf("Android")>=0,pr=!1;if(typeof We.matchMedia=="function"){var wn=We.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),No=We.matchMedia("(display-mode: fullscreen)");pr=wn.matches,Oo(We,wn,function(s){var o=s.matches;pr&&No.matches||(pr=o)})}function Ho(){return pr}var Tt="en",mr=!1,yr=!1,Ot=!1,Wo=null,Cn=!1,En=!1,Fo=null,zo=null,Uo=null,Ko=null,Sr,kr=Tt,xn=null,Vo,it,nt=globalThis,br;R(nt.vscode)<"u"&&R(nt.vscode.process)<"u"?br=nt.vscode.process:(typeof fe=="undefined"?"undefined":R(fe))<"u"&&typeof((Us=fe)===null||fe===void 0||(fe=fe.versions)===null||fe===void 0?void 0:fe.node)=="string"&&(br=fe);var Dn=typeof((Ks=br)===null||fe===void 0||(fe=fe.versions)===null||fe===void 0?void 0:fe.electron)=="string",Zo=Dn&&((Vs=br)===null||fe===void 0?void 0:fe.type)==="renderer";if(R(fe)=="object"){mr=fe.platform==="win32",yr=fe.platform==="darwin",Ot=fe.platform==="linux",Wo=Ot&&!!{NODE_ENV:"production",PUBLIC_PATH:"/"}.SNAP&&!!{NODE_ENV:"production",PUBLIC_PATH:"/"}.SNAP_REVISION,Fo=Dn,Uo=!!{NODE_ENV:"production",PUBLIC_PATH:"/"}.CI||!!{NODE_ENV:"production",PUBLIC_PATH:"/"}.BUILD_ARTIFACTSTAGINGDIRECTORY,Sr=Tt,kr=Tt;var Pn={NODE_ENV:"production",PUBLIC_PATH:"/"}.VSCODE_NLS_CONFIG;if(Pn)try{var oi,wr=JSON.parse(Pn);Sr=wr.userLocale,xn=wr.osLocale,kr=wr.resolvedLanguage||Tt,Vo=(oi=wr.languagePack)===null||oi===void 0?void 0:oi.translationsConfigFile}catch(s){}Cn=!0}else(typeof navigator=="undefined"?"undefined":R(navigator))=="object"&&!Zo?(it=navigator.userAgent,mr=it.indexOf("Windows")>=0,yr=it.indexOf("Macintosh")>=0,zo=(it.indexOf("Macintosh")>=0||it.indexOf("iPad")>=0||it.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Ot=it.indexOf("Linux")>=0,Ko=((Fr=it)===null||Fr===void 0?void 0:Fr.indexOf("Mobi"))>=0,En=!0,kr=globalThis._VSCODE_NLS_LANGUAGE||Tt,Sr=navigator.language.toLowerCase(),xn=Sr):console.error("Unable to resolve platform.");var ai=0;yr?ai=1:mr?ai=3:Ot&&(ai=2);var Ln=mr,Ge=yr,jo=Ot,li=Cn,qo=En&&typeof nt.importScripts=="function",Hc=qo?nt.origin:void 0,Xe=it,dt=kr,Bn;(function(s){function o(){return dt}s.value=o;function r(){return dt.length===2?dt==="en":dt.length>=3?dt[0]==="e"&&dt[1]==="n"&&dt[2]==="-":!1}s.isDefaultVariant=r;function t(){return dt==="en"}s.isDefault=t})(Bn||(Bn={}));var $o=typeof nt.postMessage=="function"&&!nt.importScripts,Yo=function(){if($o){var s=[];nt.addEventListener("message",function(r){if(r.data&&r.data.vscodeScheduleAsyncWork)for(var t=0,e=s.length;t<e;t++){var i=s[t];if(i.id===r.data.vscodeScheduleAsyncWork){s.splice(t,1),i.callback();return}}});var o=0;return function(r){var t=++o;s.push({id:t,callback:r}),nt.postMessage({vscodeScheduleAsyncWork:t},"*")}}return function(r){return setTimeout(r)}}(),Go=!!(Xe&&Xe.indexOf("Chrome")>=0),Wc=!!(Xe&&Xe.indexOf("Firefox")>=0),Fc=!!(!Go&&Xe&&Xe.indexOf("Safari")>=0),zc=!!(Xe&&Xe.indexOf("Edg/")>=0),Uc=!!(Xe&&Xe.indexOf("Android")>=0),ft=(typeof navigator=="undefined"?"undefined":R(navigator))=="object"?navigator:{},Kc={clipboard:{writeText:li||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(ft&&ft.clipboard&&ft.clipboard.writeText),readText:li||!!(ft&&ft.clipboard&&ft.clipboard.readText)},keyboard:li||Ho()?0:ft.keyboard||bn?1:2,touch:"ontouchstart"in We||ft.maxTouchPoints>0,pointerEvents:We.PointerEvent&&("ontouchstart"in We||navigator.maxTouchPoints>0)},ci=function(){function s(){S(this,s),this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}return k(s,[{key:"define",value:function(r,t){this._keyCodeToStr[r]=t,this._strToKeyCode[t.toLowerCase()]=r}},{key:"keyCodeToStr",value:function(r){return this._keyCodeToStr[r]}},{key:"strToKeyCode",value:function(r){return this._strToKeyCode[r.toLowerCase()]||0}}]),s}(),ui=new ci,Rn=new ci,Mn=new ci,Xo=new Array(230),hi;(function(s){function o(a){return ui.keyCodeToStr(a)}s.toString=o;function r(a){return ui.strToKeyCode(a)}s.fromString=r;function t(a){return Rn.keyCodeToStr(a)}s.toUserSettingsUS=t;function e(a){return Mn.keyCodeToStr(a)}s.toUserSettingsGeneral=e;function i(a){return Rn.strToKeyCode(a)||Mn.strToKeyCode(a)}s.fromUserSettings=i;function n(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return ui.keyCodeToStr(a)}s.toElectronAccelerator=n})(hi||(hi={}));var Jo=function(){function s(o,r,t,e,i){S(this,s),this.ctrlKey=o,this.shiftKey=r,this.altKey=t,this.metaKey=e,this.keyCode=i}return k(s,[{key:"equals",value:function(r){return r instanceof s&&this.ctrlKey===r.ctrlKey&&this.shiftKey===r.shiftKey&&this.altKey===r.altKey&&this.metaKey===r.metaKey&&this.keyCode===r.keyCode}},{key:"getHashCode",value:function(){var r=this.ctrlKey?"1":"0",t=this.shiftKey?"1":"0",e=this.altKey?"1":"0",i=this.metaKey?"1":"0";return"K".concat(r).concat(t).concat(e).concat(i).concat(this.keyCode)}},{key:"isModifierKey",value:function(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}},{key:"toKeybinding",value:function(){return new Qo([this])}},{key:"isDuplicateModifierCase",value:function(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}}]),s}(),Qo=function(){function s(o){if(S(this,s),o.length===0)throw co("chords");this.chords=o}return k(s,[{key:"getHashCode",value:function(){for(var r="",t=0,e=this.chords.length;t<e;t++)t!==0&&(r+=";"),r+=this.chords[t].getHashCode();return r}},{key:"equals",value:function(r){if(r===null||this.chords.length!==r.chords.length)return!1;for(var t=0;t<this.chords.length;t++)if(!this.chords[t].equals(r.chords[t]))return!1;return!0}}]),s}();function ea(s){if(s.charCode){var o=String.fromCharCode(s.charCode).toUpperCase();return hi.fromString(o)}var r=s.keyCode;if(r===3)return 7;if(ni)switch(r){case 59:return 85;case 60:if(jo)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(Ge)return 57;break}else if(gr&&(Ge&&r===93||!Ge&&r===92))return 57;return Xo[r]||0}var ta=Ge?256:2048,ra=512,ia=1024,na=Ge?2048:256,di=function(){function s(o){var r;S(this,s),this._standardKeyboardEventBrand=!0;var t=o;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.altGraphKey=(r=t.getModifierState)===null||r===void 0?void 0:r.call(t,"AltGraph"),this.keyCode=ea(t),this.code=t.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}return k(s,[{key:"preventDefault",value:function(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}},{key:"toKeyCodeChord",value:function(){return this._asKeyCodeChord}},{key:"equals",value:function(r){return this._asKeybinding===r}},{key:"_computeKeybinding",value:function(){var r=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(r=this.keyCode);var t=0;return this.ctrlKey&&(t|=ta),this.altKey&&(t|=ra),this.shiftKey&&(t|=ia),this.metaKey&&(t|=na),t|=r,t}},{key:"_computeKeyCodeChord",value:function(){var r=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(r=this.keyCode),new Jo(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,r)}}]),s}(),An=new WeakMap;function sa(s){if(!s.parent||s.parent===s)return null;try{var o=s.location,r=s.parent.location;if(o.origin!=="null"&&r.origin!=="null"&&o.origin!==r.origin)return null}catch(t){return null}return s.parent}var oa=function(){function s(){S(this,s)}return k(s,null,[{key:"getSameOriginWindowChain",value:function(r){var t=An.get(r);if(!t){t=[],An.set(r,t);var e=r,i;do i=sa(e),i?t.push({window:new WeakRef(e),iframeElement:e.frameElement||null}):t.push({window:new WeakRef(e),iframeElement:null}),e=i;while(e)}return t.slice(0)}},{key:"getPositionOfChildWindowRelativeToAncestorWindow",value:function(r,t){if(!t||r===t)return{top:0,left:0};var e=0,i=0,n=this.getSameOriginWindowChain(r),a=Z(n),l;try{for(a.s();!(l=a.n()).done;){var u,h,c=l.value,d=c.window.deref();if(e+=(u=d==null?void 0:d.scrollY)!==null&&u!==void 0?u:0,i+=(h=d==null?void 0:d.scrollX)!==null&&h!==void 0?h:0,d===t||!c.iframeElement)break;var _=c.iframeElement.getBoundingClientRect();e+=_.top,i+=_.left}}catch(v){a.e(v)}finally{a.f()}return{top:e,left:i}}}]),s}(),It=function(){function s(o,r){S(this,s),this.timestamp=Date.now(),this.browserEvent=r,this.leftButton=r.button===0,this.middleButton=r.button===1,this.rightButton=r.button===2,this.buttons=r.buttons,this.target=r.target,this.detail=r.detail||1,r.type==="dblclick"&&(this.detail=2),this.ctrlKey=r.ctrlKey,this.shiftKey=r.shiftKey,this.altKey=r.altKey,this.metaKey=r.metaKey,typeof r.pageX=="number"?(this.posx=r.pageX,this.posy=r.pageY):(this.posx=r.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=r.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);var t=oa.getPositionOfChildWindowRelativeToAncestorWindow(o,r.view);this.posx-=t.left,this.posy-=t.top}return k(s,[{key:"preventDefault",value:function(){this.browserEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.browserEvent.stopPropagation()}}]),s}(),Tn=function(){function s(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;S(this,s),this.browserEvent=o||null,this.target=o?o.target||o.targetNode||o.srcElement:null,this.deltaY=t,this.deltaX=r;var e=!1;if(si){var i=navigator.userAgent.match(/Chrome\/(\d+)/);e=(i?parseInt(i[1]):123)<=122}if(o){var n,a=o,l=o,u=((n=o.view)===null||n===void 0?void 0:n.devicePixelRatio)||1;if(R(a.wheelDeltaY)<"u")e?this.deltaY=a.wheelDeltaY/(120*u):this.deltaY=a.wheelDeltaY/120;else if(R(l.VERTICAL_AXIS)<"u"&&l.axis===l.VERTICAL_AXIS)this.deltaY=-l.detail/3;else if(o.type==="wheel"){var h=o;h.deltaMode===h.DOM_DELTA_LINE?ni&&!Ge?this.deltaY=-o.deltaY/3:this.deltaY=-o.deltaY:this.deltaY=-o.deltaY/40}if(R(a.wheelDeltaX)<"u")bn&&Ln?this.deltaX=-(a.wheelDeltaX/120):e?this.deltaX=a.wheelDeltaX/(120*u):this.deltaX=a.wheelDeltaX/120;else if(R(l.HORIZONTAL_AXIS)<"u"&&l.axis===l.HORIZONTAL_AXIS)this.deltaX=-o.detail/3;else if(o.type==="wheel"){var c=o;c.deltaMode===c.DOM_DELTA_LINE?ni&&!Ge?this.deltaX=-o.deltaX/3:this.deltaX=-o.deltaX:this.deltaX=-o.deltaX/40}this.deltaY===0&&this.deltaX===0&&o.wheelDelta&&(e?this.deltaY=o.wheelDelta/(120*u):this.deltaY=o.wheelDelta/120)}}return k(s,[{key:"preventDefault",value:function(){var r;(r=this.browserEvent)===null||r===void 0||r.preventDefault()}},{key:"stopPropagation",value:function(){var r;(r=this.browserEvent)===null||r===void 0||r.stopPropagation()}}]),s}(),On=Object.freeze(function(s,o){var r=setTimeout(s.bind(o),0);return{dispose:function(){clearTimeout(r)}}}),In;(function(s){function o(r){return r===s.None||r===s.Cancelled||r instanceof aa?!0:!r||R(r)!="object"?!1:typeof r.isCancellationRequested=="boolean"&&typeof r.onCancellationRequested=="function"}s.isCancellationToken=o,s.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:xe.None}),s.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:On})})(In||(In={}));var aa=function(){function s(){S(this,s),this._isCancelled=!1,this._emitter=null}return k(s,[{key:"cancel",value:function(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}},{key:"isCancellationRequested",get:function(){return this._isCancelled}},{key:"onCancellationRequested",get:function(){return this._isCancelled?On:(this._emitter||(this._emitter=new M),this._emitter.event)}},{key:"dispose",value:function(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}]),s}(),Vc=Symbol("MicrotaskDelay"),fi=function(){function s(o,r){S(this,s),this._isDisposed=!1,this._token=-1,typeof o=="function"&&typeof r=="number"&&this.setIfNotSet(o,r)}return k(s,[{key:"dispose",value:function(){this.cancel(),this._isDisposed=!0}},{key:"cancel",value:function(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}},{key:"cancelAndSet",value:function(r,t){var e=this;if(this._isDisposed)throw new Yr("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(function(){e._token=-1,r()},t)}},{key:"setIfNotSet",value:function(r,t){var e=this;if(this._isDisposed)throw new Yr("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(function(){e._token=-1,r()},t))}}]),s}(),la=function(){function s(){S(this,s),this.disposable=void 0,this.isDisposed=!1}return k(s,[{key:"cancel",value:function(){var r;(r=this.disposable)!==null&&r!==void 0&&r.dispose(),this.disposable=void 0}},{key:"cancelAndSet",value:function(r,t){var e=this,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:globalThis;if(this.isDisposed)throw new Yr("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();var n=i.setInterval(function(){r()},t);this.disposable=ue(function(){i.clearInterval(n),e.disposable=void 0})}},{key:"dispose",value:function(){this.cancel(),this.isDisposed=!0}}]),s}(),ca,_i;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?_i=function(o,r){Yo(function(){if(!t){var e=Date.now()+15;r(Object.freeze({didTimeout:!0,timeRemaining:function(){return Math.max(0,e-Date.now())}}))}});var t=!1;return{dispose:function(){t||(t=!0)}}}:_i=function(o,r,t){var e=o.requestIdleCallback(r,typeof t=="number"?{timeout:t}:void 0),i=!1;return{dispose:function(){i||(i=!0,o.cancelIdleCallback(e))}}},ca=function(o){return _i(globalThis,o)}})();var Nn;(function(s){function o(e){return r.apply(this,arguments)}function r(){return r=Y(I().mark(function e(i){var n,a;return I().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,Promise.all(i.map(function(h){return h.then(function(c){return c},function(c){n||(n=c)})}));case 2:if(a=u.sent,!(R(n)<"u")){u.next=5;break}throw n;case 5:return u.abrupt("return",a);case 6:case"end":return u.stop()}},e)})),r.apply(this,arguments)}s.settled=o;function t(e){return new Promise(function(){var i=Y(I().mark(function n(a,l){return I().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,e(a,l);case 3:h.next=8;break;case 5:h.prev=5,h.t0=h.catch(0),l(h.t0);case 8:case"end":return h.stop()}},n,null,[[0,5]])}));return function(n,a){return i.apply(this,arguments)}}())}s.withAsyncBody=t})(Nn||(Nn={}));var Hn=function(s){function o(r,t){var e=this;S(this,o),this._state=0,this._results=[],this._error=null,this._onReturn=t,this._onStateChanged=new M,queueMicrotask(Y(I().mark(function i(){var n;return I().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n={emitOne:function(h){return e.emitOne(h)},emitMany:function(h){return e.emitMany(h)},reject:function(h){return e.reject(h)}},l.prev=1,l.next=4,Promise.resolve(r(n));case 4:e.resolve(),l.next=10;break;case 7:l.prev=7,l.t0=l.catch(1),e.reject(l.t0);case 10:return l.prev=10,n.emitOne=void 0,n.emitMany=void 0,n.reject=void 0,l.finish(10);case 13:case"end":return l.stop()}},i,null,[[1,7,10,13]])})))}return k(o,[{key:s,value:function(){var t=this,e=0;return{next:function(){var i=Y(I().mark(function a(){return I().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(t._state!==2){u.next=2;break}throw t._error;case 2:if(!(e<t._results.length)){u.next=4;break}return u.abrupt("return",{done:!1,value:t._results[e++]});case 4:if(t._state!==1){u.next=6;break}return u.abrupt("return",{done:!0,value:void 0});case 6:return u.next=8,xe.toPromise(t._onStateChanged.event);case 8:u.next=0;break;case 9:case"end":return u.stop()}},a)}));function n(){return i.apply(this,arguments)}return n}(),return:function(){var i=Y(I().mark(function a(){var l;return I().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",((l=t._onReturn)!==null&&l!==void 0&&l.call(t),{done:!0,value:void 0}));case 1:case"end":return h.stop()}},a)}));function n(){return i.apply(this,arguments)}return n}()}}},{key:"map",value:function(t){return o.map(this,t)}},{key:"filter",value:function(t){return o.filter(this,t)}},{key:"coalesce",value:function(){return o.coalesce(this)}},{key:"toPromise",value:function(){return o.toPromise(this)}},{key:"emitOne",value:function(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}},{key:"emitMany",value:function(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}},{key:"resolve",value:function(){this._state===0&&(this._state=1,this._onStateChanged.fire())}},{key:"reject",value:function(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}}],[{key:"fromArray",value:function(t){return new o(function(e){e.emitMany(t)})}},{key:"fromPromise",value:function(t){return new o(function(){var e=Y(I().mark(function i(n){return I().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.t0=n,l.next=3,t;case 3:l.t1=l.sent,l.t0.emitMany.call(l.t0,l.t1);case 5:case"end":return l.stop()}},i)}));return function(i){return e.apply(this,arguments)}}())}},{key:"fromPromises",value:function(t){return new o(function(){var e=Y(I().mark(function i(n){return I().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Promise.all(t.map(function(){var u=Y(I().mark(function h(c){return I().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.t0=n,_.next=3,c;case 3:return _.t1=_.sent,_.abrupt("return",_.t0.emitOne.call(_.t0,_.t1));case 5:case"end":return _.stop()}},h)}));return function(h){return u.apply(this,arguments)}}()));case 2:case"end":return l.stop()}},i)}));return function(i){return e.apply(this,arguments)}}())}},{key:"merge",value:function(t){return new o(function(){var e=Y(I().mark(function i(n){return I().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Promise.all(t.map(function(){var u=Y(I().mark(function h(c){var d,_,v,f,m,g;return I().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:d=!1,_=!1,y.prev=2,f=mt(c);case 4:return y.next=6,f.next();case 6:if(!(d=!(m=y.sent).done)){y.next=12;break}g=m.value,n.emitOne(g);case 9:d=!1,y.next=4;break;case 12:y.next=18;break;case 14:y.prev=14,y.t0=y.catch(2),_=!0,v=y.t0;case 18:if(y.prev=18,y.prev=19,!(d&&f.return!=null)){y.next=23;break}return y.next=23,f.return();case 23:if(y.prev=23,!_){y.next=26;break}throw v;case 26:return y.finish(23);case 27:return y.finish(18);case 28:case"end":return y.stop()}},h,null,[[2,14,18,28],[19,,23,27]])}));return function(h){return u.apply(this,arguments)}}()));case 2:case"end":return l.stop()}},i)}));return function(i){return e.apply(this,arguments)}}())}},{key:"map",value:function(t,e){return new o(function(){var i=Y(I().mark(function n(a){var l,u,h,c,d,_;return I().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:l=!1,u=!1,f.prev=2,c=mt(t);case 4:return f.next=6,c.next();case 6:if(!(l=!(d=f.sent).done)){f.next=12;break}_=d.value,a.emitOne(e(_));case 9:l=!1,f.next=4;break;case 12:f.next=18;break;case 14:f.prev=14,f.t0=f.catch(2),u=!0,h=f.t0;case 18:if(f.prev=18,f.prev=19,!(l&&c.return!=null)){f.next=23;break}return f.next=23,c.return();case 23:if(f.prev=23,!u){f.next=26;break}throw h;case 26:return f.finish(23);case 27:return f.finish(18);case 28:case"end":return f.stop()}},n,null,[[2,14,18,28],[19,,23,27]])}));return function(n){return i.apply(this,arguments)}}())}},{key:"filter",value:function(t,e){return new o(function(){var i=Y(I().mark(function n(a){var l,u,h,c,d,_;return I().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:l=!1,u=!1,f.prev=2,c=mt(t);case 4:return f.next=6,c.next();case 6:if(!(l=!(d=f.sent).done)){f.next=12;break}_=d.value,e(_)&&a.emitOne(_);case 9:l=!1,f.next=4;break;case 12:f.next=18;break;case 14:f.prev=14,f.t0=f.catch(2),u=!0,h=f.t0;case 18:if(f.prev=18,f.prev=19,!(l&&c.return!=null)){f.next=23;break}return f.next=23,c.return();case 23:if(f.prev=23,!u){f.next=26;break}throw h;case 26:return f.finish(23);case 27:return f.finish(18);case 28:case"end":return f.stop()}},n,null,[[2,14,18,28],[19,,23,27]])}));return function(n){return i.apply(this,arguments)}}())}},{key:"coalesce",value:function(t){return o.filter(t,function(e){return!!e})}},{key:"toPromise",value:function(){var r=Y(I().mark(function e(i){var n,a,l,u,h,c,d;return I().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:n=[],a=!1,l=!1,v.prev=3,h=mt(i);case 5:return v.next=7,h.next();case 7:if(!(a=!(c=v.sent).done)){v.next=13;break}d=c.value,n.push(d);case 10:a=!1,v.next=5;break;case 13:v.next=19;break;case 15:v.prev=15,v.t0=v.catch(3),l=!0,u=v.t0;case 19:if(v.prev=19,v.prev=20,!(a&&h.return!=null)){v.next=24;break}return v.next=24,h.return();case 24:if(v.prev=24,!l){v.next=27;break}throw u;case 27:return v.finish(24);case 28:return v.finish(19);case 29:return v.abrupt("return",n);case 30:case"end":return v.stop()}},e,null,[[3,15,19,29],[20,,24,28]])}));function t(e){return r.apply(this,arguments)}return t}()}]),o}(Symbol.asyncIterator);Hn.EMPTY=Hn.fromArray([]);var Zc=null;function ua(s){return 55296<=s&&s<=56319}function Wn(s){return 56320<=s&&s<=57343}function ha(s,o){return(s-55296<<10)+(o-56320)+65536}function da(s){return vi(s,0)}function vi(s,o){switch(R(s)){case"object":return s===null?st(349,o):Array.isArray(s)?_a(s,o):va(s,o);case"string":return Fn(s,o);case"boolean":return fa(s,o);case"number":return st(s,o);case"undefined":return st(937,o);default:return st(617,o)}}function st(s,o){return(o<<5)-o+s|0}function fa(s,o){return st(s?433:863,o)}function Fn(s,o){o=st(149417,o);for(var r=0,t=s.length;r<t;r++)o=st(s.charCodeAt(r),o);return o}function _a(s,o){return o=st(104579,o),s.reduce(function(r,t){return vi(t,r)},o)}function va(s,o){return o=st(181387,o),Object.keys(s).sort().reduce(function(r,t){return r=Fn(t,r),vi(s[t],r)},o)}function gi(s,o){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:32,t=r-o,e=~((1<<t)-1);return(s<<o|(e&s)>>>t)>>>0}function zn(s){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:s.byteLength,t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,e=0;e<r;e++)s[o+e]=t}function ga(s,o){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0";s.length<o;)s=r+s;return s}function Nt(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32;return s instanceof ArrayBuffer?Array.from(new Uint8Array(s)).map(function(r){return r.toString(16).padStart(2,"0")}).join(""):ga((s>>>0).toString(16),o/4)}var pa=function(){function s(){S(this,s),this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}return k(s,[{key:"update",value:function(r){var t=r.length;if(t!==0){var e=this._buff,i=this._buffLen,n=this._leftoverHighSurrogate,a,l;for(n!==0?(a=n,l=-1,n=0):(a=r.charCodeAt(0),l=0);;){var u=a;if(ua(a))if(l+1<t){var h=r.charCodeAt(l+1);Wn(h)?(l++,u=ha(a,h)):u=65533}else{n=a;break}else Wn(a)&&(u=65533);if(i=this._push(e,i,u),l++,l<t)a=r.charCodeAt(l);else break}this._buffLen=i,this._leftoverHighSurrogate=n}}},{key:"_push",value:function(r,t,e){return e<128?r[t++]=e:e<2048?(r[t++]=192|(e&1984)>>>6,r[t++]=128|(e&63)>>>0):e<65536?(r[t++]=224|(e&61440)>>>12,r[t++]=128|(e&4032)>>>6,r[t++]=128|(e&63)>>>0):(r[t++]=240|(e&1835008)>>>18,r[t++]=128|(e&258048)>>>12,r[t++]=128|(e&4032)>>>6,r[t++]=128|(e&63)>>>0),t>=64&&(this._step(),t-=64,this._totalLen+=64,r[0]=r[64],r[1]=r[65],r[2]=r[66]),t}},{key:"digest",value:function(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),Nt(this._h0)+Nt(this._h1)+Nt(this._h2)+Nt(this._h3)+Nt(this._h4)}},{key:"_wrapUp",value:function(){this._buff[this._buffLen++]=128,zn(this._buff,this._buffLen),this._buffLen>56&&(this._step(),zn(this._buff));var r=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(r/4294967296),!1),this._buffDV.setUint32(60,r%4294967296,!1),this._step()}},{key:"_step",value:function(){for(var r=s._bigBlock32,t=this._buffDV,e=0;e<64;e+=4)r.setUint32(e,t.getUint32(e,!1),!1);for(var i=64;i<320;i+=4)r.setUint32(i,gi(r.getUint32(i-12,!1)^r.getUint32(i-32,!1)^r.getUint32(i-56,!1)^r.getUint32(i-64,!1),1),!1);for(var n=this._h0,a=this._h1,l=this._h2,u=this._h3,h=this._h4,c,d,_,v=0;v<80;v++)v<20?(c=a&l|~a&u,d=1518500249):v<40?(c=a^l^u,d=1859775393):v<60?(c=a&l|a&u|l&u,d=2400959708):(c=a^l^u,d=3395469782),_=gi(n,5)+c+h+d+r.getUint32(v*4,!1)&4294967295,h=u,u=l,l=gi(a,30),a=n,n=_;this._h0=this._h0+n&4294967295,this._h1=this._h1+a&4294967295,this._h2=this._h2+l&4294967295,this._h3=this._h3+u&4294967295,this._h4=this._h4+h&4294967295}}]),s}();pa._bigBlock32=new DataView(new ArrayBuffer(320));var jc=null,Ze=function(){var s=new Map,o={window:We,disposables:new ht};s.set(We.vscodeWindowId,o);var r=new M,t=new M,e=new M;function i(n,a){var l;return(l=typeof n=="number"?s.get(n):void 0)!==null&&l!==void 0?l:a?o:void 0}return{onDidRegisterWindow:r.event,onWillUnregisterWindow:e.event,onDidUnregisterWindow:t.event,registerWindow:function(a){if(s.has(a.vscodeWindowId))return G.None;var l=new ht,u={window:a,disposables:l.add(new ht)};return s.set(a.vscodeWindowId,u),l.add(ue(function(){s.delete(a.vscodeWindowId),t.fire(a)})),l.add($(a,De.BEFORE_UNLOAD,function(){e.fire(a)})),r.fire(u),l},getWindows:function(){return s.values()},getWindowsCount:function(){return s.size},getWindowId:function(a){return a.vscodeWindowId},hasWindow:function(a){return s.has(a)},getWindowById:i,getWindow:function(a){var l,u=a;if(u!=null&&(l=u.ownerDocument)!==null&&l!==void 0&&l.defaultView)return u.ownerDocument.defaultView.window;var h=a;return h!=null&&h.view?h.view.window:We},getDocument:function(a){return je(a).document}}}(),qc=Ze.registerWindow,je=Ze.getWindow,$c=Ze.getDocument,Yc=Ze.getWindows,Gc=Ze.getWindowsCount,Un=Ze.getWindowId,Xc=Ze.getWindowById,Jc=Ze.hasWindow,ma=Ze.onDidRegisterWindow,Qc=Ze.onWillUnregisterWindow,eu=Ze.onDidUnregisterWindow,ya=function(){function s(o,r,t,e){S(this,s),this._node=o,this._type=r,this._handler=t,this._options=e||!1,this._node.addEventListener(this._type,this._handler,this._options)}return k(s,[{key:"dispose",value:function(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}}]),s}();function $(s,o,r,t){return new ya(s,o,r,t)}function Sa(s,o){return function(r){return o(new It(s,r))}}function ka(s){return function(o){return s(new di(o))}}var Kn=function(o,r,t,e){var i=t;return r==="click"||r==="mousedown"||r==="contextmenu"?i=Sa(je(o),t):(r==="keydown"||r==="keypress"||r==="keyup")&&(i=ka(t)),$(o,r,i,e)},ba,Cr,wa=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e.defaultTarget=t&&je(t),e}return k(r,[{key:"cancelAndSet",value:function(e,i,n){return V(K(r.prototype),"cancelAndSet",this).call(this,e,i,n!=null?n:this.defaultTarget)}}]),r}(la),pi=function(){function s(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;S(this,s),this._runner=o,this.priority=r,this._canceled=!1}return k(s,[{key:"dispose",value:function(){this._canceled=!0}},{key:"execute",value:function(){if(!this._canceled)try{this._runner()}catch(r){ur(r)}}}],[{key:"sort",value:function(r,t){return t.priority-r.priority}}]),s}();(function(){var s=new Map,o=new Map,r=new Map,t=new Map,e=function(n){var a;r.set(n,!1);var l=(a=s.get(n))!==null&&a!==void 0?a:[];for(o.set(n,l),s.set(n,[]),t.set(n,!0);l.length>0;)l.sort(pi.sort),l.shift().execute();t.set(n,!1)};Cr=function(n,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=Un(n),h=new pi(a,l),c=s.get(u);return c||(c=[],s.set(u,c)),c.push(h),r.get(u)||(r.set(u,!0),n.requestAnimationFrame(function(){return e(u)})),h},ba=function(n,a,l){var u=Un(n);if(t.get(u)){var h=new pi(a,l),c=o.get(u);return c||(c=[],o.set(u,c)),c.push(h),h}else return Cr(n,a,l)}})();var Vn=function(){function s(o,r){S(this,s),this.width=o,this.height=r}return k(s,[{key:"with",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.width,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.height;return r!==this.width||t!==this.height?new s(r,t):this}}],[{key:"is",value:function(r){return R(r)=="object"&&typeof r.height=="number"&&typeof r.width=="number"}},{key:"lift",value:function(r){return r instanceof s?r:new s(r.width,r.height)}},{key:"equals",value:function(r,t){return r===t?!0:!r||!t?!1:r.width===t.width&&r.height===t.height}}]),s}();Vn.None=new Vn(0,0);var tu=null;function Ca(s){var o=s.getBoundingClientRect(),r=je(s);return{left:o.left+r.scrollX,top:o.top+r.scrollY,width:o.width,height:o.height}}var ru=new(function(){function s(){S(this,s),this.mutationObservers=new Map}return k(s,[{key:"observe",value:function(r,t,e){var i=this,n=this.mutationObservers.get(r);n||(n=new Map,this.mutationObservers.set(r,n));var a=da(e),l=n.get(a);if(l)l.users+=1;else{var u=new M,h=new MutationObserver(function(d){return u.fire(d)});h.observe(r,e);var c=l={users:1,observer:h,onDidMutate:u.event};t.add(ue(function(){var d,_;c.users-=1,c.users===0&&(u.dispose(),h.disconnect(),(d=n)!==null&&d!==void 0&&d.delete(a),((_=n)===null||_===void 0?void 0:_.size)===0&&i.mutationObservers.delete(r))})),n.set(a,l)}return l.onDidMutate}}]),s}()),De={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:gr?"webkitAnimationStart":"animationstart",ANIMATION_END:gr?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:gr?"webkitAnimationIteration":"animationiteration"},Ea=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function Zn(s,o,r){var t,e=Ea.exec(o);if(!e)throw new Error("Bad use of emmet");for(var i=e[1]||"div",n,a=arguments.length,l=new Array(a>3?a-3:0),u=3;u<a;u++)l[u-3]=arguments[u];return s!=="http://www.w3.org/1999/xhtml"?n=document.createElementNS(s,i):n=document.createElement(i),e[3]&&(n.id=e[3]),e[4]&&(n.className=e[4].replace(/\./g," ").trim()),r&&Object.entries(r).forEach(function(h){var c=ne(h,2),d=c[0],_=c[1];R(_)>"u"||(/^on\w+$/.test(d)?n[d]=_:d==="selected"?_&&n.setAttribute(d,"true"):n.setAttribute(d,_))}),(t=n).append.apply(t,l),n}function xa(s,o){for(var r=arguments.length,t=new Array(r>2?r-2:0),e=2;e<r;e++)t[e-2]=arguments[e];return Zn.apply(void 0,["http://www.w3.org/1999/xhtml",s,o].concat(t))}xa.SVG=function(s,o){for(var r=arguments.length,t=new Array(r>2?r-2:0),e=2;e<r;e++)t[e-2]=arguments[e];return Zn.apply(void 0,["http://www.w3.org/2000/svg",s,o].concat(t))};var Da=function(){function s(o){S(this,s),this.domNode=o,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}return k(s,[{key:"setMaxWidth",value:function(r){var t=Ne(r);this._maxWidth!==t&&(this._maxWidth=t,this.domNode.style.maxWidth=this._maxWidth)}},{key:"setWidth",value:function(r){var t=Ne(r);this._width!==t&&(this._width=t,this.domNode.style.width=this._width)}},{key:"setHeight",value:function(r){var t=Ne(r);this._height!==t&&(this._height=t,this.domNode.style.height=this._height)}},{key:"setTop",value:function(r){var t=Ne(r);this._top!==t&&(this._top=t,this.domNode.style.top=this._top)}},{key:"setLeft",value:function(r){var t=Ne(r);this._left!==t&&(this._left=t,this.domNode.style.left=this._left)}},{key:"setBottom",value:function(r){var t=Ne(r);this._bottom!==t&&(this._bottom=t,this.domNode.style.bottom=this._bottom)}},{key:"setRight",value:function(r){var t=Ne(r);this._right!==t&&(this._right=t,this.domNode.style.right=this._right)}},{key:"setPaddingTop",value:function(r){var t=Ne(r);this._paddingTop!==t&&(this._paddingTop=t,this.domNode.style.paddingTop=this._paddingTop)}},{key:"setPaddingLeft",value:function(r){var t=Ne(r);this._paddingLeft!==t&&(this._paddingLeft=t,this.domNode.style.paddingLeft=this._paddingLeft)}},{key:"setPaddingBottom",value:function(r){var t=Ne(r);this._paddingBottom!==t&&(this._paddingBottom=t,this.domNode.style.paddingBottom=this._paddingBottom)}},{key:"setPaddingRight",value:function(r){var t=Ne(r);this._paddingRight!==t&&(this._paddingRight=t,this.domNode.style.paddingRight=this._paddingRight)}},{key:"setFontFamily",value:function(r){this._fontFamily!==r&&(this._fontFamily=r,this.domNode.style.fontFamily=this._fontFamily)}},{key:"setFontWeight",value:function(r){this._fontWeight!==r&&(this._fontWeight=r,this.domNode.style.fontWeight=this._fontWeight)}},{key:"setFontSize",value:function(r){var t=Ne(r);this._fontSize!==t&&(this._fontSize=t,this.domNode.style.fontSize=this._fontSize)}},{key:"setFontStyle",value:function(r){this._fontStyle!==r&&(this._fontStyle=r,this.domNode.style.fontStyle=this._fontStyle)}},{key:"setFontFeatureSettings",value:function(r){this._fontFeatureSettings!==r&&(this._fontFeatureSettings=r,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}},{key:"setFontVariationSettings",value:function(r){this._fontVariationSettings!==r&&(this._fontVariationSettings=r,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}},{key:"setTextDecoration",value:function(r){this._textDecoration!==r&&(this._textDecoration=r,this.domNode.style.textDecoration=this._textDecoration)}},{key:"setLineHeight",value:function(r){var t=Ne(r);this._lineHeight!==t&&(this._lineHeight=t,this.domNode.style.lineHeight=this._lineHeight)}},{key:"setLetterSpacing",value:function(r){var t=Ne(r);this._letterSpacing!==t&&(this._letterSpacing=t,this.domNode.style.letterSpacing=this._letterSpacing)}},{key:"setClassName",value:function(r){this._className!==r&&(this._className=r,this.domNode.className=this._className)}},{key:"toggleClassName",value:function(r,t){this.domNode.classList.toggle(r,t),this._className=this.domNode.className}},{key:"setDisplay",value:function(r){this._display!==r&&(this._display=r,this.domNode.style.display=this._display)}},{key:"setPosition",value:function(r){this._position!==r&&(this._position=r,this.domNode.style.position=this._position)}},{key:"setVisibility",value:function(r){this._visibility!==r&&(this._visibility=r,this.domNode.style.visibility=this._visibility)}},{key:"setColor",value:function(r){this._color!==r&&(this._color=r,this.domNode.style.color=this._color)}},{key:"setBackgroundColor",value:function(r){this._backgroundColor!==r&&(this._backgroundColor=r,this.domNode.style.backgroundColor=this._backgroundColor)}},{key:"setLayerHinting",value:function(r){this._layerHint!==r&&(this._layerHint=r,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}},{key:"setBoxShadow",value:function(r){this._boxShadow!==r&&(this._boxShadow=r,this.domNode.style.boxShadow=r)}},{key:"setContain",value:function(r){this._contain!==r&&(this._contain=r,this.domNode.style.contain=this._contain)}},{key:"setAttribute",value:function(r,t){this.domNode.setAttribute(r,t)}},{key:"removeAttribute",value:function(r){this.domNode.removeAttribute(r)}},{key:"appendChild",value:function(r){this.domNode.appendChild(r.domNode)}},{key:"removeChild",value:function(r){this.domNode.removeChild(r.domNode)}}]),s}();function Ne(s){return typeof s=="number"?"".concat(s,"px"):s}function Ht(s){return new Da(s)}var jn=function(){function s(){S(this,s),this._hooks=new ht,this._pointerMoveCallback=null,this._onStopCallback=null}return k(s,[{key:"dispose",value:function(){this.stopMonitoring(!1),this._hooks.dispose()}},{key:"stopMonitoring",value:function(r,t){if(this.isMonitoring()){this._hooks.clear(),this._pointerMoveCallback=null;var e=this._onStopCallback;this._onStopCallback=null,r&&e&&e(t)}}},{key:"isMonitoring",value:function(){return!!this._pointerMoveCallback}},{key:"startMonitoring",value:function(r,t,e,i,n){var a=this;this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=i,this._onStopCallback=n;var l=r;try{r.setPointerCapture(t),this._hooks.add(ue(function(){try{r.releasePointerCapture(t)}catch(u){}}))}catch(u){l=je(r)}this._hooks.add($(l,De.POINTER_MOVE,function(u){if(u.buttons!==e){a.stopMonitoring(!0);return}u.preventDefault(),a._pointerMoveCallback(u)})),this._hooks.add($(l,De.POINTER_UP,function(u){return a.stopMonitoring(!0)}))}}]),s}();function Pa(s,o,r){var t=null,e=null;if(typeof r.value=="function"?(t="value",e=r.value,e.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof r.get=="function"&&(t="get",e=r.get),!e)throw new Error("not supported");var i="$memoize$".concat(o);r[t]=function(){for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return this.hasOwnProperty(i)||Object.defineProperty(this,i,{configurable:!1,enumerable:!1,writable:!1,value:e.apply(this,a)}),this[i]}}var qe;(function(s){return s.Tap="-xterm-gesturetap",s.Change="-xterm-gesturechange",s.Start="-xterm-gesturestart",s.End="-xterm-gesturesend",s.Contextmenu="-xterm-gesturecontextmenu"})(qe||(qe={}));var Wt=function(s){z(r,s);var o=U(r);function r(){var t;return S(this,r),t=o.call(this),t.dispatched=!1,t.targets=new mn,t.ignoreTargets=new mn,t.activeTouches={},t.handle=null,t._lastSetTapCountTime=0,t._register(xe.runAndSubscribe(ma,function(e){var i=e.window,n=e.disposables;n.add($(i.document,"touchstart",function(a){return t.onTouchStart(a)},{passive:!1})),n.add($(i.document,"touchend",function(a){return t.onTouchEnd(i,a)})),n.add($(i.document,"touchmove",function(a){return t.onTouchMove(a)},{passive:!1}))},{window:We,disposables:t._store})),t}return k(r,[{key:"dispose",value:function(){this.handle&&(this.handle.dispose(),this.handle=null),V(K(r.prototype),"dispose",this).call(this)}},{key:"onTouchStart",value:function(e){var i=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(var n=0,a=e.targetTouches.length;n<a;n++){var l=e.targetTouches.item(n);this.activeTouches[l.identifier]={id:l.identifier,initialTarget:l.target,initialTimeStamp:i,initialPageX:l.pageX,initialPageY:l.pageY,rollingTimestamps:[i],rollingPageX:[l.pageX],rollingPageY:[l.pageY]};var u=this.newGestureEvent(qe.Start,l.target);u.pageX=l.pageX,u.pageY=l.pageY,this.dispatchEvent(u)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}},{key:"onTouchEnd",value:function(e,i){for(var n=this,a=Date.now(),l=Object.keys(this.activeTouches).length,u=function(){var _=i.changedTouches.item(h);if(!n.activeTouches.hasOwnProperty(String(_.identifier)))return console.warn("move of an UNKNOWN touch",_),1;var v=n.activeTouches[_.identifier],f=Date.now()-v.initialTimeStamp;if(f<r.HOLD_DELAY&&Math.abs(v.initialPageX-He(v.rollingPageX))<30&&Math.abs(v.initialPageY-He(v.rollingPageY))<30){var m=n.newGestureEvent(qe.Tap,v.initialTarget);m.pageX=He(v.rollingPageX),m.pageY=He(v.rollingPageY),n.dispatchEvent(m)}else if(f>=r.HOLD_DELAY&&Math.abs(v.initialPageX-He(v.rollingPageX))<30&&Math.abs(v.initialPageY-He(v.rollingPageY))<30){var g=n.newGestureEvent(qe.Contextmenu,v.initialTarget);g.pageX=He(v.rollingPageX),g.pageY=He(v.rollingPageY),n.dispatchEvent(g)}else if(l===1){var w=He(v.rollingPageX),y=He(v.rollingPageY),b=He(v.rollingTimestamps)-v.rollingTimestamps[0],A=w-v.rollingPageX[0],ee=y-v.rollingPageY[0],se=ae(n.targets).filter(function(he){return v.initialTarget instanceof Node&&he.contains(v.initialTarget)});n.inertia(e,se,a,Math.abs(A)/b,A>0?1:-1,w,Math.abs(ee)/b,ee>0?1:-1,y)}n.dispatchEvent(n.newGestureEvent(qe.End,v.initialTarget)),delete n.activeTouches[_.identifier]},h=0,c=i.changedTouches.length;h<c;h++)u();this.dispatched&&(i.preventDefault(),i.stopPropagation(),this.dispatched=!1)}},{key:"newGestureEvent",value:function(e,i){var n=document.createEvent("CustomEvent");return n.initEvent(e,!1,!0),n.initialTarget=i,n.tapCount=0,n}},{key:"dispatchEvent",value:function(e){if(e.type===qe.Tap){var i=new Date().getTime(),n=0;i-this._lastSetTapCountTime>r.CLEAR_TAP_COUNT_TIME?n=1:n=2,this._lastSetTapCountTime=i,e.tapCount=n}else(e.type===qe.Change||e.type===qe.Contextmenu)&&(this._lastSetTapCountTime=0);if(e.initialTarget instanceof Node){var a=Z(this.ignoreTargets),l;try{for(a.s();!(l=a.n()).done;){var u=l.value;if(u.contains(e.initialTarget))return}}catch(A){a.e(A)}finally{a.f()}var h=[],c=Z(this.targets),d;try{for(c.s();!(d=c.n()).done;){var _=d.value;if(_.contains(e.initialTarget)){for(var v=0,f=e.initialTarget;f&&f!==_;)v++,f=f.parentElement;h.push([v,_])}}}catch(A){c.e(A)}finally{c.f()}h.sort(function(A,ee){return A[0]-ee[0]});for(var m=0,g=h;m<g.length;m++){var w=ne(g[m],2),y=w[0],b=w[1];b.dispatchEvent(e),this.dispatched=!0}}}},{key:"inertia",value:function(e,i,n,a,l,u,h,c,d){var _=this;this.handle=Cr(e,function(){var v=Date.now(),f=v-n,m=0,g=0,w=!0;a+=r.SCROLL_FRICTION*f,h+=r.SCROLL_FRICTION*f,a>0&&(w=!1,m=l*a*f),h>0&&(w=!1,g=c*h*f);var y=_.newGestureEvent(qe.Change);y.translationX=m,y.translationY=g,i.forEach(function(b){return b.dispatchEvent(y)}),w||_.inertia(e,i,v,a,l,u+m,h,c,d+g)})}},{key:"onTouchMove",value:function(e){for(var i=Date.now(),n=0,a=e.changedTouches.length;n<a;n++){var l=e.changedTouches.item(n);if(!this.activeTouches.hasOwnProperty(String(l.identifier))){console.warn("end of an UNKNOWN touch",l);continue}var u=this.activeTouches[l.identifier],h=this.newGestureEvent(qe.Change,u.initialTarget);h.translationX=l.pageX-He(u.rollingPageX),h.translationY=l.pageY-He(u.rollingPageY),h.pageX=l.pageX,h.pageY=l.pageY,this.dispatchEvent(h),u.rollingPageX.length>3&&(u.rollingPageX.shift(),u.rollingPageY.shift(),u.rollingTimestamps.shift()),u.rollingPageX.push(l.pageX),u.rollingPageY.push(l.pageY),u.rollingTimestamps.push(i)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}}],[{key:"addTarget",value:function(e){if(!r.isTouchDevice())return G.None;r.INSTANCE||(r.INSTANCE=gn(new r));var i=r.INSTANCE.targets.push(e);return ue(i)}},{key:"ignoreTarget",value:function(e){if(!r.isTouchDevice())return G.None;r.INSTANCE||(r.INSTANCE=gn(new r));var i=r.INSTANCE.ignoreTargets.push(e);return ue(i)}},{key:"isTouchDevice",value:function(){return"ontouchstart"in We||navigator.maxTouchPoints>0}}]),r}(G);Wt.SCROLL_FRICTION=-.005,Wt.HOLD_DELAY=700,Wt.CLEAR_TAP_COUNT_TIME=400,ge([Pa],Wt,"isTouchDevice",1);var La=Wt,mi=function(s){z(r,s);var o=U(r);function r(){return S(this,r),o.apply(this,arguments)}return k(r,[{key:"onclick",value:function(e,i){this._register($(e,De.CLICK,function(n){return i(new It(je(e),n))}))}},{key:"onmousedown",value:function(e,i){this._register($(e,De.MOUSE_DOWN,function(n){return i(new It(je(e),n))}))}},{key:"onmouseover",value:function(e,i){this._register($(e,De.MOUSE_OVER,function(n){return i(new It(je(e),n))}))}},{key:"onmouseleave",value:function(e,i){this._register($(e,De.MOUSE_LEAVE,function(n){return i(new It(je(e),n))}))}},{key:"onkeydown",value:function(e,i){this._register($(e,De.KEY_DOWN,function(n){return i(new di(n))}))}},{key:"onkeyup",value:function(e,i){this._register($(e,De.KEY_UP,function(n){return i(new di(n))}))}},{key:"oninput",value:function(e,i){this._register($(e,De.INPUT,i))}},{key:"onblur",value:function(e,i){this._register($(e,De.BLUR,i))}},{key:"onfocus",value:function(e,i){this._register($(e,De.FOCUS,i))}},{key:"onchange",value:function(e,i){this._register($(e,De.CHANGE,i))}},{key:"ignoreGesture",value:function(e){return La.ignoreTarget(e)}}]),r}(G),qn=11,Ba=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._onActivate=t.onActivate,e.bgDomNode=document.createElement("div"),e.bgDomNode.className="arrow-background",e.bgDomNode.style.position="absolute",e.bgDomNode.style.width=t.bgWidth+"px",e.bgDomNode.style.height=t.bgHeight+"px",R(t.top)<"u"&&(e.bgDomNode.style.top="0px"),R(t.left)<"u"&&(e.bgDomNode.style.left="0px"),R(t.bottom)<"u"&&(e.bgDomNode.style.bottom="0px"),R(t.right)<"u"&&(e.bgDomNode.style.right="0px"),e.domNode=document.createElement("div"),e.domNode.className=t.className,e.domNode.style.position="absolute",e.domNode.style.width=qn+"px",e.domNode.style.height=qn+"px",R(t.top)<"u"&&(e.domNode.style.top=t.top+"px"),R(t.left)<"u"&&(e.domNode.style.left=t.left+"px"),R(t.bottom)<"u"&&(e.domNode.style.bottom=t.bottom+"px"),R(t.right)<"u"&&(e.domNode.style.right=t.right+"px"),e._pointerMoveMonitor=e._register(new jn),e._register(Kn(e.bgDomNode,De.POINTER_DOWN,function(i){return e._arrowPointerDown(i)})),e._register(Kn(e.domNode,De.POINTER_DOWN,function(i){return e._arrowPointerDown(i)})),e._pointerdownRepeatTimer=e._register(new wa),e._pointerdownScheduleRepeatTimer=e._register(new fi),e}return k(r,[{key:"_arrowPointerDown",value:function(e){var i=this;if(!(!e.target||!(e.target instanceof Element))){var n=function(){i._pointerdownRepeatTimer.cancelAndSet(function(){return i._onActivate()},1e3/24,je(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(n,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,function(a){},function(){i._pointerdownRepeatTimer.cancel(),i._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}}}]),r}(mi),Ra=function(){function s(o,r,t,e,i,n,a){S(this,s),this._forceIntegerValues=o,this._scrollStateBrand=void 0,this._forceIntegerValues&&(r=r|0,t=t|0,e=e|0,i=i|0,n=n|0,a=a|0),this.rawScrollLeft=e,this.rawScrollTop=a,r<0&&(r=0),e+r>t&&(e=t-r),e<0&&(e=0),i<0&&(i=0),a+i>n&&(a=n-i),a<0&&(a=0),this.width=r,this.scrollWidth=t,this.scrollLeft=e,this.height=i,this.scrollHeight=n,this.scrollTop=a}return k(s,[{key:"equals",value:function(r){return this.rawScrollLeft===r.rawScrollLeft&&this.rawScrollTop===r.rawScrollTop&&this.width===r.width&&this.scrollWidth===r.scrollWidth&&this.scrollLeft===r.scrollLeft&&this.height===r.height&&this.scrollHeight===r.scrollHeight&&this.scrollTop===r.scrollTop}},{key:"withScrollDimensions",value:function(r,t){return new s(this._forceIntegerValues,R(r.width)<"u"?r.width:this.width,R(r.scrollWidth)<"u"?r.scrollWidth:this.scrollWidth,t?this.rawScrollLeft:this.scrollLeft,R(r.height)<"u"?r.height:this.height,R(r.scrollHeight)<"u"?r.scrollHeight:this.scrollHeight,t?this.rawScrollTop:this.scrollTop)}},{key:"withScrollPosition",value:function(r){return new s(this._forceIntegerValues,this.width,this.scrollWidth,R(r.scrollLeft)<"u"?r.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,R(r.scrollTop)<"u"?r.scrollTop:this.rawScrollTop)}},{key:"createScrollEvent",value:function(r,t){var e=this.width!==r.width,i=this.scrollWidth!==r.scrollWidth,n=this.scrollLeft!==r.scrollLeft,a=this.height!==r.height,l=this.scrollHeight!==r.scrollHeight,u=this.scrollTop!==r.scrollTop;return{inSmoothScrolling:t,oldWidth:r.width,oldScrollWidth:r.scrollWidth,oldScrollLeft:r.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:r.height,oldScrollHeight:r.scrollHeight,oldScrollTop:r.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:e,scrollWidthChanged:i,scrollLeftChanged:n,heightChanged:a,scrollHeightChanged:l,scrollTopChanged:u}}}]),s}(),Ma=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._scrollableBrand=void 0,e._onScroll=e._register(new M),e.onScroll=e._onScroll.event,e._smoothScrollDuration=t.smoothScrollDuration,e._scheduleAtNextAnimationFrame=t.scheduleAtNextAnimationFrame,e._state=new Ra(t.forceIntegerValues,0,0,0,0,0,0),e._smoothScrolling=null,e}return k(r,[{key:"dispose",value:function(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),V(K(r.prototype),"dispose",this).call(this)}},{key:"setSmoothScrollDuration",value:function(e){this._smoothScrollDuration=e}},{key:"validateScrollPosition",value:function(e){return this._state.withScrollPosition(e)}},{key:"getScrollDimensions",value:function(){return this._state}},{key:"setScrollDimensions",value:function(e,i){var n,a=this._state.withScrollDimensions(e,i);this._setState(a,!!this._smoothScrolling),(n=this._smoothScrolling)===null||n===void 0||n.acceptScrollDimensions(this._state)}},{key:"getFutureScrollPosition",value:function(){return this._smoothScrolling?this._smoothScrolling.to:this._state}},{key:"getCurrentScrollPosition",value:function(){return this._state}},{key:"setScrollPositionNow",value:function(e){var i=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(i,!1)}},{key:"setScrollPositionSmooth",value:function(e,i){var n=this;if(this._smoothScrollDuration===0)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:R(e.scrollLeft)>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:R(e.scrollTop)>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};var a=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===a.scrollLeft&&this._smoothScrolling.to.scrollTop===a.scrollTop)return;var l;i?l=new Yn(this._smoothScrolling.from,a,this._smoothScrolling.startTime,this._smoothScrolling.duration):l=this._smoothScrolling.combine(this._state,a,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=l}else{var u=this._state.withScrollPosition(e);this._smoothScrolling=Yn.start(this._state,u,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(function(){n._smoothScrolling&&(n._smoothScrolling.animationFrameDisposable=null,n._performSmoothScrolling())})}},{key:"hasPendingScrollAnimation",value:function(){return!!this._smoothScrolling}},{key:"_performSmoothScrolling",value:function(){var e=this;if(this._smoothScrolling){var i=this._smoothScrolling.tick(),n=this._state.withScrollPosition(i);if(this._setState(n,!0),!!this._smoothScrolling){if(i.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(function(){e._smoothScrolling&&(e._smoothScrolling.animationFrameDisposable=null,e._performSmoothScrolling())})}}}},{key:"_setState",value:function(e,i){var n=this._state;n.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(n,i)))}}]),r}(G),$n=k(function s(o,r,t){S(this,s),this.scrollLeft=o,this.scrollTop=r,this.isDone=t});function yi(s,o){var r=o-s;return function(t){return s+r*Oa(t)}}function Aa(s,o,r){return function(t){return t<r?s(t/r):o((t-r)/(1-r))}}var Yn=function(){function s(o,r,t,e){S(this,s),this.from=o,this.to=r,this.duration=e,this.startTime=t,this.animationFrameDisposable=null,this._initAnimations()}return k(s,[{key:"_initAnimations",value:function(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}},{key:"_initAnimation",value:function(r,t,e){if(Math.abs(r-t)>2.5*e){var i,n;return r<t?(i=r+.75*e,n=t-.75*e):(i=r-.75*e,n=t+.75*e),Aa(yi(r,i),yi(n,t),.33)}return yi(r,t)}},{key:"dispose",value:function(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}},{key:"acceptScrollDimensions",value:function(r){this.to=r.withScrollPosition(this.to),this._initAnimations()}},{key:"tick",value:function(){return this._tick(Date.now())}},{key:"_tick",value:function(r){var t=(r-this.startTime)/this.duration;if(t<1){var e=this.scrollLeft(t),i=this.scrollTop(t);return new $n(e,i,!1)}return new $n(this.to.scrollLeft,this.to.scrollTop,!0)}},{key:"combine",value:function(r,t,e){return s.start(r,t,e)}}],[{key:"start",value:function(r,t,e){e=e+10;var i=Date.now()-10;return new s(r,t,i,e)}}]),s}();function Ta(s){return Math.pow(s,3)}function Oa(s){return 1-Ta(1-s)}var Ia=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;return S(this,r),n=o.call(this),n._visibility=t,n._visibleClassName=e,n._invisibleClassName=i,n._domNode=null,n._isVisible=!1,n._isNeeded=!1,n._rawShouldBeVisible=!1,n._shouldBeVisible=!1,n._revealTimer=n._register(new fi),n}return k(r,[{key:"setVisibility",value:function(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}},{key:"setShouldBeVisible",value:function(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}},{key:"_applyVisibilitySetting",value:function(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}},{key:"_updateShouldBeVisible",value:function(){var e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}},{key:"setIsNeeded",value:function(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}},{key:"setDomNode",value:function(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}},{key:"ensureVisibility",value:function(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}},{key:"_reveal",value:function(){var e=this;this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(function(){var i;(i=e._domNode)===null||i===void 0||i.setClassName(e._visibleClassName)},0))}},{key:"_hide",value:function(e){var i;this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,(i=this._domNode)===null||i===void 0||i.setClassName(this._invisibleClassName+(e?" fade":"")))}}]),r}(G),Na=140,Gn=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._lazyRender=t.lazyRender,e._host=t.host,e._scrollable=t.scrollable,e._scrollByPage=t.scrollByPage,e._scrollbarState=t.scrollbarState,e._visibilityController=e._register(new Ia(t.visibility,"visible scrollbar "+t.extraScrollbarClassName,"invisible scrollbar "+t.extraScrollbarClassName)),e._visibilityController.setIsNeeded(e._scrollbarState.isNeeded()),e._pointerMoveMonitor=e._register(new jn),e._shouldRender=!0,e.domNode=Ht(document.createElement("div")),e.domNode.setAttribute("role","presentation"),e.domNode.setAttribute("aria-hidden","true"),e._visibilityController.setDomNode(e.domNode),e.domNode.setPosition("absolute"),e._register($(e.domNode.domNode,De.POINTER_DOWN,function(i){return e._domNodePointerDown(i)})),e}return k(r,[{key:"_createArrow",value:function(e){var i=this._register(new Ba(e));this.domNode.domNode.appendChild(i.bgDomNode),this.domNode.domNode.appendChild(i.domNode)}},{key:"_createSlider",value:function(e,i,n,a){var l=this;this.slider=Ht(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(i),typeof n=="number"&&this.slider.setWidth(n),typeof a=="number"&&this.slider.setHeight(a),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register($(this.slider.domNode,De.POINTER_DOWN,function(u){u.button===0&&(u.preventDefault(),l._sliderPointerDown(u))})),this.onclick(this.slider.domNode,function(u){u.leftButton&&u.stopPropagation()})}},{key:"_onElementSize",value:function(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}},{key:"_onElementScrollSize",value:function(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}},{key:"_onElementScrollPosition",value:function(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}},{key:"beginReveal",value:function(){this._visibilityController.setShouldBeVisible(!0)}},{key:"beginHide",value:function(){this._visibilityController.setShouldBeVisible(!1)}},{key:"render",value:function(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}},{key:"_domNodePointerDown",value:function(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}},{key:"delegatePointerDown",value:function(e){var i=this.domNode.domNode.getClientRects()[0].top,n=i+this._scrollbarState.getSliderPosition(),a=i+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),l=this._sliderPointerPosition(e);n<=l&&l<=a?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}},{key:"_onPointerDown",value:function(e){var i,n;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")i=e.offsetX,n=e.offsetY;else{var a=Ca(this.domNode.domNode);i=e.pageX-a.left,n=e.pageY-a.top}var l=this._pointerDownRelativePosition(i,n);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(l):this._scrollbarState.getDesiredScrollPositionFromOffset(l)),e.button===0&&(e.preventDefault(),this._sliderPointerDown(e))}},{key:"_sliderPointerDown",value:function(e){var i=this;if(!(!e.target||!(e.target instanceof Element))){var n=this._sliderPointerPosition(e),a=this._sliderOrthogonalPointerPosition(e),l=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,function(u){var h=i._sliderOrthogonalPointerPosition(u),c=Math.abs(h-a);if(Ln&&c>Na){i._setDesiredScrollPositionNow(l.getScrollPosition());return}var d=i._sliderPointerPosition(u)-n;i._setDesiredScrollPositionNow(l.getDesiredScrollPositionFromDelta(d))},function(){i.slider.toggleClassName("active",!1),i._host.onDragEnd()}),this._host.onDragStart()}}},{key:"_setDesiredScrollPositionNow",value:function(e){var i={};this.writeScrollPosition(i,e),this._scrollable.setScrollPositionNow(i)}},{key:"updateScrollbarSize",value:function(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}},{key:"isNeeded",value:function(){return this._scrollbarState.isNeeded()}}]),r}(mi),Xn=function(){function s(o,r,t,e,i,n){S(this,s),this._scrollbarSize=Math.round(r),this._oppositeScrollbarSize=Math.round(t),this._arrowSize=Math.round(o),this._visibleSize=e,this._scrollSize=i,this._scrollPosition=n,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}return k(s,[{key:"clone",value:function(){return new s(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}},{key:"setVisibleSize",value:function(r){var t=Math.round(r);return this._visibleSize!==t?(this._visibleSize=t,this._refreshComputedValues(),!0):!1}},{key:"setScrollSize",value:function(r){var t=Math.round(r);return this._scrollSize!==t?(this._scrollSize=t,this._refreshComputedValues(),!0):!1}},{key:"setScrollPosition",value:function(r){var t=Math.round(r);return this._scrollPosition!==t?(this._scrollPosition=t,this._refreshComputedValues(),!0):!1}},{key:"setScrollbarSize",value:function(r){this._scrollbarSize=Math.round(r)}},{key:"setOppositeScrollbarSize",value:function(r){this._oppositeScrollbarSize=Math.round(r)}},{key:"_refreshComputedValues",value:function(){var r=s._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=r.computedAvailableSize,this._computedIsNeeded=r.computedIsNeeded,this._computedSliderSize=r.computedSliderSize,this._computedSliderRatio=r.computedSliderRatio,this._computedSliderPosition=r.computedSliderPosition}},{key:"getArrowSize",value:function(){return this._arrowSize}},{key:"getScrollPosition",value:function(){return this._scrollPosition}},{key:"getRectangleLargeSize",value:function(){return this._computedAvailableSize}},{key:"getRectangleSmallSize",value:function(){return this._scrollbarSize}},{key:"isNeeded",value:function(){return this._computedIsNeeded}},{key:"getSliderSize",value:function(){return this._computedSliderSize}},{key:"getSliderPosition",value:function(){return this._computedSliderPosition}},{key:"getDesiredScrollPositionFromOffset",value:function(r){if(!this._computedIsNeeded)return 0;var t=r-this._arrowSize-this._computedSliderSize/2;return Math.round(t/this._computedSliderRatio)}},{key:"getDesiredScrollPositionFromOffsetPaged",value:function(r){if(!this._computedIsNeeded)return 0;var t=r-this._arrowSize,e=this._scrollPosition;return t<this._computedSliderPosition?e-=this._visibleSize:e+=this._visibleSize,e}},{key:"getDesiredScrollPositionFromDelta",value:function(r){if(!this._computedIsNeeded)return 0;var t=this._computedSliderPosition+r;return Math.round(t/this._computedSliderRatio)}}],[{key:"_computeValues",value:function(r,t,e,i,n){var a=Math.max(0,e-r),l=Math.max(0,a-2*t),u=i>0&&i>e;if(!u)return{computedAvailableSize:Math.round(a),computedIsNeeded:u,computedSliderSize:Math.round(l),computedSliderRatio:0,computedSliderPosition:0};var h=Math.round(Math.max(20,Math.floor(e*l/i))),c=(l-h)/(i-e),d=n*c;return{computedAvailableSize:Math.round(a),computedIsNeeded:u,computedSliderSize:Math.round(h),computedSliderRatio:c,computedSliderPosition:Math.round(d)}}}]),s}(),Ha=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;S(this,r);var a=t.getScrollDimensions(),l=t.getCurrentScrollPosition();if(n=o.call(this,{lazyRender:e.lazyRender,host:i,scrollbarState:new Xn(e.horizontalHasArrows?e.arrowSize:0,e.horizontal===2?0:e.horizontalScrollbarSize,e.vertical===2?0:e.verticalScrollbarSize,a.width,a.scrollWidth,l.scrollLeft),visibility:e.horizontal,extraScrollbarClassName:"horizontal",scrollable:t,scrollByPage:e.scrollByPage}),e.horizontalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");return n._createSlider(Math.floor((e.horizontalScrollbarSize-e.horizontalSliderSize)/2),0,void 0,e.horizontalSliderSize),F(n)}return k(r,[{key:"_updateSlider",value:function(e,i){this.slider.setWidth(e),this.slider.setLeft(i)}},{key:"_renderDomNode",value:function(e,i){this.domNode.setWidth(e),this.domNode.setHeight(i),this.domNode.setLeft(0),this.domNode.setBottom(0)}},{key:"onDidScroll",value:function(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}},{key:"_pointerDownRelativePosition",value:function(e,i){return e}},{key:"_sliderPointerPosition",value:function(e){return e.pageX}},{key:"_sliderOrthogonalPointerPosition",value:function(e){return e.pageY}},{key:"_updateScrollbarSize",value:function(e){this.slider.setHeight(e)}},{key:"writeScrollPosition",value:function(e,i){e.scrollLeft=i}},{key:"updateOptions",value:function(e){this.updateScrollbarSize(e.horizontal===2?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}}]),r}(Gn),Wa=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;S(this,r);var a=t.getScrollDimensions(),l=t.getCurrentScrollPosition();if(n=o.call(this,{lazyRender:e.lazyRender,host:i,scrollbarState:new Xn(e.verticalHasArrows?e.arrowSize:0,e.vertical===2?0:e.verticalScrollbarSize,0,a.height,a.scrollHeight,l.scrollTop),visibility:e.vertical,extraScrollbarClassName:"vertical",scrollable:t,scrollByPage:e.scrollByPage}),e.verticalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");return n._createSlider(0,Math.floor((e.verticalScrollbarSize-e.verticalSliderSize)/2),e.verticalSliderSize,void 0),F(n)}return k(r,[{key:"_updateSlider",value:function(e,i){this.slider.setHeight(e),this.slider.setTop(i)}},{key:"_renderDomNode",value:function(e,i){this.domNode.setWidth(i),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}},{key:"onDidScroll",value:function(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}},{key:"_pointerDownRelativePosition",value:function(e,i){return i}},{key:"_sliderPointerPosition",value:function(e){return e.pageY}},{key:"_sliderOrthogonalPointerPosition",value:function(e){return e.pageX}},{key:"_updateScrollbarSize",value:function(e){this.slider.setWidth(e)}},{key:"writeScrollPosition",value:function(e,i){e.scrollTop=i}},{key:"updateOptions",value:function(e){this.updateScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}}]),r}(Gn),Fa=500,Jn=50,Qn=!0,za=k(function s(o,r,t){S(this,s),this.timestamp=o,this.deltaX=r,this.deltaY=t,this.score=0}),Si=function(){function s(){S(this,s),this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}return k(s,[{key:"isPhysicalMouseWheel",value:function(){if(this._front===-1&&this._rear===-1)return!1;var r=1,t=0,e=1,i=this._rear;do{var n=i===this._front?r:Math.pow(2,-e);if(r-=n,t+=this._memory[i].score*n,i===this._front)break;i=(this._capacity+i-1)%this._capacity,e++}while(!0);return t<=.5}},{key:"acceptStandardWheelEvent",value:function(r){if(si){var t=je(r.browserEvent),e=Io(t);this.accept(Date.now(),r.deltaX*e,r.deltaY*e)}else this.accept(Date.now(),r.deltaX,r.deltaY)}},{key:"accept",value:function(r,t,e){var i=null,n=new za(r,t,e);this._front===-1&&this._rear===-1?(this._memory[0]=n,this._front=0,this._rear=0):(i=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=n),n.score=this._computeScore(n,i)}},{key:"_computeScore",value:function(r,t){if(Math.abs(r.deltaX)>0&&Math.abs(r.deltaY)>0)return 1;var e=.5;if((!this._isAlmostInt(r.deltaX)||!this._isAlmostInt(r.deltaY))&&(e+=.25),t){var i=Math.abs(r.deltaX),n=Math.abs(r.deltaY),a=Math.abs(t.deltaX),l=Math.abs(t.deltaY),u=Math.max(Math.min(i,a),1),h=Math.max(Math.min(n,l),1),c=Math.max(i,a),d=Math.max(n,l);c%u===0&&d%h===0&&(e-=.5)}return Math.min(Math.max(e,0),1)}},{key:"_isAlmostInt",value:function(r){return Math.abs(Math.round(r)-r)<.01}}]),s}();Si.INSTANCE=new Si;var Ua=Si,Ka=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;S(this,r),n=o.call(this),n._onScroll=n._register(new M),n.onScroll=n._onScroll.event,n._onWillScroll=n._register(new M),n.onWillScroll=n._onWillScroll.event,n._options=Za(e),n._scrollable=i,n._register(n._scrollable.onScroll(function(l){n._onWillScroll.fire(l),n._onDidScroll(l),n._onScroll.fire(l)}));var a={onMouseWheel:function(u){return n._onMouseWheel(u)},onDragStart:function(){return n._onDragStart()},onDragEnd:function(){return n._onDragEnd()}};return n._verticalScrollbar=n._register(new Wa(n._scrollable,n._options,a)),n._horizontalScrollbar=n._register(new Ha(n._scrollable,n._options,a)),n._domNode=document.createElement("div"),n._domNode.className="xterm-scrollable-element "+n._options.className,n._domNode.setAttribute("role","presentation"),n._domNode.style.position="relative",n._domNode.appendChild(t),n._domNode.appendChild(n._horizontalScrollbar.domNode.domNode),n._domNode.appendChild(n._verticalScrollbar.domNode.domNode),n._options.useShadows?(n._leftShadowDomNode=Ht(document.createElement("div")),n._leftShadowDomNode.setClassName("shadow"),n._domNode.appendChild(n._leftShadowDomNode.domNode),n._topShadowDomNode=Ht(document.createElement("div")),n._topShadowDomNode.setClassName("shadow"),n._domNode.appendChild(n._topShadowDomNode.domNode),n._topLeftShadowDomNode=Ht(document.createElement("div")),n._topLeftShadowDomNode.setClassName("shadow"),n._domNode.appendChild(n._topLeftShadowDomNode.domNode)):(n._leftShadowDomNode=null,n._topShadowDomNode=null,n._topLeftShadowDomNode=null),n._listenOnDomNode=n._options.listenOnDomNode||n._domNode,n._mouseWheelToDispose=[],n._setListeningToMouseWheel(n._options.handleMouseWheel),n.onmouseover(n._listenOnDomNode,function(l){return n._onMouseOver(l)}),n.onmouseleave(n._listenOnDomNode,function(l){return n._onMouseLeave(l)}),n._hideTimeout=n._register(new fi),n._isDragging=!1,n._mouseIsOver=!1,n._shouldRender=!0,n._revealOnScroll=!0,n}return k(r,[{key:"options",get:function(){return this._options}},{key:"dispose",value:function(){this._mouseWheelToDispose=kt(this._mouseWheelToDispose),V(K(r.prototype),"dispose",this).call(this)}},{key:"getDomNode",value:function(){return this._domNode}},{key:"getOverviewRulerLayoutInfo",value:function(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}},{key:"delegateVerticalScrollbarPointerDown",value:function(e){this._verticalScrollbar.delegatePointerDown(e)}},{key:"getScrollDimensions",value:function(){return this._scrollable.getScrollDimensions()}},{key:"setScrollDimensions",value:function(e){this._scrollable.setScrollDimensions(e,!1)}},{key:"updateClassName",value:function(e){this._options.className=e,Ge&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}},{key:"updateOptions",value:function(e){R(e.handleMouseWheel)<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),R(e.mouseWheelScrollSensitivity)<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),R(e.fastScrollSensitivity)<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),R(e.scrollPredominantAxis)<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),R(e.horizontal)<"u"&&(this._options.horizontal=e.horizontal),R(e.vertical)<"u"&&(this._options.vertical=e.vertical),R(e.horizontalScrollbarSize)<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),R(e.verticalScrollbarSize)<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),R(e.scrollByPage)<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}},{key:"setRevealOnScroll",value:function(e){this._revealOnScroll=e}},{key:"delegateScrollFromMouseWheelEvent",value:function(e){this._onMouseWheel(new Tn(e))}},{key:"_setListeningToMouseWheel",value:function(e){var i=this;if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=kt(this._mouseWheelToDispose),e)){var n=function(l){i._onMouseWheel(new Tn(l))};this._mouseWheelToDispose.push($(this._listenOnDomNode,De.MOUSE_WHEEL,n,{passive:!1}))}}},{key:"_onMouseWheel",value:function(e){var i;if(!((i=e.browserEvent)!==null&&i!==void 0&&i.defaultPrevented)){var n=Ua.INSTANCE;Qn&&n.acceptStandardWheelEvent(e);var a=!1;if(e.deltaY||e.deltaX){var l,u=e.deltaY*this._options.mouseWheelScrollSensitivity,h=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&h+u===0?h=u=0:Math.abs(u)>=Math.abs(h)?h=0:u=0),this._options.flipAxes&&(l=[h,u],u=l[0],h=l[1]);var c=!Ge&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||c)&&!h&&(h=u,u=0),e.browserEvent&&e.browserEvent.altKey&&(h=h*this._options.fastScrollSensitivity,u=u*this._options.fastScrollSensitivity);var d=this._scrollable.getFutureScrollPosition(),_={};if(u){var v=Jn*u,f=d.scrollTop-(v<0?Math.floor(v):Math.ceil(v));this._verticalScrollbar.writeScrollPosition(_,f)}if(h){var m=Jn*h,g=d.scrollLeft-(m<0?Math.floor(m):Math.ceil(m));this._horizontalScrollbar.writeScrollPosition(_,g)}_=this._scrollable.validateScrollPosition(_),(d.scrollLeft!==_.scrollLeft||d.scrollTop!==_.scrollTop)&&(Qn&&this._options.mouseWheelSmoothScroll&&n.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(_):this._scrollable.setScrollPositionNow(_),a=!0)}var w=a;!w&&this._options.alwaysConsumeMouseWheel&&(w=!0),!w&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(w=!0),w&&(e.preventDefault(),e.stopPropagation())}}},{key:"_onDidScroll",value:function(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}},{key:"renderNow",value:function(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}},{key:"_render",value:function(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){var e=this._scrollable.getCurrentScrollPosition(),i=e.scrollTop>0,n=e.scrollLeft>0,a=n?" left":"",l=i?" top":"",u=n||i?" top-left-corner":"";this._leftShadowDomNode.setClassName("shadow".concat(a)),this._topShadowDomNode.setClassName("shadow".concat(l)),this._topLeftShadowDomNode.setClassName("shadow".concat(u).concat(l).concat(a))}}},{key:"_onDragStart",value:function(){this._isDragging=!0,this._reveal()}},{key:"_onDragEnd",value:function(){this._isDragging=!1,this._hide()}},{key:"_onMouseLeave",value:function(e){this._mouseIsOver=!1,this._hide()}},{key:"_onMouseOver",value:function(e){this._mouseIsOver=!0,this._reveal()}},{key:"_reveal",value:function(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}},{key:"_hide",value:function(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}},{key:"_scheduleHide",value:function(){var e=this;!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(function(){return e._hide()},Fa)}}]),r}(mi),Va=function(s){z(r,s);var o=U(r);function r(t,e,i){return S(this,r),o.call(this,t,e,i)}return k(r,[{key:"setScrollPosition",value:function(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}},{key:"getScrollPosition",value:function(){return this._scrollable.getCurrentScrollPosition()}}]),r}(Ka);function Za(s){var o={lazyRender:R(s.lazyRender)<"u"?s.lazyRender:!1,className:R(s.className)<"u"?s.className:"",useShadows:R(s.useShadows)<"u"?s.useShadows:!0,handleMouseWheel:R(s.handleMouseWheel)<"u"?s.handleMouseWheel:!0,flipAxes:R(s.flipAxes)<"u"?s.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:R(s.consumeMouseWheelIfScrollbarIsNeeded)<"u"?s.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:R(s.alwaysConsumeMouseWheel)<"u"?s.alwaysConsumeMouseWheel:!1,scrollYToX:R(s.scrollYToX)<"u"?s.scrollYToX:!1,mouseWheelScrollSensitivity:R(s.mouseWheelScrollSensitivity)<"u"?s.mouseWheelScrollSensitivity:1,fastScrollSensitivity:R(s.fastScrollSensitivity)<"u"?s.fastScrollSensitivity:5,scrollPredominantAxis:R(s.scrollPredominantAxis)<"u"?s.scrollPredominantAxis:!0,mouseWheelSmoothScroll:R(s.mouseWheelSmoothScroll)<"u"?s.mouseWheelSmoothScroll:!0,arrowSize:R(s.arrowSize)<"u"?s.arrowSize:11,listenOnDomNode:R(s.listenOnDomNode)<"u"?s.listenOnDomNode:null,horizontal:R(s.horizontal)<"u"?s.horizontal:1,horizontalScrollbarSize:R(s.horizontalScrollbarSize)<"u"?s.horizontalScrollbarSize:10,horizontalSliderSize:R(s.horizontalSliderSize)<"u"?s.horizontalSliderSize:0,horizontalHasArrows:R(s.horizontalHasArrows)<"u"?s.horizontalHasArrows:!1,vertical:R(s.vertical)<"u"?s.vertical:1,verticalScrollbarSize:R(s.verticalScrollbarSize)<"u"?s.verticalScrollbarSize:10,verticalHasArrows:R(s.verticalHasArrows)<"u"?s.verticalHasArrows:!1,verticalSliderSize:R(s.verticalSliderSize)<"u"?s.verticalSliderSize:0,scrollByPage:R(s.scrollByPage)<"u"?s.scrollByPage:!1};return o.horizontalSliderSize=R(s.horizontalSliderSize)<"u"?s.horizontalSliderSize:o.horizontalScrollbarSize,o.verticalSliderSize=R(s.verticalSliderSize)<"u"?s.verticalSliderSize:o.verticalScrollbarSize,Ge&&(o.className+=" mac"),o}var ki=function(s){z(r,s);var o=U(r);function r(t,e,i,n,a,l,u,h){var c;S(this,r),c=o.call(this),c._bufferService=i,c._optionsService=u,c._renderService=h,c._onRequestScrollLines=c._register(new M),c.onRequestScrollLines=c._onRequestScrollLines.event,c._isSyncing=!1,c._isHandlingScroll=!1,c._suppressOnScrollHandler=!1;var d=c._register(new Ma({forceIntegerValues:!1,smoothScrollDuration:c._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:function(v){return Cr(n.window,v)}}));return c._register(c._optionsService.onSpecificOptionChange("smoothScrollDuration",function(){d.setSmoothScrollDuration(c._optionsService.rawOptions.smoothScrollDuration)})),c._scrollableElement=c._register(new Va(e,J({vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0},c._getChangeOptions()),d)),c._register(c._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],function(){return c._scrollableElement.updateOptions(c._getChangeOptions())})),c._register(a.onProtocolChange(function(_){c._scrollableElement.updateOptions({handleMouseWheel:!(_&16)})})),c._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),c._register(xe.runAndSubscribe(l.onChangeColors,function(){c._scrollableElement.getDomNode().style.backgroundColor=l.colors.background.css})),t.appendChild(c._scrollableElement.getDomNode()),c._register(ue(function(){return c._scrollableElement.getDomNode().remove()})),c._styleElement=n.mainDocument.createElement("style"),e.appendChild(c._styleElement),c._register(ue(function(){return c._styleElement.remove()})),c._register(xe.runAndSubscribe(l.onChangeColors,function(){c._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {","  background: ".concat(l.colors.scrollbarSliderBackground.css,";"),"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {","  background: ".concat(l.colors.scrollbarSliderHoverBackground.css,";"),"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {","  background: ".concat(l.colors.scrollbarSliderActiveBackground.css,";"),"}"].join(`
`)})),c._register(c._bufferService.onResize(function(){return c.queueSync()})),c._register(c._bufferService.buffers.onBufferActivate(function(){c._latestYDisp=void 0,c.queueSync()})),c._register(c._bufferService.onScroll(function(){return c._sync()})),c._register(c._scrollableElement.onScroll(function(_){return c._handleScroll(_)})),c}return k(r,[{key:"scrollLines",value:function(e){var i=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:i.scrollTop+e*this._renderService.dimensions.css.cell.height})}},{key:"scrollToLine",value:function(e,i){i&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!i,scrollTop:e*this._renderService.dimensions.css.cell.height})}},{key:"_getChangeOptions",value:function(){var e;return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:((e=this._optionsService.rawOptions.overviewRuler)===null||e===void 0?void 0:e.width)||14}}},{key:"queueSync",value:function(e){var i=this;e!==void 0&&(this._latestYDisp=e),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(function(){i._queuedAnimationFrame=void 0,i._sync(i._latestYDisp)}))}},{key:"_sync",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._bufferService.buffer.ydisp;!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}},{key:"_handleScroll",value:function(e){if(!(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)){this._isHandlingScroll=!0;var i=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),n=i-this._bufferService.buffer.ydisp;n!==0&&(this._latestYDisp=i,this._onRequestScrollLines.fire(n)),this._isHandlingScroll=!1}}}]),r}(G);ki=ge([T(2,Te),T(3,tt),T(4,an),T(5,Dt),T(6,Oe),T(7,rt)],ki);var bi=function(s){z(r,s);var o=U(r);function r(t,e,i,n,a){var l;return S(this,r),l=o.call(this),l._screenElement=t,l._bufferService=e,l._coreBrowserService=i,l._decorationService=n,l._renderService=a,l._decorationElements=new Map,l._altBufferIsActive=!1,l._dimensionsChanged=!1,l._container=document.createElement("div"),l._container.classList.add("xterm-decoration-container"),l._screenElement.appendChild(l._container),l._register(l._renderService.onRenderedViewportChange(function(){return l._doRefreshDecorations()})),l._register(l._renderService.onDimensionsChange(function(){l._dimensionsChanged=!0,l._queueRefresh()})),l._register(l._coreBrowserService.onDprChange(function(){return l._queueRefresh()})),l._register(l._bufferService.buffers.onBufferActivate(function(){l._altBufferIsActive=l._bufferService.buffer===l._bufferService.buffers.alt})),l._register(l._decorationService.onDecorationRegistered(function(){return l._queueRefresh()})),l._register(l._decorationService.onDecorationRemoved(function(u){return l._removeDecoration(u)})),l._register(ue(function(){l._container.remove(),l._decorationElements.clear()})),l}return k(r,[{key:"_queueRefresh",value:function(){var e=this;this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(function(){e._doRefreshDecorations(),e._animationFrame=void 0}))}},{key:"_doRefreshDecorations",value:function(){var e=Z(this._decorationService.decorations),i;try{for(e.s();!(i=e.n()).done;){var n=i.value;this._renderDecoration(n)}}catch(a){e.e(a)}finally{e.f()}this._dimensionsChanged=!1}},{key:"_renderDecoration",value:function(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}},{key:"_createElement",value:function(e){var i,n,a=this._coreBrowserService.mainDocument.createElement("div");a.classList.add("xterm-decoration"),a.classList.toggle("xterm-decoration-top-layer",(e==null||(i=e.options)===null||i===void 0?void 0:i.layer)==="top"),a.style.width="".concat(Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width),"px"),a.style.height="".concat((e.options.height||1)*this._renderService.dimensions.css.cell.height,"px"),a.style.top="".concat((e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height,"px"),a.style.lineHeight="".concat(this._renderService.dimensions.css.cell.height,"px");var l=(n=e.options.x)!==null&&n!==void 0?n:0;return l&&l>this._bufferService.cols&&(a.style.display="none"),this._refreshXPosition(e,a),a}},{key:"_refreshStyle",value:function(e){var i=this,n=e.marker.line-this._bufferService.buffers.active.ydisp;if(n<0||n>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{var a=this._decorationElements.get(e);a||(a=this._createElement(e),e.element=a,this._decorationElements.set(e,a),this._container.appendChild(a),e.onDispose(function(){i._decorationElements.delete(e),a.remove()})),a.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(a.style.width="".concat(Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width),"px"),a.style.height="".concat((e.options.height||1)*this._renderService.dimensions.css.cell.height,"px"),a.style.top="".concat(n*this._renderService.dimensions.css.cell.height,"px"),a.style.lineHeight="".concat(this._renderService.dimensions.css.cell.height,"px")),e.onRenderEmitter.fire(a)}}},{key:"_refreshXPosition",value:function(e){var i,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.element;if(n){var a=(i=e.options.x)!==null&&i!==void 0?i:0;(e.options.anchor||"left")==="right"?n.style.right=a?"".concat(a*this._renderService.dimensions.css.cell.width,"px"):"":n.style.left=a?"".concat(a*this._renderService.dimensions.css.cell.width,"px"):""}}},{key:"_removeDecoration",value:function(e){var i;(i=this._decorationElements.get(e))!==null&&i!==void 0&&i.remove(),this._decorationElements.delete(e),e.dispose()}}]),r}(G);bi=ge([T(1,Te),T(2,tt),T(3,Mt),T(4,rt)],bi);var ja=function(){function s(){S(this,s),this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}return k(s,[{key:"zones",get:function(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}},{key:"clear",value:function(){this._zones.length=0,this._zonePoolIndex=0}},{key:"addDecoration",value:function(r){if(r.options.overviewRulerOptions){var t=Z(this._zones),e;try{for(t.s();!(e=t.n()).done;){var i=e.value;if(i.color===r.options.overviewRulerOptions.color&&i.position===r.options.overviewRulerOptions.position){if(this._lineIntersectsZone(i,r.marker.line))return;if(this._lineAdjacentToZone(i,r.marker.line,r.options.overviewRulerOptions.position)){this._addLineToZone(i,r.marker.line);return}}}}catch(n){t.e(n)}finally{t.f()}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=r.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=r.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=r.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=r.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:r.options.overviewRulerOptions.color,position:r.options.overviewRulerOptions.position,startBufferLine:r.marker.line,endBufferLine:r.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}},{key:"setPadding",value:function(r){this._linePadding=r}},{key:"_lineIntersectsZone",value:function(r,t){return t>=r.startBufferLine&&t<=r.endBufferLine}},{key:"_lineAdjacentToZone",value:function(r,t,e){return t>=r.startBufferLine-this._linePadding[e||"full"]&&t<=r.endBufferLine+this._linePadding[e||"full"]}},{key:"_addLineToZone",value:function(r,t){r.startBufferLine=Math.min(r.startBufferLine,t),r.endBufferLine=Math.max(r.endBufferLine,t)}}]),s}(),Je={full:0,left:0,center:0,right:0},_t={full:0,left:0,center:0,right:0},Ft={full:0,left:0,center:0,right:0},Er=function(s){z(r,s);var o=U(r);function r(t,e,i,n,a,l,u,h){var c,d;S(this,r),d=o.call(this),d._viewportElement=t,d._screenElement=e,d._bufferService=i,d._decorationService=n,d._renderService=a,d._optionsService=l,d._themeService=u,d._coreBrowserService=h,d._colorZoneStore=new ja,d._shouldUpdateDimensions=!0,d._shouldUpdateAnchor=!0,d._lastKnownBufferLength=0,d._canvas=d._coreBrowserService.mainDocument.createElement("canvas"),d._canvas.classList.add("xterm-decoration-overview-ruler"),d._refreshCanvasDimensions(),(c=d._viewportElement.parentElement)!==null&&c!==void 0&&c.insertBefore(d._canvas,d._viewportElement),d._register(ue(function(){var v;return(v=d._canvas)===null||v===void 0?void 0:v.remove()}));var _=d._canvas.getContext("2d");if(_)d._ctx=_;else throw new Error("Ctx cannot be null");return d._register(d._decorationService.onDecorationRegistered(function(){return d._queueRefresh(void 0,!0)})),d._register(d._decorationService.onDecorationRemoved(function(){return d._queueRefresh(void 0,!0)})),d._register(d._renderService.onRenderedViewportChange(function(){return d._queueRefresh()})),d._register(d._bufferService.buffers.onBufferActivate(function(){d._canvas.style.display=d._bufferService.buffer===d._bufferService.buffers.alt?"none":"block"})),d._register(d._bufferService.onScroll(function(){d._lastKnownBufferLength!==d._bufferService.buffers.normal.lines.length&&(d._refreshDrawHeightConstants(),d._refreshColorZonePadding())})),d._register(d._renderService.onRender(function(){(!d._containerHeight||d._containerHeight!==d._screenElement.clientHeight)&&(d._queueRefresh(!0),d._containerHeight=d._screenElement.clientHeight)})),d._register(d._coreBrowserService.onDprChange(function(){return d._queueRefresh(!0)})),d._register(d._optionsService.onSpecificOptionChange("overviewRuler",function(){return d._queueRefresh(!0)})),d._register(d._themeService.onChangeColors(function(){return d._queueRefresh()})),d._queueRefresh(!0),d}return k(r,[{key:"_width",get:function(){var e;return((e=this._optionsService.options.overviewRuler)===null||e===void 0?void 0:e.width)||0}},{key:"_refreshDrawConstants",value:function(){var e=Math.floor((this._canvas.width-1)/3),i=Math.ceil((this._canvas.width-1)/3);_t.full=this._canvas.width,_t.left=e,_t.center=i,_t.right=e,this._refreshDrawHeightConstants(),Ft.full=1,Ft.left=1,Ft.center=1+_t.left,Ft.right=1+_t.left+_t.center}},{key:"_refreshDrawHeightConstants",value:function(){Je.full=Math.round(2*this._coreBrowserService.dpr);var e=this._canvas.height/this._bufferService.buffer.lines.length,i=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);Je.left=i,Je.center=i,Je.right=i}},{key:"_refreshColorZonePadding",value:function(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*Je.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*Je.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*Je.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*Je.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}},{key:"_refreshCanvasDimensions",value:function(){this._canvas.style.width="".concat(this._width,"px"),this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height="".concat(this._screenElement.clientHeight,"px"),this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}},{key:"_refreshDecorations",value:function(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();var e=Z(this._decorationService.decorations),i;try{for(e.s();!(i=e.n()).done;){var n=i.value;this._colorZoneStore.addDecoration(n)}}catch(v){e.e(v)}finally{e.f()}this._ctx.lineWidth=1,this._renderRulerOutline();var a=this._colorZoneStore.zones,l=Z(a),u;try{for(l.s();!(u=l.n()).done;){var h=u.value;h.position!=="full"&&this._renderColorZone(h)}}catch(v){l.e(v)}finally{l.f()}var c=Z(a),d;try{for(c.s();!(d=c.n()).done;){var _=d.value;_.position==="full"&&this._renderColorZone(_)}}catch(v){c.e(v)}finally{c.f()}this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}},{key:"_renderRulerOutline",value:function(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}},{key:"_renderColorZone",value:function(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(Ft[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-Je[e.position||"full"]/2),_t[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+Je[e.position||"full"]))}},{key:"_queueRefresh",value:function(e,i){var n=this;this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=i||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(function(){n._refreshDecorations(),n._animationFrame=void 0}))}}]),r}(G);Er=ge([T(2,Te),T(3,Mt),T(4,rt),T(5,Oe),T(6,Dt),T(7,tt)],Er);var E;(function(s){return s.NUL="\0",s.SOH="",s.STX="",s.ETX="",s.EOT="",s.ENQ="",s.ACK="",s.BEL="\x07",s.BS="\b",s.HT="	",s.LF=`
`,s.VT="\v",s.FF="\f",s.CR="\r",s.SO="",s.SI="",s.DLE="",s.DC1="",s.DC2="",s.DC3="",s.DC4="",s.NAK="",s.SYN="",s.ETB="",s.CAN="",s.EM="",s.SUB="",s.ESC="\x1B",s.FS="",s.GS="",s.RS="",s.US="",s.SP=" ",s.DEL="\x7F"})(E||(E={}));var zt;(function(s){return s.PAD="\x80",s.HOP="\x81",s.BPH="\x82",s.NBH="\x83",s.IND="\x84",s.NEL="\x85",s.SSA="\x86",s.ESA="\x87",s.HTS="\x88",s.HTJ="\x89",s.VTS="\x8A",s.PLD="\x8B",s.PLU="\x8C",s.RI="\x8D",s.SS2="\x8E",s.SS3="\x8F",s.DCS="\x90",s.PU1="\x91",s.PU2="\x92",s.STS="\x93",s.CCH="\x94",s.MW="\x95",s.SPA="\x96",s.EPA="\x97",s.SOS="\x98",s.SGCI="\x99",s.SCI="\x9A",s.CSI="\x9B",s.ST="\x9C",s.OSC="\x9D",s.PM="\x9E",s.APC="\x9F"})(zt||(zt={}));var wi;(function(s){return s.ST="".concat(E.ESC,"\\")})(wi||(wi={}));var Ci=function(){function s(o,r,t,e,i,n){S(this,s),this._textarea=o,this._compositionView=r,this._bufferService=t,this._optionsService=e,this._coreService=i,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}return k(s,[{key:"isComposing",get:function(){return this._isComposing}},{key:"compositionstart",value:function(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}},{key:"compositionupdate",value:function(r){var t=this;this._compositionView.textContent=r.data,this.updateCompositionElements(),setTimeout(function(){t._compositionPosition.end=t._textarea.value.length},0)}},{key:"compositionend",value:function(){this._finalizeComposition(!0)}},{key:"keydown",value:function(r){if(this._isComposing||this._isSendingComposition){if(r.keyCode===20||r.keyCode===229||r.keyCode===16||r.keyCode===17||r.keyCode===18)return!1;this._finalizeComposition(!1)}return r.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}},{key:"_finalizeComposition",value:function(r){var t=this;if(this._compositionView.classList.remove("active"),this._isComposing=!1,r){var e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(function(){if(t._isSendingComposition){t._isSendingComposition=!1;var n;e.start+=t._dataAlreadySent.length,t._isComposing?n=t._textarea.value.substring(e.start,t._compositionPosition.start):n=t._textarea.value.substring(e.start),n.length>0&&t._coreService.triggerDataEvent(n,!0)}},0)}else{this._isSendingComposition=!1;var i=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(i,!0)}}},{key:"_handleAnyTextareaChanges",value:function(){var r=this,t=this._textarea.value;setTimeout(function(){if(!r._isComposing){var e=r._textarea.value,i=e.replace(t,"");r._dataAlreadySent=i,e.length>t.length?r._coreService.triggerDataEvent(i,!0):e.length<t.length?r._coreService.triggerDataEvent("".concat(E.DEL),!0):e.length===t.length&&e!==t&&r._coreService.triggerDataEvent(e,!0)}},0)}},{key:"updateCompositionElements",value:function(r){var t=this;if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){var e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),i=this._renderService.dimensions.css.cell.height,n=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,a=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=a+"px",this._compositionView.style.top=n+"px",this._compositionView.style.height=i+"px",this._compositionView.style.lineHeight=i+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";var l=this._compositionView.getBoundingClientRect();this._textarea.style.left=a+"px",this._textarea.style.top=n+"px",this._textarea.style.width=Math.max(l.width,1)+"px",this._textarea.style.height=Math.max(l.height,1)+"px",this._textarea.style.lineHeight=l.height+"px"}r||setTimeout(function(){return t.updateCompositionElements(!0)},0)}}}]),s}();Ci=ge([T(2,Te),T(3,Oe),T(4,yt),T(5,rt)],Ci);var Pe=0,Le=0,Be=0,pe=0,es={css:"#00000000",rgba:0},me;(function(s){function o(e,i,n,a){return a!==void 0?"#".concat(bt(e)).concat(bt(i)).concat(bt(n)).concat(bt(a)):"#".concat(bt(e)).concat(bt(i)).concat(bt(n))}s.toCss=o;function r(e,i,n){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255;return(e<<24|i<<16|n<<8|a)>>>0}s.toRgba=r;function t(e,i,n,a){return{css:s.toCss(e,i,n,a),rgba:s.toRgba(e,i,n,a)}}s.toColor=t})(me||(me={}));var ce;(function(s){function o(l,u){if(pe=(u.rgba&255)/255,pe===1)return{css:u.css,rgba:u.rgba};var h=u.rgba>>24&255,c=u.rgba>>16&255,d=u.rgba>>8&255,_=l.rgba>>24&255,v=l.rgba>>16&255,f=l.rgba>>8&255;Pe=_+Math.round((h-_)*pe),Le=v+Math.round((c-v)*pe),Be=f+Math.round((d-f)*pe);var m=me.toCss(Pe,Le,Be),g=me.toRgba(Pe,Le,Be);return{css:m,rgba:g}}s.blend=o;function r(l){return(l.rgba&255)===255}s.isOpaque=r;function t(l,u,h){var c=Ut.ensureContrastRatio(l.rgba,u.rgba,h);if(c)return me.toColor(c>>24&255,c>>16&255,c>>8&255)}s.ensureContrastRatio=t;function e(l){var u,h,c=(l.rgba|255)>>>0;return u=Ut.toChannels(c),h=ne(u,3),Pe=h[0],Le=h[1],Be=h[2],{css:me.toCss(Pe,Le,Be),rgba:c}}s.opaque=e;function i(l,u){var h,c;return pe=Math.round(u*255),h=Ut.toChannels(l.rgba),c=ne(h,3),Pe=c[0],Le=c[1],Be=c[2],{css:me.toCss(Pe,Le,Be,pe),rgba:me.toRgba(Pe,Le,Be,pe)}}s.opacity=i;function n(l,u){return pe=l.rgba&255,i(l,pe*u/255)}s.multiplyOpacity=n;function a(l){return[l.rgba>>24&255,l.rgba>>16&255,l.rgba>>8&255]}s.toColorRGB=a})(ce||(ce={}));var de;(function(s){var o,r;try{var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d",{willReadFrequently:!0});e&&(o=e,o.globalCompositeOperation="copy",r=o.createLinearGradient(0,0,1,1))}catch(n){}function i(n){var a;if(n.match(/#[\da-f]{3,8}/i))switch(n.length){case 4:return Pe=parseInt(n.slice(1,2).repeat(2),16),Le=parseInt(n.slice(2,3).repeat(2),16),Be=parseInt(n.slice(3,4).repeat(2),16),me.toColor(Pe,Le,Be);case 5:return Pe=parseInt(n.slice(1,2).repeat(2),16),Le=parseInt(n.slice(2,3).repeat(2),16),Be=parseInt(n.slice(3,4).repeat(2),16),pe=parseInt(n.slice(4,5).repeat(2),16),me.toColor(Pe,Le,Be,pe);case 7:return{css:n,rgba:(parseInt(n.slice(1),16)<<8|255)>>>0};case 9:return{css:n,rgba:parseInt(n.slice(1),16)>>>0}}var l=n.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(l)return Pe=parseInt(l[1]),Le=parseInt(l[2]),Be=parseInt(l[3]),pe=Math.round((l[5]===void 0?1:parseFloat(l[5]))*255),me.toColor(Pe,Le,Be,pe);if(!o||!r)throw new Error("css.toColor: Unsupported css format");if(o.fillStyle=r,o.fillStyle=n,typeof o.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(o.fillRect(0,0,1,1),a=ne(o.getImageData(0,0,1,1).data,4),Pe=a[0],Le=a[1],Be=a[2],pe=a[3],pe!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:me.toRgba(Pe,Le,Be,pe),css:n}}s.toColor=i})(de||(de={}));var Me;(function(s){function o(t){return r(t>>16&255,t>>8&255,t&255)}s.relativeLuminance=o;function r(t,e,i){var n=t/255,a=e/255,l=i/255,u=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),h=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),c=l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4);return u*.2126+h*.7152+c*.0722}s.relativeLuminance2=r})(Me||(Me={}));var Ut;(function(s){function o(n,a){if(pe=(a&255)/255,pe===1)return a;var l=a>>24&255,u=a>>16&255,h=a>>8&255,c=n>>24&255,d=n>>16&255,_=n>>8&255;return Pe=c+Math.round((l-c)*pe),Le=d+Math.round((u-d)*pe),Be=_+Math.round((h-_)*pe),me.toRgba(Pe,Le,Be)}s.blend=o;function r(n,a,l){var u=Me.relativeLuminance(n>>8),h=Me.relativeLuminance(a>>8);if(ot(u,h)<l){if(h<u){var c=t(n,a,l),d=ot(u,Me.relativeLuminance(c>>8));if(d<l){var _=e(n,a,l),v=ot(u,Me.relativeLuminance(_>>8));return d>v?c:_}return c}var f=e(n,a,l),m=ot(u,Me.relativeLuminance(f>>8));if(m<l){var g=t(n,a,l),w=ot(u,Me.relativeLuminance(g>>8));return m>w?f:g}return f}}s.ensureContrastRatio=r;function t(n,a,l){for(var u=n>>24&255,h=n>>16&255,c=n>>8&255,d=a>>24&255,_=a>>16&255,v=a>>8&255,f=ot(Me.relativeLuminance2(d,_,v),Me.relativeLuminance2(u,h,c));f<l&&(d>0||_>0||v>0);)d-=Math.max(0,Math.ceil(d*.1)),_-=Math.max(0,Math.ceil(_*.1)),v-=Math.max(0,Math.ceil(v*.1)),f=ot(Me.relativeLuminance2(d,_,v),Me.relativeLuminance2(u,h,c));return(d<<24|_<<16|v<<8|255)>>>0}s.reduceLuminance=t;function e(n,a,l){for(var u=n>>24&255,h=n>>16&255,c=n>>8&255,d=a>>24&255,_=a>>16&255,v=a>>8&255,f=ot(Me.relativeLuminance2(d,_,v),Me.relativeLuminance2(u,h,c));f<l&&(d<255||_<255||v<255);)d=Math.min(255,d+Math.ceil((255-d)*.1)),_=Math.min(255,_+Math.ceil((255-_)*.1)),v=Math.min(255,v+Math.ceil((255-v)*.1)),f=ot(Me.relativeLuminance2(d,_,v),Me.relativeLuminance2(u,h,c));return(d<<24|_<<16|v<<8|255)>>>0}s.increaseLuminance=e;function i(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]}s.toChannels=i})(Ut||(Ut={}));function bt(s){var o=s.toString(16);return o.length<2?"0"+o:o}function ot(s,o){return s<o?(o+.05)/(s+.05):(s+.05)/(o+.05)}var qa=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;return S(this,r),n=o.call(this),n.content=0,n.combinedData="",n.fg=t.fg,n.bg=t.bg,n.combinedData=e,n._width=i,n}return k(r,[{key:"isCombined",value:function(){return 2097152}},{key:"getWidth",value:function(){return this._width}},{key:"getChars",value:function(){return this.combinedData}},{key:"getCode",value:function(){return 2097151}},{key:"setFromCharData",value:function(e){throw new Error("not implemented")}},{key:"getAsCharData",value:function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}]),r}(Rt),xr=function(){function s(o){S(this,s),this._bufferService=o,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new ze}return k(s,[{key:"register",value:function(r){var t={id:this._nextCharacterJoinerId++,handler:r};return this._characterJoiners.push(t),t.id}},{key:"deregister",value:function(r){for(var t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===r)return this._characterJoiners.splice(t,1),!0;return!1}},{key:"getJoinedCharacters",value:function(r){if(this._characterJoiners.length===0)return[];var t=this._bufferService.buffer.lines.get(r);if(!t||t.length===0)return[];for(var e=[],i=t.translateToString(!0),n=0,a=0,l=0,u=t.getFg(0),h=t.getBg(0),c=0;c<t.getTrimmedLength();c++)if(t.loadCell(c,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==u||this._workCell.bg!==h){if(c-n>1)for(var d=this._getJoinedRanges(i,l,a,t,n),_=0;_<d.length;_++)e.push(d[_]);n=c,l=a,u=this._workCell.fg,h=this._workCell.bg}a+=this._workCell.getChars().length||ut.length}if(this._bufferService.cols-n>1)for(var v=this._getJoinedRanges(i,l,a,t,n),f=0;f<v.length;f++)e.push(v[f]);return e}},{key:"_getJoinedRanges",value:function(r,t,e,i,n){var a=r.substring(t,e),l=[];try{l=this._characterJoiners[0].handler(a)}catch(d){console.error(d)}for(var u=1;u<this._characterJoiners.length;u++)try{for(var h=this._characterJoiners[u].handler(a),c=0;c<h.length;c++)xr._mergeRanges(l,h[c])}catch(d){console.error(d)}return this._stringRangesToCellRanges(l,i,n),l}},{key:"_stringRangesToCellRanges",value:function(r,t,e){var i=0,n=!1,a=0,l=r[i];if(l){for(var u=e;u<this._bufferService.cols;u++){var h=t.getWidth(u),c=t.getString(u).length||ut.length;if(h!==0){if(!n&&l[0]<=a&&(l[0]=u,n=!0),l[1]<=a){if(l[1]=u,l=r[++i],!l)break;l[0]<=a?(l[0]=u,n=!0):n=!1}a+=c}}l&&(l[1]=this._bufferService.cols)}}}],[{key:"_mergeRanges",value:function(r,t){for(var e=!1,i=0;i<r.length;i++){var n=r[i];if(e){if(t[1]<=n[0])return r[i-1][1]=t[1],r;if(t[1]<=n[1])return r[i-1][1]=Math.max(t[1],n[1]),r.splice(i,1),r;r.splice(i,1),i--}else{if(t[1]<=n[0])return r.splice(i,0,t),r;if(t[1]<=n[1])return n[0]=Math.min(t[0],n[0]),r;t[0]<n[1]&&(n[0]=Math.min(t[0],n[0]),e=!0);continue}}return e?r[r.length-1][1]=t[1]:r.push(t),r}}]),s}();xr=ge([T(0,Te)],xr);function $a(s){return 57508<=s&&s<=57558}function Ya(s){return 9472<=s&&s<=9631}function Ga(s){return $a(s)||Ya(s)}function Xa(){return{css:{canvas:Dr(),cell:Dr()},device:{canvas:Dr(),cell:Dr(),char:{width:0,height:0,left:0,top:0}}}}function Dr(){return{width:0,height:0}}var Ei=function(){function s(o,r,t,e,i,n,a){S(this,s),this._document=o,this._characterJoinerService=r,this._optionsService=t,this._coreBrowserService=e,this._coreService=i,this._decorationService=n,this._themeService=a,this._workCell=new ze,this._columnSelectMode=!1,this.defaultSpacing=0}return k(s,[{key:"handleSelectionChanged",value:function(r,t,e){this._selectionStart=r,this._selectionEnd=t,this._columnSelectMode=e}},{key:"createRow",value:function(r,t,e,i,n,a,l,u,h,c,d){var _=this,v=[],f=this._characterJoinerService.getJoinedCharacters(t),m=this._themeService.colors,g=r.getNoBgTrimmedLength();e&&g<a+1&&(g=a+1);for(var w,y=0,b="",A=0,ee=0,se=0,he=0,te=!1,Se=0,O=!1,W=0,C=0,p=[],x=c!==-1&&d!==-1,D=function(q){r.loadCell(q,_._workCell);var j=_._workCell.getWidth();if(j===0)return L=q,0;var ve=!1,Re=q>=C,at=q,X=_._workCell;if(f.length>0&&q===f[0][0]&&Re){var Ae=f.shift(),Ir=_._isCellInSelection(Ae[0],t);for(A=Ae[0]+1;A<Ae[1];A++)Re&&(Re=Ir===_._isCellInSelection(A,t));Re&&(Re=!e||a<Ae[0]||a>=Ae[1]),Re?(ve=!0,X=new qa(_._workCell,r.translateToString(!0,Ae[0],Ae[1]),Ae[1]-Ae[0]),at=Ae[1]-1,j=X.getWidth()):C=Ae[1]}var $e=_._isCellInSelection(q,t),Nr=e&&q===a,ir=x&&q>=c&&q<=d,Yi=!1;_._decorationService.forEachDecorationAtCell(q,t,void 0,function(lt){Yi=!0});var Hr=X.getChars()||ut;if(Hr===" "&&(X.isUnderline()||X.isOverline())&&(Hr="\xA0"),W=j*u-h.get(Hr,X.isBold(),X.isItalic()),!w)w=_._document.createElement("span");else{if(y&&($e&&O||!$e&&!O&&X.bg===ee)&&($e&&O&&m.selectionForeground||X.fg===se)&&X.extended.ext===he&&ir===te&&W===Se&&!Nr&&!ve&&!Yi&&Re)return X.isInvisible()?b+=ut:b+=Hr,y++,L=q,0;y&&(w.textContent=b),w=_._document.createElement("span"),y=0,b=""}if(ee=X.bg,se=X.fg,he=X.extended.ext,te=ir,Se=W,O=$e,ve&&a>=q&&a<=at&&(a=q),!_._coreService.isCursorHidden&&Nr&&_._coreService.isCursorInitialized){if(p.push("xterm-cursor"),_._coreBrowserService.isFocused)l&&p.push("xterm-cursor-blink"),p.push(i==="bar"?"xterm-cursor-bar":i==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(n)switch(n){case"outline":p.push("xterm-cursor-outline");break;case"block":p.push("xterm-cursor-block");break;case"bar":p.push("xterm-cursor-bar");break;case"underline":p.push("xterm-cursor-underline");break;default:break}}if(X.isBold()&&p.push("xterm-bold"),X.isItalic()&&p.push("xterm-italic"),X.isDim()&&p.push("xterm-dim"),X.isInvisible()?b=ut:b=X.getChars()||ut,X.isUnderline()&&(p.push("xterm-underline-".concat(X.extended.underlineStyle)),b===" "&&(b="\xA0"),!X.isUnderlineColorDefault()))if(X.isUnderlineColorRGB())w.style.textDecorationColor="rgb(".concat(Rt.toColorRGB(X.getUnderlineColor()).join(","),")");else{var Gi=X.getUnderlineColor();_._optionsService.rawOptions.drawBoldTextInBrightColors&&X.isBold()&&Gi<8&&(Gi+=8),w.style.textDecorationColor=m.ansi[Gi].css}X.isOverline()&&(p.push("xterm-overline"),b===" "&&(b="\xA0")),X.isStrikethrough()&&p.push("xterm-strikethrough"),ir&&(w.style.textDecoration="underline");var Ve=X.getFgColor(),nr=X.getFgColorMode(),et=X.getBgColor(),sr=X.getBgColorMode(),Xi=!!X.isInverse();if(Xi){var Dc=Ve;Ve=et,et=Dc;var Pc=nr;nr=sr,sr=Pc}var gt,Wr,or=!1;_._decorationService.forEachDecorationAtCell(q,t,void 0,function(lt){lt.options.layer!=="top"&&or||(lt.backgroundColorRGB&&(sr=50331648,et=lt.backgroundColorRGB.rgba>>8&16777215,gt=lt.backgroundColorRGB),lt.foregroundColorRGB&&(nr=50331648,Ve=lt.foregroundColorRGB.rgba>>8&16777215,Wr=lt.foregroundColorRGB),or=lt.options.layer==="top")}),!or&&$e&&(gt=_._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque,et=gt.rgba>>8&16777215,sr=50331648,or=!0,m.selectionForeground&&(nr=50331648,Ve=m.selectionForeground.rgba>>8&16777215,Wr=m.selectionForeground)),or&&p.push("xterm-decoration-top");var pt;switch(sr){case 16777216:case 33554432:pt=m.ansi[et],p.push("xterm-bg-".concat(et));break;case 50331648:pt=me.toColor(et>>16,et>>8&255,et&255),_._addStyle(w,"background-color:#".concat(ts((et>>>0).toString(16),"0",6)));break;case 0:default:Xi?(pt=m.foreground,p.push("xterm-bg-".concat(257))):pt=m.background}switch(gt||X.isDim()&&(gt=ce.multiplyOpacity(pt,.5)),nr){case 16777216:case 33554432:X.isBold()&&Ve<8&&_._optionsService.rawOptions.drawBoldTextInBrightColors&&(Ve+=8),_._applyMinimumContrast(w,pt,m.ansi[Ve],X,gt,void 0)||p.push("xterm-fg-".concat(Ve));break;case 50331648:var Lc=me.toColor(Ve>>16&255,Ve>>8&255,Ve&255);_._applyMinimumContrast(w,pt,Lc,X,gt,Wr)||_._addStyle(w,"color:#".concat(ts(Ve.toString(16),"0",6)));break;case 0:default:_._applyMinimumContrast(w,pt,m.foreground,X,gt,Wr)||Xi&&p.push("xterm-fg-".concat(257))}p.length&&(w.className=p.join(" "),p.length=0),!Nr&&!ve&&!Yi&&Re?y++:w.textContent=b,W!==_.defaultSpacing&&(w.style.letterSpacing="".concat(W,"px")),v.push(w),q=at,L=q},P,L=0;L<g;L++)P=D(L);return w&&y&&(w.textContent=b),v}},{key:"_applyMinimumContrast",value:function(r,t,e,i,n,a){if(this._optionsService.rawOptions.minimumContrastRatio===1||Ga(i.getCode()))return!1;var l=this._getContrastCache(i),u;if(!n&&!a&&(u=l.getColor(t.rgba,e.rgba)),u===void 0){var h,c=this._optionsService.rawOptions.minimumContrastRatio/(i.isDim()?2:1);u=ce.ensureContrastRatio(n||t,a||e,c),l.setColor((n||t).rgba,(a||e).rgba,(h=u)!==null&&h!==void 0?h:null)}return u?(this._addStyle(r,"color:".concat(u.css)),!0):!1}},{key:"_getContrastCache",value:function(r){return r.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}},{key:"_addStyle",value:function(r,t){r.setAttribute("style","".concat(r.getAttribute("style")||"").concat(t,";"))}},{key:"_isCellInSelection",value:function(r,t){var e=this._selectionStart,i=this._selectionEnd;return!e||!i?!1:this._columnSelectMode?e[0]<=i[0]?r>=e[0]&&t>=e[1]&&r<i[0]&&t<=i[1]:r<e[0]&&t>=e[1]&&r>=i[0]&&t<=i[1]:t>e[1]&&t<i[1]||e[1]===i[1]&&t===e[1]&&r>=e[0]&&r<i[0]||e[1]<i[1]&&t===i[1]&&r<i[0]||e[1]<i[1]&&t===e[1]&&r>=e[0]}}]),s}();Ei=ge([T(1,un),T(2,Oe),T(3,tt),T(4,yt),T(5,Mt),T(6,Dt)],Ei);function ts(s,o,r){for(;s.length<r;)s=o+s;return s}var Ja=function(){function s(o,r){S(this,s),this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=o.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";var t=o.createElement("span");t.classList.add("xterm-char-measure-element");var e=o.createElement("span");e.classList.add("xterm-char-measure-element"),e.style.fontWeight="bold";var i=o.createElement("span");i.classList.add("xterm-char-measure-element"),i.style.fontStyle="italic";var n=o.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[t,e,i,n],this._container.appendChild(t),this._container.appendChild(e),this._container.appendChild(i),this._container.appendChild(n),r.appendChild(this._container),this.clear()}return k(s,[{key:"dispose",value:function(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}},{key:"clear",value:function(){this._flat.fill(-9999),this._holey=new Map}},{key:"setFont",value:function(r,t,e,i){r===this._font&&t===this._fontSize&&e===this._weight&&i===this._weightBold||(this._font=r,this._fontSize=t,this._weight=e,this._weightBold=i,this._container.style.fontFamily=this._font,this._container.style.fontSize="".concat(this._fontSize,"px"),this._measureElements[0].style.fontWeight="".concat(e),this._measureElements[1].style.fontWeight="".concat(i),this._measureElements[2].style.fontWeight="".concat(e),this._measureElements[3].style.fontWeight="".concat(i),this.clear())}},{key:"get",value:function(r,t,e){var i=0;if(!t&&!e&&r.length===1&&(i=r.charCodeAt(0))<256){if(this._flat[i]!==-9999)return this._flat[i];var n=this._measure(r,0);return n>0&&(this._flat[i]=n),n}var a=r;t&&(a+="B"),e&&(a+="I");var l=this._holey.get(a);if(l===void 0){var u=0;t&&(u|=1),e&&(u|=2),l=this._measure(r,u),l>0&&this._holey.set(a,l)}return l}},{key:"_measure",value:function(r,t){var e=this._measureElements[t];return e.textContent=r.repeat(32),e.offsetWidth/32}}]),s}(),Qa=function(){function s(){S(this,s),this.clear()}return k(s,[{key:"clear",value:function(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}},{key:"update",value:function(r,t,e){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(this.selectionStart=t,this.selectionEnd=e,!t||!e||t[0]===e[0]&&t[1]===e[1]){this.clear();return}var n=r.buffers.active.ydisp,a=t[1]-n,l=e[1]-n,u=Math.max(a,0),h=Math.min(l,r.rows-1);if(u>=r.rows||h<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=i,this.viewportStartRow=a,this.viewportEndRow=l,this.viewportCappedStartRow=u,this.viewportCappedEndRow=h,this.startCol=t[0],this.endCol=e[0]}},{key:"isCellSelected",value:function(r,t,e){return this.hasSelection?(e-=r.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&e>=this.viewportCappedStartRow&&t<this.endCol&&e<=this.viewportCappedEndRow:t<this.startCol&&e>=this.viewportCappedStartRow&&t>=this.endCol&&e<=this.viewportCappedEndRow:e>this.viewportStartRow&&e<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&e===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&e===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&e===this.viewportStartRow&&t>=this.startCol):!1}}]),s}();function el(){return new Qa}var xi="xterm-dom-renderer-owner-",Ue="xterm-rows",Pr="xterm-fg-",rs="xterm-bg-",Kt="xterm-focus",Lr="xterm-selection",tl=1,Di=function(s){z(r,s);var o=U(r);function r(t,e,i,n,a,l,u,h,c,d,_,v,f,m){var g;return S(this,r),g=o.call(this),g._terminal=t,g._document=e,g._element=i,g._screenElement=n,g._viewportElement=a,g._helperContainer=l,g._linkifier2=u,g._charSizeService=c,g._optionsService=d,g._bufferService=_,g._coreService=v,g._coreBrowserService=f,g._themeService=m,g._terminalClass=tl++,g._rowElements=[],g._selectionRenderModel=el(),g.onRequestRedraw=g._register(new M).event,g._rowContainer=g._document.createElement("div"),g._rowContainer.classList.add(Ue),g._rowContainer.style.lineHeight="normal",g._rowContainer.setAttribute("aria-hidden","true"),g._refreshRowElements(g._bufferService.cols,g._bufferService.rows),g._selectionContainer=g._document.createElement("div"),g._selectionContainer.classList.add(Lr),g._selectionContainer.setAttribute("aria-hidden","true"),g.dimensions=Xa(),g._updateDimensions(),g._register(g._optionsService.onOptionChange(function(){return g._handleOptionsChanged()})),g._register(g._themeService.onChangeColors(function(w){return g._injectCss(w)})),g._injectCss(g._themeService.colors),g._rowFactory=h.createInstance(Ei,document),g._element.classList.add(xi+g._terminalClass),g._screenElement.appendChild(g._rowContainer),g._screenElement.appendChild(g._selectionContainer),g._register(g._linkifier2.onShowLinkUnderline(function(w){return g._handleLinkHover(w)})),g._register(g._linkifier2.onHideLinkUnderline(function(w){return g._handleLinkLeave(w)})),g._register(ue(function(){g._element.classList.remove(xi+g._terminalClass),g._rowContainer.remove(),g._selectionContainer.remove(),g._widthCache.dispose(),g._themeStyleElement.remove(),g._dimensionsStyleElement.remove()})),g._widthCache=new Ja(g._document,g._helperContainer),g._widthCache.setFont(g._optionsService.rawOptions.fontFamily,g._optionsService.rawOptions.fontSize,g._optionsService.rawOptions.fontWeight,g._optionsService.rawOptions.fontWeightBold),g._setDefaultSpacing(),g}return k(r,[{key:"_updateDimensions",value:function(){var e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;var i=Z(this._rowElements),n;try{for(i.s();!(n=i.n()).done;){var a=n.value;a.style.width="".concat(this.dimensions.css.canvas.width,"px"),a.style.height="".concat(this.dimensions.css.cell.height,"px"),a.style.lineHeight="".concat(this.dimensions.css.cell.height,"px"),a.style.overflow="hidden"}}catch(u){i.e(u)}finally{i.f()}this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));var l="".concat(this._terminalSelector," .").concat(Ue," span { display: inline-block; height: 100%; vertical-align: top;}");this._dimensionsStyleElement.textContent=l,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width="".concat(this.dimensions.css.canvas.width,"px"),this._screenElement.style.height="".concat(this.dimensions.css.canvas.height,"px")}},{key:"_injectCss",value:function(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));var i="".concat(this._terminalSelector," .").concat(Ue," { pointer-events: none; color: ").concat(e.foreground.css,"; font-family: ").concat(this._optionsService.rawOptions.fontFamily,"; font-size: ").concat(this._optionsService.rawOptions.fontSize,"px; font-kerning: none; white-space: pre}");i+="".concat(this._terminalSelector," .").concat(Ue," .xterm-dim { color: ").concat(ce.multiplyOpacity(e.foreground,.5).css,";}"),i+="".concat(this._terminalSelector," span:not(.xterm-bold) { font-weight: ").concat(this._optionsService.rawOptions.fontWeight,";}").concat(this._terminalSelector," span.xterm-bold { font-weight: ").concat(this._optionsService.rawOptions.fontWeightBold,";}").concat(this._terminalSelector," span.xterm-italic { font-style: italic;}");var n="blink_underline_".concat(this._terminalClass),a="blink_bar_".concat(this._terminalClass),l="blink_block_".concat(this._terminalClass);i+="@keyframes ".concat(n," { 50% {  border-bottom-style: hidden; }}"),i+="@keyframes ".concat(a," { 50% {  box-shadow: none; }}"),i+="@keyframes ".concat(l," { 0% {  background-color: ").concat(e.cursor.css,";  color: ").concat(e.cursorAccent.css,"; } 50% {  background-color: inherit;  color: ").concat(e.cursor.css,"; }}"),i+="".concat(this._terminalSelector," .").concat(Ue,".").concat(Kt," .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ").concat(n," 1s step-end infinite;}").concat(this._terminalSelector," .").concat(Ue,".").concat(Kt," .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ").concat(a," 1s step-end infinite;}").concat(this._terminalSelector," .").concat(Ue,".").concat(Kt," .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ").concat(l," 1s step-end infinite;}").concat(this._terminalSelector," .").concat(Ue," .xterm-cursor.xterm-cursor-block { background-color: ").concat(e.cursor.css,"; color: ").concat(e.cursorAccent.css,";}").concat(this._terminalSelector," .").concat(Ue," .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ").concat(e.cursor.css," !important; color: ").concat(e.cursorAccent.css," !important;}").concat(this._terminalSelector," .").concat(Ue," .xterm-cursor.xterm-cursor-outline { outline: 1px solid ").concat(e.cursor.css,"; outline-offset: -1px;}").concat(this._terminalSelector," .").concat(Ue," .xterm-cursor.xterm-cursor-bar { box-shadow: ").concat(this._optionsService.rawOptions.cursorWidth,"px 0 0 ").concat(e.cursor.css," inset;}").concat(this._terminalSelector," .").concat(Ue," .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ").concat(e.cursor.css,"; border-bottom-style: solid; height: calc(100% - 1px);}"),i+="".concat(this._terminalSelector," .").concat(Lr," { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}").concat(this._terminalSelector,".focus .").concat(Lr," div { position: absolute; background-color: ").concat(e.selectionBackgroundOpaque.css,";}").concat(this._terminalSelector," .").concat(Lr," div { position: absolute; background-color: ").concat(e.selectionInactiveBackgroundOpaque.css,";}");var u=Z(e.ansi.entries()),h;try{for(u.s();!(h=u.n()).done;){var c=ne(h.value,2),d=c[0],_=c[1];i+="".concat(this._terminalSelector," .").concat(Pr).concat(d," { color: ").concat(_.css,"; }").concat(this._terminalSelector," .").concat(Pr).concat(d,".xterm-dim { color: ").concat(ce.multiplyOpacity(_,.5).css,"; }").concat(this._terminalSelector," .").concat(rs).concat(d," { background-color: ").concat(_.css,"; }")}}catch(v){u.e(v)}finally{u.f()}i+="".concat(this._terminalSelector," .").concat(Pr,257," { color: ").concat(ce.opaque(e.background).css,"; }").concat(this._terminalSelector," .").concat(Pr,257,".xterm-dim { color: ").concat(ce.multiplyOpacity(ce.opaque(e.background),.5).css,"; }").concat(this._terminalSelector," .").concat(rs,257," { background-color: ").concat(e.foreground.css,"; }"),this._themeStyleElement.textContent=i}},{key:"_setDefaultSpacing",value:function(){var e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing="".concat(e,"px"),this._rowFactory.defaultSpacing=e}},{key:"handleDevicePixelRatioChange",value:function(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}},{key:"_refreshRowElements",value:function(e,i){for(var n=this._rowElements.length;n<=i;n++){var a=this._document.createElement("div");this._rowContainer.appendChild(a),this._rowElements.push(a)}for(;this._rowElements.length>i;)this._rowContainer.removeChild(this._rowElements.pop())}},{key:"handleResize",value:function(e,i){this._refreshRowElements(e,i),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}},{key:"handleCharSizeChanged",value:function(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}},{key:"handleBlur",value:function(){this._rowContainer.classList.remove(Kt),this.renderRows(0,this._bufferService.rows-1)}},{key:"handleFocus",value:function(){this._rowContainer.classList.add(Kt),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}},{key:"handleSelectionChanged",value:function(e,i,n){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,i,n),this.renderRows(0,this._bufferService.rows-1),!(!e||!i||(this._selectionRenderModel.update(this._terminal,e,i,n),!this._selectionRenderModel.hasSelection))){var a=this._selectionRenderModel.viewportStartRow,l=this._selectionRenderModel.viewportEndRow,u=this._selectionRenderModel.viewportCappedStartRow,h=this._selectionRenderModel.viewportCappedEndRow,c=this._document.createDocumentFragment();if(n){var d=e[0]>i[0];c.appendChild(this._createSelectionElement(u,d?i[0]:e[0],d?e[0]:i[0],h-u+1))}else{var _=a===u?e[0]:0,v=u===l?i[0]:this._bufferService.cols;c.appendChild(this._createSelectionElement(u,_,v));var f=h-u-1;if(c.appendChild(this._createSelectionElement(u+1,0,this._bufferService.cols,f)),u!==h){var m=l===h?i[0]:this._bufferService.cols;c.appendChild(this._createSelectionElement(h,0,m))}}this._selectionContainer.appendChild(c)}}},{key:"_createSelectionElement",value:function(e,i,n){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,l=this._document.createElement("div"),u=i*this.dimensions.css.cell.width,h=this.dimensions.css.cell.width*(n-i);return u+h>this.dimensions.css.canvas.width&&(h=this.dimensions.css.canvas.width-u),l.style.height="".concat(a*this.dimensions.css.cell.height,"px"),l.style.top="".concat(e*this.dimensions.css.cell.height,"px"),l.style.left="".concat(u,"px"),l.style.width="".concat(h,"px"),l}},{key:"handleCursorMove",value:function(){}},{key:"_handleOptionsChanged",value:function(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}},{key:"clear",value:function(){var e=Z(this._rowElements),i;try{for(e.s();!(i=e.n()).done;){var n=i.value;n.replaceChildren()}}catch(a){e.e(a)}finally{e.f()}}},{key:"renderRows",value:function(e,i){for(var n,a,l=this._bufferService.buffer,u=l.ybase+l.y,h=Math.min(l.x,this._bufferService.cols-1),c=(n=this._coreService.decPrivateModes.cursorBlink)!==null&&n!==void 0?n:this._optionsService.rawOptions.cursorBlink,d=(a=this._coreService.decPrivateModes.cursorStyle)!==null&&a!==void 0?a:this._optionsService.rawOptions.cursorStyle,_=this._optionsService.rawOptions.cursorInactiveStyle,v=e;v<=i;v++){var f=v+l.ydisp,m=this._rowElements[v],g=l.lines.get(f);if(!m||!g)break;m.replaceChildren.apply(m,ae(this._rowFactory.createRow(g,f,f===u,d,_,h,c,this.dimensions.css.cell.width,this._widthCache,-1,-1)))}}},{key:"_terminalSelector",get:function(){return".".concat(xi).concat(this._terminalClass)}},{key:"_handleLinkHover",value:function(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}},{key:"_handleLinkLeave",value:function(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}},{key:"_setCellUnderline",value:function(e,i,n,a,l,u){n<0&&(e=0),a<0&&(i=0);var h=this._bufferService.rows-1;n=Math.max(Math.min(n,h),0),a=Math.max(Math.min(a,h),0),l=Math.min(l,this._bufferService.cols);for(var c=this._bufferService.buffer,d=c.ybase+c.y,_=Math.min(c.x,l-1),v=this._optionsService.rawOptions.cursorBlink,f=this._optionsService.rawOptions.cursorStyle,m=this._optionsService.rawOptions.cursorInactiveStyle,g=n;g<=a;++g){var w=g+c.ydisp,y=this._rowElements[g],b=c.lines.get(w);if(!y||!b)break;y.replaceChildren.apply(y,ae(this._rowFactory.createRow(b,w,w===d,f,m,_,v,this.dimensions.css.cell.width,this._widthCache,u?g===n?e:0:-1,u?(g===a?i:l)-1:-1)))}}}]),r}(G);Di=ge([T(7,Zr),T(8,cr),T(9,Oe),T(10,Te),T(11,yt),T(12,tt),T(13,Dt)],Di);var Pi=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;S(this,r),n=o.call(this),n._optionsService=i,n.width=0,n.height=0,n._onCharSizeChange=n._register(new M),n.onCharSizeChange=n._onCharSizeChange.event;try{n._measureStrategy=n._register(new il(n._optionsService))}catch(a){n._measureStrategy=n._register(new rl(t,e,n._optionsService))}return n._register(n._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],function(){return n.measure()})),n}return k(r,[{key:"hasValidSize",get:function(){return this.width>0&&this.height>0}},{key:"measure",value:function(){var e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}}]),r}(G);Pi=ge([T(2,Oe)],Pi);var is=function(s){z(r,s);var o=U(r);function r(){var t;return S(this,r),t=o.apply(this,arguments),t._result={width:0,height:0},t}return k(r,[{key:"_validateAndSet",value:function(e,i){e!==void 0&&e>0&&i!==void 0&&i>0&&(this._result.width=e,this._result.height=i)}}]),r}(G),rl=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;return S(this,r),n=o.call(this),n._document=t,n._parentElement=e,n._optionsService=i,n._measureElement=n._document.createElement("span"),n._measureElement.classList.add("xterm-char-measure-element"),n._measureElement.textContent="W".repeat(32),n._measureElement.setAttribute("aria-hidden","true"),n._measureElement.style.whiteSpace="pre",n._measureElement.style.fontKerning="none",n._parentElement.appendChild(n._measureElement),n}return k(r,[{key:"measure",value:function(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize="".concat(this._optionsService.rawOptions.fontSize,"px"),this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}]),r}(is),il=function(s){z(r,s);var o=U(r);function r(t){var e;S(this,r),e=o.call(this),e._optionsService=t,e._canvas=new OffscreenCanvas(100,100),e._ctx=e._canvas.getContext("2d");var i=e._ctx.measureText("W");if(!("width"in i&&"fontBoundingBoxAscent"in i&&"fontBoundingBoxDescent"in i))throw new Error("Required font metrics not supported");return e}return k(r,[{key:"measure",value:function(){this._ctx.font="".concat(this._optionsService.rawOptions.fontSize,"px ").concat(this._optionsService.rawOptions.fontFamily);var e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}}]),r}(is),nl=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;return S(this,r),n=o.call(this),n._textarea=t,n._window=e,n.mainDocument=i,n._isFocused=!1,n._cachedIsFocused=void 0,n._screenDprMonitor=n._register(new sl(n._window)),n._onDprChange=n._register(new M),n.onDprChange=n._onDprChange.event,n._onWindowChange=n._register(new M),n.onWindowChange=n._onWindowChange.event,n._register(n.onWindowChange(function(a){return n._screenDprMonitor.setWindow(a)})),n._register(xe.forward(n._screenDprMonitor.onDprChange,n._onDprChange)),n._register($(n._textarea,"focus",function(){return n._isFocused=!0})),n._register($(n._textarea,"blur",function(){return n._isFocused=!1})),n}return k(r,[{key:"window",get:function(){return this._window},set:function(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}},{key:"dpr",get:function(){return this.window.devicePixelRatio}},{key:"isFocused",get:function(){var e=this;return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(function(){return e._cachedIsFocused=void 0})),this._cachedIsFocused}}]),r}(G),sl=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._parentWindow=t,e._windowResizeListener=e._register(new Pt),e._onDprChange=e._register(new M),e.onDprChange=e._onDprChange.event,e._outerListener=function(){return e._setDprAndFireIfDiffers()},e._currentDevicePixelRatio=e._parentWindow.devicePixelRatio,e._updateDpr(),e._setWindowResizeListener(),e._register(ue(function(){return e.clearListener()})),e}return k(r,[{key:"setWindow",value:function(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}},{key:"_setWindowResizeListener",value:function(){var e=this;this._windowResizeListener.value=$(this._parentWindow,"resize",function(){return e._setDprAndFireIfDiffers()})}},{key:"_setDprAndFireIfDiffers",value:function(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}},{key:"_updateDpr",value:function(){var e;this._outerListener&&((e=this._resolutionMediaMatchList)!==null&&e!==void 0&&e.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia("screen and (resolution: ".concat(this._parentWindow.devicePixelRatio,"dppx)")),this._resolutionMediaMatchList.addListener(this._outerListener))}},{key:"clearListener",value:function(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}]),r}(G),ol=function(s){z(r,s);var o=U(r);function r(){var t;return S(this,r),t=o.call(this),t.linkProviders=[],t._register(ue(function(){return t.linkProviders.length=0})),t}return k(r,[{key:"registerLinkProvider",value:function(e){var i=this;return this.linkProviders.push(e),{dispose:function(){var a=i.linkProviders.indexOf(e);a!==-1&&i.linkProviders.splice(a,1)}}}}]),r}(G);function Li(s,o,r){var t=r.getBoundingClientRect(),e=s.getComputedStyle(r),i=parseInt(e.getPropertyValue("padding-left")),n=parseInt(e.getPropertyValue("padding-top"));return[o.clientX-t.left-i,o.clientY-t.top-n]}function al(s,o,r,t,e,i,n,a,l){if(i){var u=Li(s,o,r);if(u)return u[0]=Math.ceil((u[0]+(l?n/2:0))/n),u[1]=Math.ceil(u[1]/a),u[0]=Math.min(Math.max(u[0],1),t+(l?1:0)),u[1]=Math.min(Math.max(u[1],1),e),u}}var Bi=function(){function s(o,r){S(this,s),this._renderService=o,this._charSizeService=r}return k(s,[{key:"getCoords",value:function(r,t,e,i,n){return al(window,r,t,e,i,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,n)}},{key:"getMouseReportCoords",value:function(r,t){var e=Li(window,r,t);if(this._charSizeService.hasValidSize)return e[0]=Math.min(Math.max(e[0],0),this._renderService.dimensions.css.canvas.width-1),e[1]=Math.min(Math.max(e[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(e[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(e[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(e[0]),y:Math.floor(e[1])}}}]),s}();Bi=ge([T(0,rt),T(1,cr)],Bi);var ll=function(){function s(o,r){S(this,s),this._renderCallback=o,this._coreBrowserService=r,this._refreshCallbacks=[]}return k(s,[{key:"dispose",value:function(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}},{key:"addRefreshCallback",value:function(r){var t=this;return this._refreshCallbacks.push(r),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(function(){return t._innerRefresh()})),this._animationFrame}},{key:"refresh",value:function(r,t,e){var i=this;this._rowCount=e,r=r!==void 0?r:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,r):r,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(function(){return i._innerRefresh()}))}},{key:"_innerRefresh",value:function(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}var r=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(r,t),this._runRefreshCallbacks()}},{key:"_runRefreshCallbacks",value:function(){var r=Z(this._refreshCallbacks),t;try{for(r.s();!(t=r.n()).done;){var e=t.value;e(0)}}catch(i){r.e(i)}finally{r.f()}this._refreshCallbacks=[]}}]),s}(),ns={};js(ns,{getSafariVersion:function(){return ul},isChromeOS:function(){return ls},isFirefox:function(){return ss},isIpad:function(){return hl},isIphone:function(){return dl},isLegacyEdge:function(){return cl},isLinux:function(){return Ri},isMac:function(){return Rr},isNode:function(){return Br},isSafari:function(){return os},isWindows:function(){return as}});var Br=(typeof fe=="undefined"?"undefined":R(fe))<"u"&&"title"in fe,Vt=Br?"node":navigator.userAgent,Zt=Br?"node":navigator.platform,ss=Vt.includes("Firefox"),cl=Vt.includes("Edge"),os=/^((?!chrome|android).)*safari/i.test(Vt);function ul(){if(!os)return 0;var s=Vt.match(/Version\/(\d+)/);return s===null||s.length<2?0:parseInt(s[1])}var Rr=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Zt),hl=Zt==="iPad",dl=Zt==="iPhone",as=["Windows","Win16","Win32","WinCE"].includes(Zt),Ri=Zt.indexOf("Linux")>=0,ls=/\bCrOS\b/.test(Vt),cs=function(){function s(){S(this,s),this._tasks=[],this._i=0}return k(s,[{key:"enqueue",value:function(r){this._tasks.push(r),this._start()}},{key:"flush",value:function(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}},{key:"clear",value:function(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}},{key:"_start",value:function(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}},{key:"_process",value:function(r){this._idleCallback=void 0;for(var t=0,e=0,i=r.timeRemaining(),n=0;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),e=Math.max(t,e),n=r.timeRemaining(),e*1.5>n){i-t<-20&&console.warn("task queue exceeded allotted deadline by ".concat(Math.abs(Math.round(i-t)),"ms")),this._start();return}i=n}this.clear()}}]),s}(),fl=function(s){z(r,s);var o=U(r);function r(){return S(this,r),o.apply(this,arguments)}return k(r,[{key:"_requestCallback",value:function(e){var i=this;return setTimeout(function(){return e(i._createDeadline(16))})}},{key:"_cancelCallback",value:function(e){clearTimeout(e)}},{key:"_createDeadline",value:function(e){var i=performance.now()+e;return{timeRemaining:function(){return Math.max(0,i-performance.now())}}}}]),r}(cs),_l=function(s){z(r,s);var o=U(r);function r(){return S(this,r),o.apply(this,arguments)}return k(r,[{key:"_requestCallback",value:function(e){return requestIdleCallback(e)}},{key:"_cancelCallback",value:function(e){cancelIdleCallback(e)}}]),r}(cs),Mr=!Br&&"requestIdleCallback"in window?_l:fl,vl=function(){function s(){S(this,s),this._queue=new Mr}return k(s,[{key:"set",value:function(r){this._queue.clear(),this._queue.enqueue(r)}},{key:"flush",value:function(){this._queue.flush()}}]),s}(),Mi=function(s){z(r,s);var o=U(r);function r(t,e,i,n,a,l,u,h,c){var d;return S(this,r),d=o.call(this),d._rowCount=t,d._optionsService=i,d._charSizeService=n,d._coreService=a,d._coreBrowserService=h,d._renderer=d._register(new Pt),d._pausedResizeTask=new vl,d._observerDisposable=d._register(new Pt),d._isPaused=!1,d._needsFullRefresh=!1,d._isNextRenderRedrawOnly=!0,d._needsSelectionRefresh=!1,d._canvasWidth=0,d._canvasHeight=0,d._selectionState={start:void 0,end:void 0,columnSelectMode:!1},d._onDimensionsChange=d._register(new M),d.onDimensionsChange=d._onDimensionsChange.event,d._onRenderedViewportChange=d._register(new M),d.onRenderedViewportChange=d._onRenderedViewportChange.event,d._onRender=d._register(new M),d.onRender=d._onRender.event,d._onRefreshRequest=d._register(new M),d.onRefreshRequest=d._onRefreshRequest.event,d._renderDebouncer=new ll(function(_,v){return d._renderRows(_,v)},d._coreBrowserService),d._register(d._renderDebouncer),d._syncOutputHandler=new gl(d._coreBrowserService,d._coreService,function(){return d._fullRefresh()}),d._register(ue(function(){return d._syncOutputHandler.dispose()})),d._register(d._coreBrowserService.onDprChange(function(){return d.handleDevicePixelRatioChange()})),d._register(u.onResize(function(){return d._fullRefresh()})),d._register(u.buffers.onBufferActivate(function(){var _;return(_=d._renderer.value)===null||_===void 0?void 0:_.clear()})),d._register(d._optionsService.onOptionChange(function(){return d._handleOptionsChanged()})),d._register(d._charSizeService.onCharSizeChange(function(){return d.handleCharSizeChanged()})),d._register(l.onDecorationRegistered(function(){return d._fullRefresh()})),d._register(l.onDecorationRemoved(function(){return d._fullRefresh()})),d._register(d._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],function(){d.clear(),d.handleResize(u.cols,u.rows),d._fullRefresh()})),d._register(d._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],function(){return d.refreshRows(u.buffer.y,u.buffer.y,!0)})),d._register(c.onChangeColors(function(){return d._fullRefresh()})),d._registerIntersectionObserver(d._coreBrowserService.window,e),d._register(d._coreBrowserService.onWindowChange(function(_){return d._registerIntersectionObserver(_,e)})),d}return k(r,[{key:"dimensions",get:function(){return this._renderer.value.dimensions}},{key:"_registerIntersectionObserver",value:function(e,i){var n=this;if("IntersectionObserver"in e){var a=new e.IntersectionObserver(function(l){return n._handleIntersectionChange(l[l.length-1])},{threshold:0});a.observe(i),this._observerDisposable.value=ue(function(){return a.disconnect()})}}},{key:"_handleIntersectionChange",value:function(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}},{key:"refreshRows",value:function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,i);return}var a=this._syncOutputHandler.flush();a&&(e=Math.min(e,a.start),i=Math.max(i,a.end)),n||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,i,this._rowCount)}},{key:"_renderRows",value:function(e,i){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,i);return}e=Math.min(e,this._rowCount-1),i=Math.min(i,this._rowCount-1),this._renderer.value.renderRows(e,i),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:i}),this._onRender.fire({start:e,end:i}),this._isNextRenderRedrawOnly=!0}}},{key:"resize",value:function(e,i){this._rowCount=i,this._fireOnCanvasResize()}},{key:"_handleOptionsChanged",value:function(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}},{key:"_fireOnCanvasResize",value:function(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}},{key:"hasRenderer",value:function(){return!!this._renderer.value}},{key:"setRenderer",value:function(e){var i=this;this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(function(n){return i.refreshRows(n.start,n.end,!0)}),this._needsSelectionRefresh=!0,this._fullRefresh())}},{key:"addRefreshCallback",value:function(e){return this._renderDebouncer.addRefreshCallback(e)}},{key:"_fullRefresh",value:function(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}},{key:"clearTextureAtlas",value:function(){var e,i;this._renderer.value&&((e=(i=this._renderer.value).clearTextureAtlas)!==null&&e!==void 0&&e.call(i),this._fullRefresh())}},{key:"handleDevicePixelRatioChange",value:function(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}},{key:"handleResize",value:function(e,i){var n=this;this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(function(){var a;return(a=n._renderer.value)===null||a===void 0?void 0:a.handleResize(e,i)}):this._renderer.value.handleResize(e,i),this._fullRefresh())}},{key:"handleCharSizeChanged",value:function(){var e;(e=this._renderer.value)===null||e===void 0||e.handleCharSizeChanged()}},{key:"handleBlur",value:function(){var e;(e=this._renderer.value)===null||e===void 0||e.handleBlur()}},{key:"handleFocus",value:function(){var e;(e=this._renderer.value)===null||e===void 0||e.handleFocus()}},{key:"handleSelectionChanged",value:function(e,i,n){var a;this._selectionState.start=e,this._selectionState.end=i,this._selectionState.columnSelectMode=n,(a=this._renderer.value)===null||a===void 0||a.handleSelectionChanged(e,i,n)}},{key:"handleCursorMove",value:function(){var e;(e=this._renderer.value)===null||e===void 0||e.handleCursorMove()}},{key:"clear",value:function(){var e;(e=this._renderer.value)===null||e===void 0||e.clear()}}]),r}(G);Mi=ge([T(2,Oe),T(3,cr),T(4,yt),T(5,Mt),T(6,Te),T(7,tt),T(8,Dt)],Mi);var gl=function(){function s(o,r,t){S(this,s),this._coreBrowserService=o,this._coreService=r,this._onTimeout=t,this._start=0,this._end=0,this._isBuffering=!1}return k(s,[{key:"bufferRows",value:function(r,t){var e=this;this._isBuffering?(this._start=Math.min(this._start,r),this._end=Math.max(this._end,t)):(this._start=r,this._end=t,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(function(){e._timeout=void 0,e._coreService.decPrivateModes.synchronizedOutput=!1,e._onTimeout()},1e3))}},{key:"flush",value:function(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!!this._isBuffering){var r={start:this._start,end:this._end};return this._isBuffering=!1,r}}},{key:"dispose",value:function(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}}]),s}();function pl(s,o,r,t){var e=r.buffer.x,i=r.buffer.y;if(!r.buffer.hasScrollback)return Sl(e,i,s,o,r,t)+Ar(i,o,r,t)+kl(e,i,s,o,r,t);var n;if(i===o)return n=e>s?"D":"C",qt(Math.abs(e-s),jt(n,t));n=i>o?"D":"C";var a=Math.abs(i-o),l=yl(i>o?s:e,r)+(a-1)*r.cols+1+ml(i>o?e:s,r);return qt(l,jt(n,t))}function ml(s,o){return s-1}function yl(s,o){return o.cols-s}function Sl(s,o,r,t,e,i){return Ar(o,t,e,i).length===0?"":qt(hs(s,o,s,o-wt(o,e),!1,e).length,jt("D",i))}function Ar(s,o,r,t){var e=s-wt(s,r),i=o-wt(o,r),n=Math.abs(e-i)-bl(s,o,r);return qt(n,jt(us(s,o),t))}function kl(s,o,r,t,e,i){var n;Ar(o,t,e,i).length>0?n=t-wt(t,e):n=o;var a=t,l=wl(s,o,r,t,e,i);return qt(hs(s,n,r,a,l==="C",e).length,jt(l,i))}function bl(s,o,r){for(var t=0,e=s-wt(s,r),i=o-wt(o,r),n=0;n<Math.abs(e-i);n++){var a,l=us(s,o)==="A"?-1:1;!((a=r.buffer.lines.get(e+l*n))===null||a===void 0)&&a.isWrapped&&t++}return t}function wt(s,o){for(var r,t=0,e=o.buffer.lines.get(s),i=(r=e)===null||r===void 0?void 0:r.isWrapped;i&&s>=0&&s<o.rows;){var n;t++,e=o.buffer.lines.get(--s),i=(n=e)===null||n===void 0?void 0:n.isWrapped}return t}function wl(s,o,r,t,e,i){var n;return Ar(r,t,e,i).length>0?n=t-wt(t,e):n=o,s<r&&n<=t||s>=r&&n<t?"C":"D"}function us(s,o){return s>o?"A":"B"}function hs(s,o,r,t,e,i){for(var n=s,a=o,l="";(n!==r||a!==t)&&a>=0&&a<i.buffer.lines.length;)n+=e?1:-1,e&&n>i.cols-1?(l+=i.buffer.translateBufferLineToString(a,!1,s,n),n=0,s=0,a++):!e&&n<0&&(l+=i.buffer.translateBufferLineToString(a,!1,0,s+1),n=i.cols-1,s=n,a--);return l+i.buffer.translateBufferLineToString(a,!1,s,n)}function jt(s,o){var r=o?"O":"[";return E.ESC+r+s}function qt(s,o){s=Math.floor(s);for(var r="",t=0;t<s;t++)r+=o;return r}var Cl=function(){function s(o){S(this,s),this._bufferService=o,this.isSelectAllActive=!1,this.selectionStartLength=0}return k(s,[{key:"clearSelection",value:function(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}},{key:"finalSelectionStart",get:function(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}},{key:"finalSelectionEnd",get:function(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){var r=this.selectionStart[0]+this.selectionStartLength;return r>this._bufferService.cols?r%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(r/this._bufferService.cols)-1]:[r%this._bufferService.cols,this.selectionStart[1]+Math.floor(r/this._bufferService.cols)]:[r,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){var t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[Math.max(t,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}},{key:"areSelectionValuesReversed",value:function(){var r=this.selectionStart,t=this.selectionEnd;return!r||!t?!1:r[1]>t[1]||r[1]===t[1]&&r[0]>t[0]}},{key:"handleTrim",value:function(r){return this.selectionStart&&(this.selectionStart[1]-=r),this.selectionEnd&&(this.selectionEnd[1]-=r),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}]),s}();function ds(s,o){if(s.start.y>s.end.y)throw new Error("Buffer range end (".concat(s.end.x,", ").concat(s.end.y,") cannot be before start (").concat(s.start.x,", ").concat(s.start.y,")"));return o*(s.end.y-s.start.y)+(s.end.x-s.start.x+1)}var Ai=50,El=15,xl=50,Dl=500,Pl="\xA0",Ll=new RegExp(Pl,"g"),Ti=function(s){z(r,s);var o=U(r);function r(t,e,i,n,a,l,u,h,c){var d;return S(this,r),d=o.call(this),d._element=t,d._screenElement=e,d._linkifier=i,d._bufferService=n,d._coreService=a,d._mouseService=l,d._optionsService=u,d._renderService=h,d._coreBrowserService=c,d._dragScrollAmount=0,d._enabled=!0,d._workCell=new ze,d._mouseDownTimeStamp=0,d._oldHasSelection=!1,d._oldSelectionStart=void 0,d._oldSelectionEnd=void 0,d._onLinuxMouseSelection=d._register(new M),d.onLinuxMouseSelection=d._onLinuxMouseSelection.event,d._onRedrawRequest=d._register(new M),d.onRequestRedraw=d._onRedrawRequest.event,d._onSelectionChange=d._register(new M),d.onSelectionChange=d._onSelectionChange.event,d._onRequestScrollLines=d._register(new M),d.onRequestScrollLines=d._onRequestScrollLines.event,d._mouseMoveListener=function(_){return d._handleMouseMove(_)},d._mouseUpListener=function(_){return d._handleMouseUp(_)},d._coreService.onUserInput(function(){d.hasSelection&&d.clearSelection()}),d._trimListener=d._bufferService.buffer.lines.onTrim(function(_){return d._handleTrim(_)}),d._register(d._bufferService.buffers.onBufferActivate(function(_){return d._handleBufferActivate(_)})),d.enable(),d._model=new Cl(d._bufferService),d._activeSelectionMode=0,d._register(ue(function(){d._removeMouseDownListeners()})),d._register(d._bufferService.onResize(function(_){_.rowsChanged&&d.clearSelection()})),d}return k(r,[{key:"reset",value:function(){this.clearSelection()}},{key:"disable",value:function(){this.clearSelection(),this._enabled=!1}},{key:"enable",value:function(){this._enabled=!0}},{key:"selectionStart",get:function(){return this._model.finalSelectionStart}},{key:"selectionEnd",get:function(){return this._model.finalSelectionEnd}},{key:"hasSelection",get:function(){var e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!e||!i?!1:e[0]!==i[0]||e[1]!==i[1]}},{key:"selectionText",get:function(){var e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;if(!e||!i)return"";var n=this._bufferService.buffer,a=[];if(this._activeSelectionMode===3){if(e[0]===i[0])return"";for(var l=e[0]<i[0]?e[0]:i[0],u=e[0]<i[0]?i[0]:e[0],h=e[1];h<=i[1];h++){var c=n.translateBufferLineToString(h,!0,l,u);a.push(c)}}else{var d=e[1]===i[1]?i[0]:void 0;a.push(n.translateBufferLineToString(e[1],!0,e[0],d));for(var _=e[1]+1;_<=i[1]-1;_++){var v=n.lines.get(_),f=n.translateBufferLineToString(_,!0);v!=null&&v.isWrapped?a[a.length-1]+=f:a.push(f)}if(e[1]!==i[1]){var m=n.lines.get(i[1]),g=n.translateBufferLineToString(i[1],!0,0,i[0]);m&&m.isWrapped?a[a.length-1]+=g:a.push(g)}}return a.map(function(w){return w.replace(Ll," ")}).join(as?`\r
`:`
`)}},{key:"clearSelection",value:function(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}},{key:"refresh",value:function(e){var i=this;this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(function(){return i._refresh()})),Ri&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}},{key:"_refresh",value:function(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}},{key:"_isClickInSelection",value:function(e){var i=this._getMouseBufferCoords(e),n=this._model.finalSelectionStart,a=this._model.finalSelectionEnd;return!n||!a||!i?!1:this._areCoordsInSelection(i,n,a)}},{key:"isCellInSelection",value:function(e,i){var n=this._model.finalSelectionStart,a=this._model.finalSelectionEnd;return!n||!a?!1:this._areCoordsInSelection([e,i],n,a)}},{key:"_areCoordsInSelection",value:function(e,i,n){return e[1]>i[1]&&e[1]<n[1]||i[1]===n[1]&&e[1]===i[1]&&e[0]>=i[0]&&e[0]<n[0]||i[1]<n[1]&&e[1]===n[1]&&e[0]<n[0]||i[1]<n[1]&&e[1]===i[1]&&e[0]>=i[0]}},{key:"_selectWordAtCursor",value:function(e,i){var n,a=(n=this._linkifier.currentLink)===null||n===void 0||(n=n.link)===null||n===void 0?void 0:n.range;if(a)return this._model.selectionStart=[a.start.x-1,a.start.y-1],this._model.selectionStartLength=ds(a,this._bufferService.cols),this._model.selectionEnd=void 0,!0;var l=this._getMouseBufferCoords(e);return l?(this._selectWordAt(l,i),this._model.selectionEnd=void 0,!0):!1}},{key:"selectAll",value:function(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}},{key:"selectLines",value:function(e,i){this._model.clearSelection(),e=Math.max(e,0),i=Math.min(i,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,i],this.refresh(),this._onSelectionChange.fire()}},{key:"_handleTrim",value:function(e){this._model.handleTrim(e)&&this.refresh()}},{key:"_getMouseBufferCoords",value:function(e){var i=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(i)return i[0]--,i[1]--,i[1]+=this._bufferService.buffer.ydisp,i}},{key:"_getMouseEventScrollAmount",value:function(e){var i=Li(this._coreBrowserService.window,e,this._screenElement)[1],n=this._renderService.dimensions.css.canvas.height;return i>=0&&i<=n?0:(i>n&&(i-=n),i=Math.min(Math.max(i,-Ai),Ai),i/=Ai,i/Math.abs(i)+Math.round(i*(El-1)))}},{key:"shouldForceSelection",value:function(e){return Rr?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}},{key:"handleMouseDown",value:function(e){if(this._mouseDownTimeStamp=e.timeStamp,!(e.button===2&&this.hasSelection)&&e.button===0){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):e.detail===1?this._handleSingleClick(e):e.detail===2?this._handleDoubleClick(e):e.detail===3&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}},{key:"_addMouseDownListeners",value:function(){var e=this;this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(function(){return e._dragScroll()},xl)}},{key:"_removeMouseDownListeners",value:function(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}},{key:"_handleIncrementalClick",value:function(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}},{key:"_handleSingleClick",value:function(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!!this._model.selectionStart){this._model.selectionEnd=void 0;var i=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);i&&i.length!==this._model.selectionStart[0]&&i.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}}},{key:"_handleDoubleClick",value:function(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}},{key:"_handleTripleClick",value:function(e){var i=this._getMouseBufferCoords(e);i&&(this._activeSelectionMode=2,this._selectLineAt(i[1]))}},{key:"shouldColumnSelect",value:function(e){return e.altKey&&!(Rr&&this._optionsService.rawOptions.macOptionClickForcesSelection)}},{key:"_handleMouseMove",value:function(e){if(e.stopImmediatePropagation(),!!this._model.selectionStart){var i=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));var n=this._bufferService.buffer;if(this._model.selectionEnd[1]<n.lines.length){var a=n.lines.get(this._model.selectionEnd[1]);a&&a.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!i||i[0]!==this._model.selectionEnd[0]||i[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}}},{key:"_dragScroll",value:function(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});var e=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}},{key:"_handleMouseUp",value:function(e){var i=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&i<Dl&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){var n=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(n&&n[0]!==void 0&&n[1]!==void 0){var a=pl(n[0]-1,n[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(a,!0)}}}else this._fireEventIfSelectionChanged()}},{key:"_fireEventIfSelectionChanged",value:function(){var e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd,n=!!e&&!!i&&(e[0]!==i[0]||e[1]!==i[1]);if(!n){this._oldHasSelection&&this._fireOnSelectionChange(e,i,n);return}!e||!i||(!this._oldSelectionStart||!this._oldSelectionEnd||e[0]!==this._oldSelectionStart[0]||e[1]!==this._oldSelectionStart[1]||i[0]!==this._oldSelectionEnd[0]||i[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(e,i,n)}},{key:"_fireOnSelectionChange",value:function(e,i,n){this._oldSelectionStart=e,this._oldSelectionEnd=i,this._oldHasSelection=n,this._onSelectionChange.fire()}},{key:"_handleBufferActivate",value:function(e){var i=this;this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(function(n){return i._handleTrim(n)})}},{key:"_convertViewportColToCharacterIndex",value:function(e,i){for(var n=i,a=0;i>=a;a++){var l=e.loadCell(a,this._workCell).getChars().length;this._workCell.getWidth()===0?n--:l>1&&i!==a&&(n+=l-1)}return n}},{key:"setSelection",value:function(e,i,n){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,i],this._model.selectionStartLength=n,this.refresh(),this._fireEventIfSelectionChanged()}},{key:"rightClickSelect",value:function(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}},{key:"_getWordAt",value:function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;if(!(e[0]>=this._bufferService.cols)){var l=this._bufferService.buffer,u=l.lines.get(e[1]);if(u){var h=l.translateBufferLineToString(e[1],!1),c=this._convertViewportColToCharacterIndex(u,e[0]),d=c,_=e[0]-c,v=0,f=0,m=0,g=0;if(h.charAt(c)===" "){for(;c>0&&h.charAt(c-1)===" ";)c--;for(;d<h.length&&h.charAt(d+1)===" ";)d++}else{var w=e[0],y=e[0];u.getWidth(w)===0&&(v++,w--),u.getWidth(y)===2&&(f++,y++);var b=u.getString(y).length;for(b>1&&(g+=b-1,d+=b-1);w>0&&c>0&&!this._isCharWordSeparator(u.loadCell(w-1,this._workCell));){u.loadCell(w-1,this._workCell);var A=this._workCell.getChars().length;this._workCell.getWidth()===0?(v++,w--):A>1&&(m+=A-1,c-=A-1),c--,w--}for(;y<u.length&&d+1<h.length&&!this._isCharWordSeparator(u.loadCell(y+1,this._workCell));){u.loadCell(y+1,this._workCell);var ee=this._workCell.getChars().length;this._workCell.getWidth()===2?(f++,y++):ee>1&&(g+=ee-1,d+=ee-1),d++,y++}}d++;var se=c+_-v+m,he=Math.min(this._bufferService.cols,d-c+v+f-m-g);if(!(!i&&h.slice(c,d).trim()==="")){if(n&&se===0&&u.getCodePoint(0)!==32){var te=l.lines.get(e[1]-1);if(te&&u.isWrapped&&te.getCodePoint(this._bufferService.cols-1)!==32){var Se=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(Se){var O=this._bufferService.cols-Se.start;se-=O,he+=O}}}if(a&&se+he===this._bufferService.cols&&u.getCodePoint(this._bufferService.cols-1)!==32){var W=l.lines.get(e[1]+1);if(W!=null&&W.isWrapped&&W.getCodePoint(0)!==32){var C=this._getWordAt([0,e[1]+1],!1,!1,!0);C&&(he+=C.length)}}return{start:se,length:he}}}}}},{key:"_selectWordAt",value:function(e,i){var n=this._getWordAt(e,i);if(n){for(;n.start<0;)n.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[n.start,e[1]],this._model.selectionStartLength=n.length}}},{key:"_selectToWordAt",value:function(e){var i=this._getWordAt(e,!0);if(i){for(var n=e[1];i.start<0;)i.start+=this._bufferService.cols,n--;if(!this._model.areSelectionValuesReversed())for(;i.start+i.length>this._bufferService.cols;)i.length-=this._bufferService.cols,n++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?i.start:i.start+i.length,n]}}},{key:"_isCharWordSeparator",value:function(e){return e.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}},{key:"_selectLineAt",value:function(e){var i=this._bufferService.buffer.getWrappedRangeForLine(e),n={start:{x:0,y:i.first},end:{x:this._bufferService.cols-1,y:i.last}};this._model.selectionStart=[0,i.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=ds(n,this._bufferService.cols)}}]),r}(G);Ti=ge([T(3,Te),T(4,yt),T(5,qr),T(6,Oe),T(7,rt),T(8,tt)],Ti);var fs=function(){function s(){S(this,s),this._data={}}return k(s,[{key:"set",value:function(r,t,e){this._data[r]||(this._data[r]={}),this._data[r][t]=e}},{key:"get",value:function(r,t){return this._data[r]?this._data[r][t]:void 0}},{key:"clear",value:function(){this._data={}}}]),s}(),_s=function(){function s(){S(this,s),this._color=new fs,this._css=new fs}return k(s,[{key:"setCss",value:function(r,t,e){this._css.set(r,t,e)}},{key:"getCss",value:function(r,t){return this._css.get(r,t)}},{key:"setColor",value:function(r,t,e){this._color.set(r,t,e)}},{key:"getColor",value:function(r,t){return this._color.get(r,t)}},{key:"clear",value:function(){this._color.clear(),this._css.clear()}}]),s}(),be=Object.freeze(function(){for(var s=[de.toColor("#2e3436"),de.toColor("#cc0000"),de.toColor("#4e9a06"),de.toColor("#c4a000"),de.toColor("#3465a4"),de.toColor("#75507b"),de.toColor("#06989a"),de.toColor("#d3d7cf"),de.toColor("#555753"),de.toColor("#ef2929"),de.toColor("#8ae234"),de.toColor("#fce94f"),de.toColor("#729fcf"),de.toColor("#ad7fa8"),de.toColor("#34e2e2"),de.toColor("#eeeeec")],o=[0,95,135,175,215,255],r=0;r<216;r++){var t=o[r/36%6|0],e=o[r/6%6|0],i=o[r%6];s.push({css:me.toCss(t,e,i),rgba:me.toRgba(t,e,i)})}for(var n=0;n<24;n++){var a=8+n*10;s.push({css:me.toCss(a,a,a),rgba:me.toRgba(a,a,a)})}return s}()),Ct=de.toColor("#ffffff"),$t=de.toColor("#000000"),vs=de.toColor("#ffffff"),gs=$t,Yt={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},Bl=Ct,Oi=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._optionsService=t,e._contrastCache=new _s,e._halfContrastCache=new _s,e._onChangeColors=e._register(new M),e.onChangeColors=e._onChangeColors.event,e._colors={foreground:Ct,background:$t,cursor:vs,cursorAccent:gs,selectionForeground:void 0,selectionBackgroundTransparent:Yt,selectionBackgroundOpaque:ce.blend($t,Yt),selectionInactiveBackgroundTransparent:Yt,selectionInactiveBackgroundOpaque:ce.blend($t,Yt),scrollbarSliderBackground:ce.opacity(Ct,.2),scrollbarSliderHoverBackground:ce.opacity(Ct,.4),scrollbarSliderActiveBackground:ce.opacity(Ct,.5),overviewRulerBorder:Ct,ansi:be.slice(),contrastCache:e._contrastCache,halfContrastCache:e._halfContrastCache},e._updateRestoreColors(),e._setTheme(e._optionsService.rawOptions.theme),e._register(e._optionsService.onSpecificOptionChange("minimumContrastRatio",function(){return e._contrastCache.clear()})),e._register(e._optionsService.onSpecificOptionChange("theme",function(){return e._setTheme(e._optionsService.rawOptions.theme)})),e}return k(r,[{key:"colors",get:function(){return this._colors}},{key:"_setTheme",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=this._colors;if(i.foreground=le(e.foreground,Ct),i.background=le(e.background,$t),i.cursor=ce.blend(i.background,le(e.cursor,vs)),i.cursorAccent=ce.blend(i.background,le(e.cursorAccent,gs)),i.selectionBackgroundTransparent=le(e.selectionBackground,Yt),i.selectionBackgroundOpaque=ce.blend(i.background,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundTransparent=le(e.selectionInactiveBackground,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundOpaque=ce.blend(i.background,i.selectionInactiveBackgroundTransparent),i.selectionForeground=e.selectionForeground?le(e.selectionForeground,es):void 0,i.selectionForeground===es&&(i.selectionForeground=void 0),ce.isOpaque(i.selectionBackgroundTransparent)&&(i.selectionBackgroundTransparent=ce.opacity(i.selectionBackgroundTransparent,.3)),ce.isOpaque(i.selectionInactiveBackgroundTransparent)&&(i.selectionInactiveBackgroundTransparent=ce.opacity(i.selectionInactiveBackgroundTransparent,.3)),i.scrollbarSliderBackground=le(e.scrollbarSliderBackground,ce.opacity(i.foreground,.2)),i.scrollbarSliderHoverBackground=le(e.scrollbarSliderHoverBackground,ce.opacity(i.foreground,.4)),i.scrollbarSliderActiveBackground=le(e.scrollbarSliderActiveBackground,ce.opacity(i.foreground,.5)),i.overviewRulerBorder=le(e.overviewRulerBorder,Bl),i.ansi=be.slice(),i.ansi[0]=le(e.black,be[0]),i.ansi[1]=le(e.red,be[1]),i.ansi[2]=le(e.green,be[2]),i.ansi[3]=le(e.yellow,be[3]),i.ansi[4]=le(e.blue,be[4]),i.ansi[5]=le(e.magenta,be[5]),i.ansi[6]=le(e.cyan,be[6]),i.ansi[7]=le(e.white,be[7]),i.ansi[8]=le(e.brightBlack,be[8]),i.ansi[9]=le(e.brightRed,be[9]),i.ansi[10]=le(e.brightGreen,be[10]),i.ansi[11]=le(e.brightYellow,be[11]),i.ansi[12]=le(e.brightBlue,be[12]),i.ansi[13]=le(e.brightMagenta,be[13]),i.ansi[14]=le(e.brightCyan,be[14]),i.ansi[15]=le(e.brightWhite,be[15]),e.extendedAnsi)for(var n=Math.min(i.ansi.length-16,e.extendedAnsi.length),a=0;a<n;a++)i.ansi[a+16]=le(e.extendedAnsi[a],be[a+16]);this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}},{key:"restoreColor",value:function(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}},{key:"_restoreColor",value:function(e){if(e===void 0){for(var i=0;i<this._restoreColors.ansi.length;++i)this._colors.ansi[i]=this._restoreColors.ansi[i];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}},{key:"modifyColors",value:function(e){e(this._colors),this._onChangeColors.fire(this.colors)}},{key:"_updateRestoreColors",value:function(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}}]),r}(G);Oi=ge([T(0,Oe)],Oi);function le(s,o){if(s!==void 0)try{return de.toColor(s)}catch(r){}return o}var Rl=function(){function s(){S(this,s),this._entries=new Map;for(var o=arguments.length,r=new Array(o),t=0;t<o;t++)r[t]=arguments[t];for(var e=0,i=r;e<i.length;e++){var n=ne(i[e],2),a=n[0],l=n[1];this.set(a,l)}}return k(s,[{key:"set",value:function(r,t){var e=this._entries.get(r);return this._entries.set(r,t),e}},{key:"forEach",value:function(r){var t=Z(this._entries.entries()),e;try{for(t.s();!(e=t.n()).done;){var i=ne(e.value,2),n=i[0],a=i[1];r(n,a)}}catch(l){t.e(l)}finally{t.f()}}},{key:"has",value:function(r){return this._entries.has(r)}},{key:"get",value:function(r){return this._entries.get(r)}}]),s}(),Ml=function(){function s(){S(this,s),this._services=new Rl,this._services.set(Zr,this)}return k(s,[{key:"setService",value:function(r,t){this._services.set(r,t)}},{key:"getService",value:function(r){return this._services.get(r)}},{key:"createInstance",value:function(r){var t=Qs(r).sort(function(_,v){return _.index-v.index}),e=[],i=Z(t),n;try{for(i.s();!(n=i.n()).done;){var a=n.value,l=this._services.get(a.id);if(!l)throw new Error("[createInstance] ".concat(r.name," depends on UNKNOWN service ").concat(a.id._id,"."));e.push(l)}}catch(_){i.e(_)}finally{i.f()}for(var u=arguments.length,h=new Array(u>1?u-1:0),c=1;c<u;c++)h[c-1]=arguments[c];var d=t.length>0?t[0].index:h.length;if(h.length!==d)throw new Error("[createInstance] First service dependency of ".concat(r.name," at position ").concat(d+1," conflicts with ").concat(h.length," static arguments"));return re(r,h.concat(e))}}]),s}(),Al={trace:0,debug:1,info:2,warn:3,error:4,off:5},Tl="xterm.js: ",Ii=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._optionsService=t,e._logLevel=5,e._updateLogLevel(),e._register(e._optionsService.onSpecificOptionChange("logLevel",function(){return e._updateLogLevel()})),Ol=Ie(e),e}return k(r,[{key:"logLevel",get:function(){return this._logLevel}},{key:"_updateLogLevel",value:function(){this._logLevel=Al[this._optionsService.rawOptions.logLevel]}},{key:"_evalLazyOptionalParams",value:function(e){for(var i=0;i<e.length;i++)typeof e[i]=="function"&&(e[i]=e[i]())}},{key:"_log",value:function(e,i,n){this._evalLazyOptionalParams(n),e.call.apply(e,[console,(this._optionsService.options.logger?"":Tl)+i].concat(ae(n)))}},{key:"trace",value:function(e){for(var i,n,a=arguments.length,l=new Array(a>1?a-1:0),u=1;u<a;u++)l[u-1]=arguments[u];this._logLevel<=0&&this._log((i=(n=this._optionsService.options.logger)===null||n===void 0?void 0:n.trace.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.log,e,l)}},{key:"debug",value:function(e){for(var i,n,a=arguments.length,l=new Array(a>1?a-1:0),u=1;u<a;u++)l[u-1]=arguments[u];this._logLevel<=1&&this._log((i=(n=this._optionsService.options.logger)===null||n===void 0?void 0:n.debug.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.log,e,l)}},{key:"info",value:function(e){for(var i,n,a=arguments.length,l=new Array(a>1?a-1:0),u=1;u<a;u++)l[u-1]=arguments[u];this._logLevel<=2&&this._log((i=(n=this._optionsService.options.logger)===null||n===void 0?void 0:n.info.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.info,e,l)}},{key:"warn",value:function(e){for(var i,n,a=arguments.length,l=new Array(a>1?a-1:0),u=1;u<a;u++)l[u-1]=arguments[u];this._logLevel<=3&&this._log((i=(n=this._optionsService.options.logger)===null||n===void 0?void 0:n.warn.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.warn,e,l)}},{key:"error",value:function(e){for(var i,n,a=arguments.length,l=new Array(a>1?a-1:0),u=1;u<a;u++)l[u-1]=arguments[u];this._logLevel<=4&&this._log((i=(n=this._optionsService.options.logger)===null||n===void 0?void 0:n.error.bind(this._optionsService.options.logger))!==null&&i!==void 0?i:console.error,e,l)}}]),r}(G);Ii=ge([T(0,Oe)],Ii);var Ol,ps=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._maxLength=t,e.onDeleteEmitter=e._register(new M),e.onDelete=e.onDeleteEmitter.event,e.onInsertEmitter=e._register(new M),e.onInsert=e.onInsertEmitter.event,e.onTrimEmitter=e._register(new M),e.onTrim=e.onTrimEmitter.event,e._array=new Array(e._maxLength),e._startIndex=0,e._length=0,e}return k(r,[{key:"maxLength",get:function(){return this._maxLength},set:function(e){if(this._maxLength!==e){for(var i=new Array(e),n=0;n<Math.min(e,this.length);n++)i[n]=this._array[this._getCyclicIndex(n)];this._array=i,this._maxLength=e,this._startIndex=0}}},{key:"length",get:function(){return this._length},set:function(e){if(e>this._length)for(var i=this._length;i<e;i++)this._array[i]=void 0;this._length=e}},{key:"get",value:function(e){return this._array[this._getCyclicIndex(e)]}},{key:"set",value:function(e,i){this._array[this._getCyclicIndex(e)]=i}},{key:"push",value:function(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}},{key:"recycle",value:function(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}},{key:"isFull",get:function(){return this._length===this._maxLength}},{key:"pop",value:function(){return this._array[this._getCyclicIndex(this._length---1)]}},{key:"splice",value:function(e,i){if(i){for(var n=e;n<this._length-i;n++)this._array[this._getCyclicIndex(n)]=this._array[this._getCyclicIndex(n+i)];this._length-=i,this.onDeleteEmitter.fire({index:e,amount:i})}for(var a=this._length-1;a>=e;a--)this._array[this._getCyclicIndex(a+(arguments.length<=2?0:arguments.length-2))]=this._array[this._getCyclicIndex(a)];for(var l=0;l<(arguments.length<=2?0:arguments.length-2);l++)this._array[this._getCyclicIndex(e+l)]=l+2<2||arguments.length<=l+2?void 0:arguments[l+2];if(!(arguments.length<=2)&&arguments.length-2&&this.onInsertEmitter.fire({index:e,amount:arguments.length<=2?0:arguments.length-2}),this._length+(arguments.length<=2?0:arguments.length-2)>this._maxLength){var u=this._length+(arguments.length<=2?0:arguments.length-2)-this._maxLength;this._startIndex+=u,this._length=this._maxLength,this.onTrimEmitter.fire(u)}else this._length+=arguments.length<=2?0:arguments.length-2}},{key:"trimStart",value:function(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}},{key:"shiftElements",value:function(e,i,n){if(!(i<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+n<0)throw new Error("Cannot shift elements in list beyond index 0");if(n>0){for(var a=i-1;a>=0;a--)this.set(e+a+n,this.get(e+a));var l=e+i+n-this._length;if(l>0)for(this._length+=l;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(var u=0;u<i;u++)this.set(e+u+n,this.get(e+u))}}},{key:"_getCyclicIndex",value:function(e){return(this._startIndex+e)%this._maxLength}}]),r}(G),Q=3,ke=Object.freeze(new Rt),Tr=0,Ni=2,Gt=function(){function s(o,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;S(this,s),this.isWrapped=t,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(o*Q);for(var e=r||ze.fromCharData([0,sn,1,0]),i=0;i<o;++i)this.setCell(i,e);this.length=o}return k(s,[{key:"get",value:function(r){var t=this._data[r*Q+0],e=t&2097151;return[this._data[r*Q+1],t&2097152?this._combined[r]:e?ct(e):"",t>>22,t&2097152?this._combined[r].charCodeAt(this._combined[r].length-1):e]}},{key:"set",value:function(r,t){this._data[r*Q+1]=t[0],t[1].length>1?(this._combined[r]=t[1],this._data[r*Q+0]=r|2097152|t[2]<<22):this._data[r*Q+0]=t[1].charCodeAt(0)|t[2]<<22}},{key:"getWidth",value:function(r){return this._data[r*Q+0]>>22}},{key:"hasWidth",value:function(r){return this._data[r*Q+0]&12582912}},{key:"getFg",value:function(r){return this._data[r*Q+1]}},{key:"getBg",value:function(r){return this._data[r*Q+2]}},{key:"hasContent",value:function(r){return this._data[r*Q+0]&4194303}},{key:"getCodePoint",value:function(r){var t=this._data[r*Q+0];return t&2097152?this._combined[r].charCodeAt(this._combined[r].length-1):t&2097151}},{key:"isCombined",value:function(r){return this._data[r*Q+0]&2097152}},{key:"getString",value:function(r){var t=this._data[r*Q+0];return t&2097152?this._combined[r]:t&2097151?ct(t&2097151):""}},{key:"isProtected",value:function(r){return this._data[r*Q+2]&536870912}},{key:"loadCell",value:function(r,t){return Tr=r*Q,t.content=this._data[Tr+0],t.fg=this._data[Tr+1],t.bg=this._data[Tr+2],t.content&2097152&&(t.combinedData=this._combined[r]),t.bg&268435456&&(t.extended=this._extendedAttrs[r]),t}},{key:"setCell",value:function(r,t){t.content&2097152&&(this._combined[r]=t.combinedData),t.bg&268435456&&(this._extendedAttrs[r]=t.extended),this._data[r*Q+0]=t.content,this._data[r*Q+1]=t.fg,this._data[r*Q+2]=t.bg}},{key:"setCellFromCodepoint",value:function(r,t,e,i){i.bg&268435456&&(this._extendedAttrs[r]=i.extended),this._data[r*Q+0]=t|e<<22,this._data[r*Q+1]=i.fg,this._data[r*Q+2]=i.bg}},{key:"addCodepointToCell",value:function(r,t,e){var i=this._data[r*Q+0];i&2097152?this._combined[r]+=ct(t):i&2097151?(this._combined[r]=ct(i&2097151)+ct(t),i&=-2097152,i|=2097152):i=t|1<<22,e&&(i&=-12582913,i|=e<<22),this._data[r*Q+0]=i}},{key:"insertCells",value:function(r,t,e){if(r%=this.length,r&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r-1,0,1,e),t<this.length-r){for(var i=new ze,n=this.length-r-t-1;n>=0;--n)this.setCell(r+t+n,this.loadCell(r+n,i));for(var a=0;a<t;++a)this.setCell(r+a,e)}else for(var l=r;l<this.length;++l)this.setCell(l,e);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,e)}},{key:"deleteCells",value:function(r,t,e){if(r%=this.length,t<this.length-r){for(var i=new ze,n=0;n<this.length-r-t;++n)this.setCell(r+n,this.loadCell(r+t+n,i));for(var a=this.length-t;a<this.length;++a)this.setCell(a,e)}else for(var l=r;l<this.length;++l)this.setCell(l,e);r&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r-1,0,1,e),this.getWidth(r)===0&&!this.hasContent(r)&&this.setCellFromCodepoint(r,0,1,e)}},{key:"replaceCells",value:function(r,t,e){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(i){for(r&&this.getWidth(r-1)===2&&!this.isProtected(r-1)&&this.setCellFromCodepoint(r-1,0,1,e),t<this.length&&this.getWidth(t-1)===2&&!this.isProtected(t)&&this.setCellFromCodepoint(t,0,1,e);r<t&&r<this.length;)this.isProtected(r)||this.setCell(r,e),r++;return}for(r&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r-1,0,1,e),t<this.length&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t,0,1,e);r<t&&r<this.length;)this.setCell(r++,e)}},{key:"resize",value:function(r,t){if(r===this.length)return this._data.length*4*Ni<this._data.buffer.byteLength;var e=r*Q;if(r>this.length){if(this._data.buffer.byteLength>=e*4)this._data=new Uint32Array(this._data.buffer,0,e);else{var i=new Uint32Array(e);i.set(this._data),this._data=i}for(var n=this.length;n<r;++n)this.setCell(n,t)}else{this._data=this._data.subarray(0,e);for(var a=Object.keys(this._combined),l=0;l<a.length;l++){var u=parseInt(a[l],10);u>=r&&delete this._combined[u]}for(var h=Object.keys(this._extendedAttrs),c=0;c<h.length;c++){var d=parseInt(h[c],10);d>=r&&delete this._extendedAttrs[d]}}return this.length=r,e*4*Ni<this._data.buffer.byteLength}},{key:"cleanupMemory",value:function(){if(this._data.length*4*Ni<this._data.buffer.byteLength){var r=new Uint32Array(this._data.length);return r.set(this._data),this._data=r,1}return 0}},{key:"fill",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t){for(var e=0;e<this.length;++e)this.isProtected(e)||this.setCell(e,r);return}this._combined={},this._extendedAttrs={};for(var i=0;i<this.length;++i)this.setCell(i,r)}},{key:"copyFrom",value:function(r){this.length!==r.length?this._data=new Uint32Array(r._data):this._data.set(r._data),this.length=r.length,this._combined={};for(var t in r._combined)this._combined[t]=r._combined[t];this._extendedAttrs={};for(var e in r._extendedAttrs)this._extendedAttrs[e]=r._extendedAttrs[e];this.isWrapped=r.isWrapped}},{key:"clone",value:function(){var r=new s(0);r._data=new Uint32Array(this._data),r.length=this.length;for(var t in this._combined)r._combined[t]=this._combined[t];for(var e in this._extendedAttrs)r._extendedAttrs[e]=this._extendedAttrs[e];return r.isWrapped=this.isWrapped,r}},{key:"getTrimmedLength",value:function(){for(var r=this.length-1;r>=0;--r)if(this._data[r*Q+0]&4194303)return r+(this._data[r*Q+0]>>22);return 0}},{key:"getNoBgTrimmedLength",value:function(){for(var r=this.length-1;r>=0;--r)if(this._data[r*Q+0]&4194303||this._data[r*Q+2]&50331648)return r+(this._data[r*Q+0]>>22);return 0}},{key:"copyCellsFrom",value:function(r,t,e,i,n){var a=r._data;if(n)for(var l=i-1;l>=0;l--){for(var u=0;u<Q;u++)this._data[(e+l)*Q+u]=a[(t+l)*Q+u];a[(t+l)*Q+2]&268435456&&(this._extendedAttrs[e+l]=r._extendedAttrs[t+l])}else for(var h=0;h<i;h++){for(var c=0;c<Q;c++)this._data[(e+h)*Q+c]=a[(t+h)*Q+c];a[(t+h)*Q+2]&268435456&&(this._extendedAttrs[e+h]=r._extendedAttrs[t+h])}for(var d=Object.keys(r._combined),_=0;_<d.length;_++){var v=parseInt(d[_],10);v>=t&&(this._combined[v-t+e]=r._combined[v])}}},{key:"translateToString",value:function(r,t,e,i){var n,a;t=(n=t)!==null&&n!==void 0?n:0,e=(a=e)!==null&&a!==void 0?a:this.length,r&&(e=Math.min(e,this.getTrimmedLength())),i&&(i.length=0);for(var l="";t<e;){var u=this._data[t*Q+0],h=u&2097151,c=u&2097152?this._combined[t]:h?ct(h):ut;if(l+=c,i)for(var d=0;d<c.length;++d)i.push(t);t+=u>>22||1}return i&&i.push(t),l}}]),s}();function Il(s,o,r,t,e,i){for(var n=[],a=0;a<s.length-1;a++){var l=a,u=s.get(++l);if(u.isWrapped){for(var h=[s.get(a)];l<s.length&&u.isWrapped;)h.push(u),u=s.get(++l);if(!i&&t>=a&&t<l){a+=h.length-1;continue}for(var c=0,d=Xt(h,c,o),_=1,v=0;_<h.length;){var f=Xt(h,_,o),m=f-v,g=r-d,w=Math.min(m,g);h[c].copyCellsFrom(h[_],v,d,w,!1),d+=w,d===r&&(c++,d=0),v+=w,v===f&&(_++,v=0),d===0&&c!==0&&h[c-1].getWidth(r-1)===2&&(h[c].copyCellsFrom(h[c-1],r-1,d++,1,!1),h[c-1].setCell(r-1,e))}h[c].replaceCells(d,r,e);for(var y=0,b=h.length-1;b>0&&(b>c||h[b].getTrimmedLength()===0);b--)y++;y>0&&(n.push(a+h.length-y),n.push(y)),a+=h.length-1}}return n}function Nl(s,o){for(var r=[],t=0,e=o[t],i=0,n=0;n<s.length;n++)if(e===n){var a=o[++t];s.onDeleteEmitter.fire({index:n-i,amount:a}),n+=a-1,i+=a,e=o[++t]}else r.push(n);return{layout:r,countRemoved:i}}function Hl(s,o){for(var r=[],t=0;t<o.length;t++)r.push(s.get(o[t]));for(var e=0;e<r.length;e++)s.set(e,r[e]);s.length=o.length}function Wl(s,o,r){for(var t=[],e=s.map(function(c,d){return Xt(s,d,o)}).reduce(function(c,d){return c+d}),i=0,n=0,a=0;a<e;){if(e-a<r){t.push(e-a);break}i+=r;var l=Xt(s,n,o);i>l&&(i-=l,n++);var u=s[n].getWidth(i-1)===2;u&&i--;var h=u?r-1:r;t.push(h),a+=h}return t}function Xt(s,o,r){if(o===s.length-1)return s[o].getTrimmedLength();var t=!s[o].hasContent(r-1)&&s[o].getWidth(r-1)===1,e=s[o+1].getWidth(0)===2;return t&&e?r-1:r}var ms=function(){function s(o){S(this,s),this.line=o,this.isDisposed=!1,this._disposables=[],this._id=s._nextId++,this._onDispose=this.register(new M),this.onDispose=this._onDispose.event}return k(s,[{key:"id",get:function(){return this._id}},{key:"dispose",value:function(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),kt(this._disposables),this._disposables.length=0)}},{key:"register",value:function(r){return this._disposables.push(r),r}}]),s}();ms._nextId=1;var Fl=ms,we={},Et=we.B;we[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},we.A={"#":"\xA3"},we.B=void 0,we[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},we.C=we[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},we.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},we.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},we.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},we.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},we.E=we[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},we.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},we.H=we[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},we["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"};var ys=4294967295,Ss=function(){function s(o,r,t){S(this,s),this._hasScrollback=o,this._optionsService=r,this._bufferService=t,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=ke.clone(),this.savedCharset=Et,this.markers=[],this._nullCell=ze.fromCharData([0,sn,1,0]),this._whitespaceCell=ze.fromCharData([0,ut,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new Mr,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new ps(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}return k(s,[{key:"getNullCell",value:function(r){return r?(this._nullCell.fg=r.fg,this._nullCell.bg=r.bg,this._nullCell.extended=r.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new lr),this._nullCell}},{key:"getWhitespaceCell",value:function(r){return r?(this._whitespaceCell.fg=r.fg,this._whitespaceCell.bg=r.bg,this._whitespaceCell.extended=r.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new lr),this._whitespaceCell}},{key:"getBlankLine",value:function(r,t){return new Gt(this._bufferService.cols,this.getNullCell(r),t)}},{key:"hasScrollback",get:function(){return this._hasScrollback&&this.lines.maxLength>this._rows}},{key:"isCursorInViewport",get:function(){var r=this.ybase+this.y-this.ydisp;return r>=0&&r<this._rows}},{key:"_getCorrectBufferLength",value:function(r){if(!this._hasScrollback)return r;var t=r+this._optionsService.rawOptions.scrollback;return t>ys?ys:t}},{key:"fillViewportRows",value:function(r){if(this.lines.length===0){r===void 0&&(r=ke);for(var t=this._rows;t--;)this.lines.push(this.getBlankLine(r))}}},{key:"clear",value:function(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new ps(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}},{key:"resize",value:function(r,t){var e=this,i=this.getNullCell(ke),n=0,a=this._getCorrectBufferLength(t);if(a>this.lines.maxLength&&(this.lines.maxLength=a),this.lines.length>0){if(this._cols<r)for(var l=0;l<this.lines.length;l++)n+=+this.lines.get(l).resize(r,i);var u=0;if(this._rows<t)for(var h=this._rows;h<t;h++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new Gt(r,i)):this.ybase>0&&this.lines.length<=this.ybase+this.y+u+1?(this.ybase--,u++,this.ydisp>0&&this.ydisp--):this.lines.push(new Gt(r,i)));else for(var c=this._rows;c>t;c--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(a<this.lines.maxLength){var d=this.lines.length-a;d>0&&(this.lines.trimStart(d),this.ybase=Math.max(this.ybase-d,0),this.ydisp=Math.max(this.ydisp-d,0),this.savedY=Math.max(this.savedY-d,0)),this.lines.maxLength=a}this.x=Math.min(this.x,r-1),this.y=Math.min(this.y,t-1),u&&(this.y+=u),this.savedX=Math.min(this.savedX,r-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(r,t),this._cols>r))for(var _=0;_<this.lines.length;_++)n+=+this.lines.get(_).resize(r,i);this._cols=r,this._rows=t,this._memoryCleanupQueue.clear(),n>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(function(){return e._batchedMemoryCleanup()}))}},{key:"_batchedMemoryCleanup",value:function(){var r=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,r=!1);for(var t=0;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return r}},{key:"_isReflowEnabled",get:function(){var r=this._optionsService.rawOptions.windowsPty;return r&&r.buildNumber?this._hasScrollback&&r.backend==="conpty"&&r.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}},{key:"_reflow",value:function(r,t){this._cols!==r&&(r>this._cols?this._reflowLarger(r,t):this._reflowSmaller(r,t))}},{key:"_reflowLarger",value:function(r,t){var e=this._optionsService.rawOptions.reflowCursorLine,i=Il(this.lines,this._cols,r,this.ybase+this.y,this.getNullCell(ke),e);if(i.length>0){var n=Nl(this.lines,i);Hl(this.lines,n.layout),this._reflowLargerAdjustViewport(r,t,n.countRemoved)}}},{key:"_reflowLargerAdjustViewport",value:function(r,t,e){for(var i=this.getNullCell(ke),n=e;n-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new Gt(r,i))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-e,0)}},{key:"_reflowSmaller",value:function(r,t){for(var e=this._optionsService.rawOptions.reflowCursorLine,i=this.getNullCell(ke),n=[],a=0,l=this.lines.length-1;l>=0;l--){var u=this.lines.get(l);if(!(!u||!u.isWrapped&&u.getTrimmedLength()<=r)){for(var h=[u];u.isWrapped&&l>0;)u=this.lines.get(--l),h.unshift(u);if(!e){var c=this.ybase+this.y;if(c>=l&&c<l+h.length)continue}var d=h[h.length-1].getTrimmedLength(),_=Wl(h,this._cols,r),v=_.length-h.length,f=void 0;this.ybase===0&&this.y!==this.lines.length-1?f=Math.max(0,this.y-this.lines.maxLength+v):f=Math.max(0,this.lines.length-this.lines.maxLength+v);for(var m=[],g=0;g<v;g++){var w=this.getBlankLine(ke,!0);m.push(w)}m.length>0&&(n.push({start:l+h.length+a,newLines:m}),a+=m.length),h.push.apply(h,m);var y=_.length-1,b=_[y];b===0&&(y--,b=_[y]);for(var A=h.length-v-1,ee=d;A>=0;){var se=Math.min(ee,b);if(h[y]===void 0)break;if(h[y].copyCellsFrom(h[A],ee-se,b-se,se,!0),b-=se,b===0&&(y--,b=_[y]),ee-=se,ee===0){A--;var he=Math.max(A,0);ee=Xt(h,he,this._cols)}}for(var te=0;te<h.length;te++)_[te]<r&&h[te].setCell(_[te],i);for(var Se=v-f;Se-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+a)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+v,this.ybase+t-1)}}if(n.length>0){for(var O=[],W=[],C=0;C<this.lines.length;C++)W.push(this.lines.get(C));var p=this.lines.length,x=p-1,D=0,P=n[D];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+a);for(var L=0,H=Math.min(this.lines.maxLength-1,p+a-1);H>=0;H--)if(P&&P.start>x+L){for(var q=P.newLines.length-1;q>=0;q--)this.lines.set(H--,P.newLines[q]);H++,O.push({index:x+1,amount:P.newLines.length}),L+=P.newLines.length,P=n[++D]}else this.lines.set(H,W[x--]);for(var j=0,ve=O.length-1;ve>=0;ve--)O[ve].index+=j,this.lines.onInsertEmitter.fire(O[ve]),j+=O[ve].amount;var Re=Math.max(0,p+a-this.lines.maxLength);Re>0&&this.lines.onTrimEmitter.fire(Re)}}},{key:"translateBufferLineToString",value:function(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,n=this.lines.get(r);return n?n.translateToString(t,e,i):""}},{key:"getWrappedRangeForLine",value:function(r){for(var t=r,e=r;t>0&&this.lines.get(t).isWrapped;)t--;for(;e+1<this.lines.length&&this.lines.get(e+1).isWrapped;)e++;return{first:t,last:e}}},{key:"setupTabStops",value:function(r){for(r!=null?this.tabs[r]||(r=this.prevStop(r)):(this.tabs={},r=0);r<this._cols;r+=this._optionsService.rawOptions.tabStopWidth)this.tabs[r]=!0}},{key:"prevStop",value:function(r){for(r==null&&(r=this.x);!this.tabs[--r]&&r>0;);return r>=this._cols?this._cols-1:r<0?0:r}},{key:"nextStop",value:function(r){for(r==null&&(r=this.x);!this.tabs[++r]&&r<this._cols;);return r>=this._cols?this._cols-1:r<0?0:r}},{key:"clearMarkers",value:function(r){this._isClearing=!0;for(var t=0;t<this.markers.length;t++)this.markers[t].line===r&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}},{key:"clearAllMarkers",value:function(){this._isClearing=!0;for(var r=0;r<this.markers.length;r++)this.markers[r].dispose();this.markers.length=0,this._isClearing=!1}},{key:"addMarker",value:function(r){var t=this,e=new Fl(r);return this.markers.push(e),e.register(this.lines.onTrim(function(i){e.line-=i,e.line<0&&e.dispose()})),e.register(this.lines.onInsert(function(i){e.line>=i.index&&(e.line+=i.amount)})),e.register(this.lines.onDelete(function(i){e.line>=i.index&&e.line<i.index+i.amount&&e.dispose(),e.line>i.index&&(e.line-=i.amount)})),e.register(e.onDispose(function(){return t._removeMarker(e)})),e}},{key:"_removeMarker",value:function(r){this._isClearing||this.markers.splice(this.markers.indexOf(r),1)}}]),s}(),zl=function(s){z(r,s);var o=U(r);function r(t,e){var i;return S(this,r),i=o.call(this),i._optionsService=t,i._bufferService=e,i._onBufferActivate=i._register(new M),i.onBufferActivate=i._onBufferActivate.event,i.reset(),i._register(i._optionsService.onSpecificOptionChange("scrollback",function(){return i.resize(i._bufferService.cols,i._bufferService.rows)})),i._register(i._optionsService.onSpecificOptionChange("tabStopWidth",function(){return i.setupTabStops()})),i}return k(r,[{key:"reset",value:function(){this._normal=new Ss(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new Ss(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}},{key:"alt",get:function(){return this._alt}},{key:"active",get:function(){return this._activeBuffer}},{key:"normal",get:function(){return this._normal}},{key:"activateNormalBuffer",value:function(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}},{key:"activateAltBuffer",value:function(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}},{key:"resize",value:function(e,i){this._normal.resize(e,i),this._alt.resize(e,i),this.setupTabStops(e)}},{key:"setupTabStops",value:function(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}}]),r}(G),ks=2,bs=1,Hi=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e.isUserScrolling=!1,e._onResize=e._register(new M),e.onResize=e._onResize.event,e._onScroll=e._register(new M),e.onScroll=e._onScroll.event,e.cols=Math.max(t.rawOptions.cols||0,ks),e.rows=Math.max(t.rawOptions.rows||0,bs),e.buffers=e._register(new zl(t,Ie(e))),e._register(e.buffers.onBufferActivate(function(i){e._onScroll.fire(i.activeBuffer.ydisp)})),e}return k(r,[{key:"buffer",get:function(){return this.buffers.active}},{key:"resize",value:function(e,i){var n=this.cols!==e,a=this.rows!==i;this.cols=e,this.rows=i,this.buffers.resize(e,i),this._onResize.fire({cols:e,rows:i,colsChanged:n,rowsChanged:a})}},{key:"reset",value:function(){this.buffers.reset(),this.isUserScrolling=!1}},{key:"scroll",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.buffer,a;a=this._cachedBlankLine,(!a||a.length!==this.cols||a.getFg(0)!==e.fg||a.getBg(0)!==e.bg)&&(a=n.getBlankLine(e,i),this._cachedBlankLine=a),a.isWrapped=i;var l=n.ybase+n.scrollTop,u=n.ybase+n.scrollBottom;if(n.scrollTop===0){var h=n.lines.isFull;u===n.lines.length-1?h?n.lines.recycle().copyFrom(a):n.lines.push(a.clone()):n.lines.splice(u+1,0,a.clone()),h?this.isUserScrolling&&(n.ydisp=Math.max(n.ydisp-1,0)):(n.ybase++,this.isUserScrolling||n.ydisp++)}else{var c=u-l+1;n.lines.shiftElements(l+1,c-1,-1),n.lines.set(u,a.clone())}this.isUserScrolling||(n.ydisp=n.ybase),this._onScroll.fire(n.ydisp)}},{key:"scrollLines",value:function(e,i){var n=this.buffer;if(e<0){if(n.ydisp===0)return;this.isUserScrolling=!0}else e+n.ydisp>=n.ybase&&(this.isUserScrolling=!1);var a=n.ydisp;n.ydisp=Math.max(Math.min(n.ydisp+e,n.ybase),0),a!==n.ydisp&&(i||this._onScroll.fire(n.ydisp))}}]),r}(G);Hi=ge([T(0,Oe)],Hi);var Bt={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:Rr,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},Ul=["normal","bold","100","200","300","400","500","600","700","800","900"],Kl=function(s){z(r,s);var o=U(r);function r(t){var e;S(this,r),e=o.call(this),e._onOptionChange=e._register(new M),e.onOptionChange=e._onOptionChange.event;var i=J({},Bt);for(var n in t)if(n in i)try{var a=t[n];i[n]=e._sanitizeAndValidateOption(n,a)}catch(l){console.error(l)}return e.rawOptions=i,e.options=J({},i),e._setupOptions(),e._register(ue(function(){e.rawOptions.linkHandler=null,e.rawOptions.documentOverride=null})),e}return k(r,[{key:"onSpecificOptionChange",value:function(e,i){var n=this;return this.onOptionChange(function(a){a===e&&i(n.rawOptions[e])})}},{key:"onMultipleOptionChange",value:function(e,i){return this.onOptionChange(function(n){e.indexOf(n)!==-1&&i()})}},{key:"_setupOptions",value:function(){var e=this,i=function(h){if(!(h in Bt))throw new Error('No option with key "'.concat(h,'"'));return e.rawOptions[h]},n=function(h,c){if(!(h in Bt))throw new Error('No option with key "'.concat(h,'"'));c=e._sanitizeAndValidateOption(h,c),e.rawOptions[h]!==c&&(e.rawOptions[h]=c,e._onOptionChange.fire(h))};for(var a in this.rawOptions){var l={get:i.bind(this,a),set:n.bind(this,a)};Object.defineProperty(this.options,a,l)}}},{key:"_sanitizeAndValidateOption",value:function(e,i){var n;switch(e){case"cursorStyle":if(i||(i=Bt[e]),!Vl(i))throw new Error('"'.concat(i,'" is not a valid value for ').concat(e));break;case"wordSeparator":i||(i=Bt[e]);break;case"fontWeight":case"fontWeightBold":if(typeof i=="number"&&1<=i&&i<=1e3)break;i=Ul.includes(i)?i:Bt[e];break;case"cursorWidth":i=Math.floor(i);case"lineHeight":case"tabStopWidth":if(i<1)throw new Error("".concat(e," cannot be less than 1, value: ").concat(i));break;case"minimumContrastRatio":i=Math.max(1,Math.min(21,Math.round(i*10)/10));break;case"scrollback":if(i=Math.min(i,4294967295),i<0)throw new Error("".concat(e," cannot be less than 0, value: ").concat(i));break;case"fastScrollSensitivity":case"scrollSensitivity":if(i<=0)throw new Error("".concat(e," cannot be less than or equal to 0, value: ").concat(i));break;case"rows":case"cols":if(!i&&i!==0)throw new Error("".concat(e," must be numeric, value: ").concat(i));break;case"windowsPty":i=(n=i)!==null&&n!==void 0?n:{};break}return i}}]),r}(G);function Vl(s){return s==="block"||s==="underline"||s==="bar"}function Jt(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;if(R(s)!="object")return s;var r=Array.isArray(s)?[]:{};for(var t in s)r[t]=o<=1?s[t]:s[t]&&Jt(s[t],o-1);return r}var ws=Object.freeze({insertMode:!1}),Cs=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),Wi=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;return S(this,r),n=o.call(this),n._bufferService=t,n._logService=e,n._optionsService=i,n.isCursorInitialized=!1,n.isCursorHidden=!1,n._onData=n._register(new M),n.onData=n._onData.event,n._onUserInput=n._register(new M),n.onUserInput=n._onUserInput.event,n._onBinary=n._register(new M),n.onBinary=n._onBinary.event,n._onRequestScrollToBottom=n._register(new M),n.onRequestScrollToBottom=n._onRequestScrollToBottom.event,n.modes=Jt(ws),n.decPrivateModes=Jt(Cs),n}return k(r,[{key:"reset",value:function(){this.modes=Jt(ws),this.decPrivateModes=Jt(Cs)}},{key:"triggerDataEvent",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this._optionsService.rawOptions.disableStdin){var n=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&n.ybase!==n.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug('sending data "'.concat(e,'"')),this._logService.trace("sending data (codes)",function(){return e.split("").map(function(a){return a.charCodeAt(0)})}),this._onData.fire(e)}}},{key:"triggerBinaryEvent",value:function(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug('sending binary "'.concat(e,'"')),this._logService.trace("sending binary (codes)",function(){return e.split("").map(function(i){return i.charCodeAt(0)})}),this._onBinary.fire(e))}}]),r}(G);Wi=ge([T(0,Te),T(1,ln),T(2,Oe)],Wi);var Es={NONE:{events:0,restrict:function(){return!1}},X10:{events:1,restrict:function(o){return o.button===4||o.action!==1?!1:(o.ctrl=!1,o.alt=!1,o.shift=!1,!0)}},VT200:{events:19,restrict:function(o){return o.action!==32}},DRAG:{events:23,restrict:function(o){return!(o.action===32&&o.button===3)}},ANY:{events:31,restrict:function(o){return!0}}};function Fi(s,o){var r=(s.ctrl?16:0)|(s.shift?4:0)|(s.alt?8:0);return s.button===4?(r|=64,r|=s.action):(r|=s.button&3,s.button&4&&(r|=64),s.button&8&&(r|=128),s.action===32?r|=32:s.action===0&&!o&&(r|=3)),r}var zi=String.fromCharCode,xs={DEFAULT:function(o){var r=[Fi(o,!1)+32,o.col+32,o.row+32];return r[0]>255||r[1]>255||r[2]>255?"":"\x1B[M".concat(zi(r[0])).concat(zi(r[1])).concat(zi(r[2]))},SGR:function(o){var r=o.action===0&&o.button!==4?"m":"M";return"\x1B[<".concat(Fi(o,!0),";").concat(o.col,";").concat(o.row).concat(r)},SGR_PIXELS:function(o){var r=o.action===0&&o.button!==4?"m":"M";return"\x1B[<".concat(Fi(o,!0),";").concat(o.x,";").concat(o.y).concat(r)}},Ui=function(s){z(r,s);var o=U(r);function r(t,e,i){var n;S(this,r),n=o.call(this),n._bufferService=t,n._coreService=e,n._optionsService=i,n._protocols={},n._encodings={},n._activeProtocol="",n._activeEncoding="",n._lastEvent=null,n._wheelPartialScroll=0,n._onProtocolChange=n._register(new M),n.onProtocolChange=n._onProtocolChange.event;for(var a=0,l=Object.keys(Es);a<l.length;a++){var u=l[a];n.addProtocol(u,Es[u])}for(var h=0,c=Object.keys(xs);h<c.length;h++){var d=c[h];n.addEncoding(d,xs[d])}return n.reset(),n}return k(r,[{key:"addProtocol",value:function(e,i){this._protocols[e]=i}},{key:"addEncoding",value:function(e,i){this._encodings[e]=i}},{key:"activeProtocol",get:function(){return this._activeProtocol},set:function(e){if(!this._protocols[e])throw new Error('unknown protocol "'.concat(e,'"'));this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}},{key:"areMouseEventsActive",get:function(){return this._protocols[this._activeProtocol].events!==0}},{key:"activeEncoding",get:function(){return this._activeEncoding},set:function(e){if(!this._encodings[e])throw new Error('unknown encoding "'.concat(e,'"'));this._activeEncoding=e}},{key:"reset",value:function(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}},{key:"consumeWheelEvent",value:function(e,i,n){if(e.deltaY===0||e.shiftKey||i===void 0||n===void 0)return 0;var a=i/n,l=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(l/=a+0,Math.abs(e.deltaY)<50&&(l*=.3),this._wheelPartialScroll+=l,l=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(l*=this._bufferService.rows),l}},{key:"_applyScrollModifier",value:function(e,i){return i.altKey||i.ctrlKey||i.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}},{key:"triggerMouseEvent",value:function(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||e.button===4&&e.action===32||e.button===3&&e.action!==32||e.button!==4&&(e.action===2||e.action===3)||(e.col++,e.row++,e.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,e,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(e))return!1;var i=this._encodings[this._activeEncoding](e);return i&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(i):this._coreService.triggerDataEvent(i,!0)),this._lastEvent=e,!0}},{key:"explainEvents",value:function(e){return{down:!!(e&1),up:!!(e&2),drag:!!(e&4),move:!!(e&8),wheel:!!(e&16)}}},{key:"_equalEvents",value:function(e,i,n){if(n){if(e.x!==i.x||e.y!==i.y)return!1}else if(e.col!==i.col||e.row!==i.row)return!1;return!(e.button!==i.button||e.action!==i.action||e.ctrl!==i.ctrl||e.alt!==i.alt||e.shift!==i.shift)}}]),r}(G);Ui=ge([T(0,Te),T(1,yt),T(2,Oe)],Ui);var Ki=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],Zl=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],Ce;function jl(s,o){var r=0,t=o.length-1,e;if(s<o[0][0]||s>o[t][1])return!1;for(;t>=r;)if(e=r+t>>1,s>o[e][1])r=e+1;else if(s<o[e][0])t=e-1;else return!0;return!1}var ql=function(){function s(){if(S(this,s),this.version="6",!Ce){Ce=new Uint8Array(65536),Ce.fill(1),Ce[0]=0,Ce.fill(0,1,32),Ce.fill(0,127,160),Ce.fill(2,4352,4448),Ce[9001]=2,Ce[9002]=2,Ce.fill(2,11904,42192),Ce[12351]=1,Ce.fill(2,44032,55204),Ce.fill(2,63744,64256),Ce.fill(2,65040,65050),Ce.fill(2,65072,65136),Ce.fill(2,65280,65377),Ce.fill(2,65504,65511);for(var o=0;o<Ki.length;++o)Ce.fill(0,Ki[o][0],Ki[o][1]+1)}}return k(s,[{key:"wcwidth",value:function(r){return r<32?0:r<127?1:r<65536?Ce[r]:jl(r,Zl)?0:r>=131072&&r<=196605||r>=196608&&r<=262141?2:1}},{key:"charProperties",value:function(r,t){var e=this.wcwidth(r),i=e===0&&t!==0;if(i){var n=xt.extractWidth(t);n===0?i=!1:n>e&&(e=n)}return xt.createPropertyValue(0,e,i)}}]),s}(),xt=function(){function s(){S(this,s),this._providers=Object.create(null),this._active="",this._onChange=new M,this.onChange=this._onChange.event;var o=new ql;this.register(o),this._active=o.version,this._activeProvider=o}return k(s,[{key:"dispose",value:function(){this._onChange.dispose()}},{key:"versions",get:function(){return Object.keys(this._providers)}},{key:"activeVersion",get:function(){return this._active},set:function(r){if(!this._providers[r])throw new Error('unknown Unicode version "'.concat(r,'"'));this._active=r,this._activeProvider=this._providers[r],this._onChange.fire(r)}},{key:"register",value:function(r){this._providers[r.version]=r}},{key:"wcwidth",value:function(r){return this._activeProvider.wcwidth(r)}},{key:"getStringCellWidth",value:function(r){for(var t=0,e=0,i=r.length,n=0;n<i;++n){var a=r.charCodeAt(n);if(55296<=a&&a<=56319){if(++n>=i)return t+this.wcwidth(a);var l=r.charCodeAt(n);56320<=l&&l<=57343?a=(a-55296)*1024+l-56320+65536:t+=this.wcwidth(l)}var u=this.charProperties(a,e),h=s.extractWidth(u);s.extractShouldJoin(u)&&(h-=s.extractWidth(e)),t+=h,e=u}return t}},{key:"charProperties",value:function(r,t){return this._activeProvider.charProperties(r,t)}}],[{key:"extractShouldJoin",value:function(r){return(r&1)!==0}},{key:"extractWidth",value:function(r){return r>>1&3}},{key:"extractCharKind",value:function(r){return r>>3}},{key:"createPropertyValue",value:function(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(r&16777215)<<3|(t&3)<<1|(e?1:0)}}]),s}(),$l=function(){function s(){S(this,s),this.glevel=0,this._charsets=[]}return k(s,[{key:"reset",value:function(){this.charset=void 0,this._charsets=[],this.glevel=0}},{key:"setgLevel",value:function(r){this.glevel=r,this.charset=this._charsets[r]}},{key:"setgCharset",value:function(r,t){this._charsets[r]=t,this.glevel===r&&(this.charset=t)}}]),s}();function Ds(s){var o,r=(o=s.buffer.lines.get(s.buffer.ybase+s.buffer.y-1))===null||o===void 0?void 0:o.get(s.cols-1),t=s.buffer.lines.get(s.buffer.ybase+s.buffer.y);t&&r&&(t.isWrapped=r[3]!==0&&r[3]!==32)}var Qt=2147483647,Yl=256,Ps=function(){function s(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:32,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32;if(S(this,s),this.maxLength=o,this.maxSubParamsLength=r,r>Yl)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(o),this.length=0,this._subParams=new Int32Array(r),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(o),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}return k(s,[{key:"clone",value:function(){var r=new s(this.maxLength,this.maxSubParamsLength);return r.params.set(this.params),r.length=this.length,r._subParams.set(this._subParams),r._subParamsLength=this._subParamsLength,r._subParamsIdx.set(this._subParamsIdx),r._rejectDigits=this._rejectDigits,r._rejectSubDigits=this._rejectSubDigits,r._digitIsSub=this._digitIsSub,r}},{key:"toArray",value:function(){for(var r=[],t=0;t<this.length;++t){r.push(this.params[t]);var e=this._subParamsIdx[t]>>8,i=this._subParamsIdx[t]&255;i-e>0&&r.push(Array.prototype.slice.call(this._subParams,e,i))}return r}},{key:"reset",value:function(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}},{key:"addParam",value:function(r){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(r<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=r>Qt?Qt:r}},{key:"addSubParam",value:function(r){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(r<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=r>Qt?Qt:r,this._subParamsIdx[this.length-1]++}}},{key:"hasSubParams",value:function(r){return(this._subParamsIdx[r]&255)-(this._subParamsIdx[r]>>8)>0}},{key:"getSubParams",value:function(r){var t=this._subParamsIdx[r]>>8,e=this._subParamsIdx[r]&255;return e-t>0?this._subParams.subarray(t,e):null}},{key:"getSubParamsAll",value:function(){for(var r={},t=0;t<this.length;++t){var e=this._subParamsIdx[t]>>8,i=this._subParamsIdx[t]&255;i-e>0&&(r[t]=this._subParams.slice(e,i))}return r}},{key:"addDigit",value:function(r){var t;if(!(this._rejectDigits||!(t=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)){var e=this._digitIsSub?this._subParams:this.params,i=e[t-1];e[t-1]=~i?Math.min(i*10+r,Qt):r}}}],[{key:"fromArray",value:function(r){var t=new s;if(!r.length)return t;for(var e=Array.isArray(r[0])?1:0;e<r.length;++e){var i=r[e];if(Array.isArray(i))for(var n=0;n<i.length;++n)t.addSubParam(i[n]);else t.addParam(i)}return t}}]),s}(),er=[],Gl=function(){function s(){S(this,s),this._state=0,this._active=er,this._id=-1,this._handlers=Object.create(null),this._handlerFb=function(){},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}return k(s,[{key:"registerHandler",value:function(r,t){this._handlers[r]===void 0&&(this._handlers[r]=[]);var e=this._handlers[r];return e.push(t),{dispose:function(){var n=e.indexOf(t);n!==-1&&e.splice(n,1)}}}},{key:"clearHandler",value:function(r){this._handlers[r]&&delete this._handlers[r]}},{key:"setHandlerFallback",value:function(r){this._handlerFb=r}},{key:"dispose",value:function(){this._handlers=Object.create(null),this._handlerFb=function(){},this._active=er}},{key:"reset",value:function(){if(this._state===2)for(var r=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;r>=0;--r)this._active[r].end(!1);this._stack.paused=!1,this._active=er,this._id=-1,this._state=0}},{key:"_start",value:function(){if(this._active=this._handlers[this._id]||er,!this._active.length)this._handlerFb(this._id,"START");else for(var r=this._active.length-1;r>=0;r--)this._active[r].start()}},{key:"_put",value:function(r,t,e){if(!this._active.length)this._handlerFb(this._id,"PUT",ar(r,t,e));else for(var i=this._active.length-1;i>=0;i--)this._active[i].put(r,t,e)}},{key:"start",value:function(){this.reset(),this._state=1}},{key:"put",value:function(r,t,e){if(this._state!==3){if(this._state===1)for(;t<e;){var i=r[t++];if(i===59){this._state=2,this._start();break}if(i<48||57<i){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+i-48}this._state===2&&e-t>0&&this._put(r,t,e)}}},{key:"end",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",r);else{var e=!1,i=this._active.length-1,n=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,e=t,n=this._stack.fallThrough,this._stack.paused=!1),!n&&e===!1){for(;i>=0&&(e=this._active[i].end(r),e!==!0);i--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,e;i--}for(;i>=0;i--)if(e=this._active[i].end(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,e}this._active=er,this._id=-1,this._state=0}}}]),s}(),Fe=function(){function s(o){S(this,s),this._handler=o,this._data="",this._hitLimit=!1}return k(s,[{key:"start",value:function(){this._data="",this._hitLimit=!1}},{key:"put",value:function(r,t,e){this._hitLimit||(this._data+=ar(r,t,e),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}},{key:"end",value:function(r){var t=this,e=!1;if(this._hitLimit)e=!1;else if(r&&(e=this._handler(this._data),e instanceof Promise))return e.then(function(i){return t._data="",t._hitLimit=!1,i});return this._data="",this._hitLimit=!1,e}}]),s}(),tr=[],Xl=function(){function s(){S(this,s),this._handlers=Object.create(null),this._active=tr,this._ident=0,this._handlerFb=function(){},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}return k(s,[{key:"dispose",value:function(){this._handlers=Object.create(null),this._handlerFb=function(){},this._active=tr}},{key:"registerHandler",value:function(r,t){this._handlers[r]===void 0&&(this._handlers[r]=[]);var e=this._handlers[r];return e.push(t),{dispose:function(){var n=e.indexOf(t);n!==-1&&e.splice(n,1)}}}},{key:"clearHandler",value:function(r){this._handlers[r]&&delete this._handlers[r]}},{key:"setHandlerFallback",value:function(r){this._handlerFb=r}},{key:"reset",value:function(){if(this._active.length)for(var r=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;r>=0;--r)this._active[r].unhook(!1);this._stack.paused=!1,this._active=tr,this._ident=0}},{key:"hook",value:function(r,t){if(this.reset(),this._ident=r,this._active=this._handlers[r]||tr,!this._active.length)this._handlerFb(this._ident,"HOOK",t);else for(var e=this._active.length-1;e>=0;e--)this._active[e].hook(t)}},{key:"put",value:function(r,t,e){if(!this._active.length)this._handlerFb(this._ident,"PUT",ar(r,t,e));else for(var i=this._active.length-1;i>=0;i--)this._active[i].put(r,t,e)}},{key:"unhook",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",r);else{var e=!1,i=this._active.length-1,n=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,e=t,n=this._stack.fallThrough,this._stack.paused=!1),!n&&e===!1){for(;i>=0&&(e=this._active[i].unhook(r),e!==!0);i--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,e;i--}for(;i>=0;i--)if(e=this._active[i].unhook(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,e}this._active=tr,this._ident=0}}]),s}(),rr=new Ps;rr.addParam(0);var Ls=function(){function s(o){S(this,s),this._handler=o,this._data="",this._params=rr,this._hitLimit=!1}return k(s,[{key:"hook",value:function(r){this._params=r.length>1||r.params[0]?r.clone():rr,this._data="",this._hitLimit=!1}},{key:"put",value:function(r,t,e){this._hitLimit||(this._data+=ar(r,t,e),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}},{key:"unhook",value:function(r){var t=this,e=!1;if(this._hitLimit)e=!1;else if(r&&(e=this._handler(this._data,this._params),e instanceof Promise))return e.then(function(i){return t._params=rr,t._data="",t._hitLimit=!1,i});return this._params=rr,this._data="",this._hitLimit=!1,e}}]),s}(),Jl=function(){function s(o){S(this,s),this.table=new Uint8Array(o)}return k(s,[{key:"setDefault",value:function(r,t){this.table.fill(r<<4|t)}},{key:"add",value:function(r,t,e,i){this.table[t<<8|r]=e<<4|i}},{key:"addMany",value:function(r,t,e,i){for(var n=0;n<r.length;n++)this.table[t<<8|r[n]]=e<<4|i}}]),s}(),Ke=160,Ql=function(){var s=new Jl(4095),o=Array.apply(null,Array(256)).map(function(a,l){return l}),r=function(l,u){return o.slice(l,u)},t=r(32,127),e=r(0,24);e.push(25),e.push.apply(e,r(28,32));var i=r(0,14),n;s.setDefault(1,0),s.addMany(t,0,2,0);for(n in i)s.addMany([24,26,153,154],n,3,0),s.addMany(r(128,144),n,3,0),s.addMany(r(144,152),n,3,0),s.add(156,n,0,0),s.add(27,n,11,1),s.add(157,n,4,8),s.addMany([152,158,159],n,0,7),s.add(155,n,11,3),s.add(144,n,11,9);return s.addMany(e,0,3,0),s.addMany(e,1,3,1),s.add(127,1,0,1),s.addMany(e,8,0,8),s.addMany(e,3,3,3),s.add(127,3,0,3),s.addMany(e,4,3,4),s.add(127,4,0,4),s.addMany(e,6,3,6),s.addMany(e,5,3,5),s.add(127,5,0,5),s.addMany(e,2,3,2),s.add(127,2,0,2),s.add(93,1,4,8),s.addMany(t,8,5,8),s.add(127,8,5,8),s.addMany([156,27,24,26,7],8,6,0),s.addMany(r(28,32),8,0,8),s.addMany([88,94,95],1,0,7),s.addMany(t,7,0,7),s.addMany(e,7,0,7),s.add(156,7,0,0),s.add(127,7,0,7),s.add(91,1,11,3),s.addMany(r(64,127),3,7,0),s.addMany(r(48,60),3,8,4),s.addMany([60,61,62,63],3,9,4),s.addMany(r(48,60),4,8,4),s.addMany(r(64,127),4,7,0),s.addMany([60,61,62,63],4,0,6),s.addMany(r(32,64),6,0,6),s.add(127,6,0,6),s.addMany(r(64,127),6,0,0),s.addMany(r(32,48),3,9,5),s.addMany(r(32,48),5,9,5),s.addMany(r(48,64),5,0,6),s.addMany(r(64,127),5,7,0),s.addMany(r(32,48),4,9,5),s.addMany(r(32,48),1,9,2),s.addMany(r(32,48),2,9,2),s.addMany(r(48,127),2,10,0),s.addMany(r(48,80),1,10,0),s.addMany(r(81,88),1,10,0),s.addMany([89,90,92],1,10,0),s.addMany(r(96,127),1,10,0),s.add(80,1,11,9),s.addMany(e,9,0,9),s.add(127,9,0,9),s.addMany(r(28,32),9,0,9),s.addMany(r(32,48),9,9,12),s.addMany(r(48,60),9,8,10),s.addMany([60,61,62,63],9,9,10),s.addMany(e,11,0,11),s.addMany(r(32,128),11,0,11),s.addMany(r(28,32),11,0,11),s.addMany(e,10,0,10),s.add(127,10,0,10),s.addMany(r(28,32),10,0,10),s.addMany(r(48,60),10,8,10),s.addMany([60,61,62,63],10,0,11),s.addMany(r(32,48),10,9,12),s.addMany(e,12,0,12),s.add(127,12,0,12),s.addMany(r(28,32),12,0,12),s.addMany(r(32,48),12,9,12),s.addMany(r(48,64),12,0,11),s.addMany(r(64,127),12,12,13),s.addMany(r(64,127),10,12,13),s.addMany(r(64,127),9,12,13),s.addMany(e,13,13,13),s.addMany(t,13,13,13),s.add(127,13,0,13),s.addMany([27,156,24,26],13,14,0),s.add(Ke,0,2,0),s.add(Ke,8,5,8),s.add(Ke,6,0,6),s.add(Ke,11,0,11),s.add(Ke,13,13,13),s}(),ec=function(s){z(r,s);var o=U(r);function r(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ql;return S(this,r),t=o.call(this),t._transitions=e,t._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},t.initialState=0,t.currentState=t.initialState,t._params=new Ps,t._params.addParam(0),t._collect=0,t.precedingJoinState=0,t._printHandlerFb=function(i,n,a){},t._executeHandlerFb=function(i){},t._csiHandlerFb=function(i,n){},t._escHandlerFb=function(i){},t._errorHandlerFb=function(i){return i},t._printHandler=t._printHandlerFb,t._executeHandlers=Object.create(null),t._csiHandlers=Object.create(null),t._escHandlers=Object.create(null),t._register(ue(function(){t._csiHandlers=Object.create(null),t._executeHandlers=Object.create(null),t._escHandlers=Object.create(null)})),t._oscParser=t._register(new Gl),t._dcsParser=t._register(new Xl),t._errorHandler=t._errorHandlerFb,t.registerEscHandler({final:"\\"},function(){return!0}),t}return k(r,[{key:"_identifier",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[64,126],n=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(n=e.prefix.charCodeAt(0),n&&60>n||n>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(var a=0;a<e.intermediates.length;++a){var l=e.intermediates.charCodeAt(a);if(32>l||l>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");n<<=8,n|=l}}if(e.final.length!==1)throw new Error("final must be a single byte");var u=e.final.charCodeAt(0);if(i[0]>u||u>i[1])throw new Error("final must be in range ".concat(i[0]," .. ").concat(i[1]));return n<<=8,n|=u,n}},{key:"identToString",value:function(e){for(var i=[];e;)i.push(String.fromCharCode(e&255)),e>>=8;return i.reverse().join("")}},{key:"setPrintHandler",value:function(e){this._printHandler=e}},{key:"clearPrintHandler",value:function(){this._printHandler=this._printHandlerFb}},{key:"registerEscHandler",value:function(e,i){var n=this._identifier(e,[48,126]);this._escHandlers[n]===void 0&&(this._escHandlers[n]=[]);var a=this._escHandlers[n];return a.push(i),{dispose:function(){var u=a.indexOf(i);u!==-1&&a.splice(u,1)}}}},{key:"clearEscHandler",value:function(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}},{key:"setEscHandlerFallback",value:function(e){this._escHandlerFb=e}},{key:"setExecuteHandler",value:function(e,i){this._executeHandlers[e.charCodeAt(0)]=i}},{key:"clearExecuteHandler",value:function(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}},{key:"setExecuteHandlerFallback",value:function(e){this._executeHandlerFb=e}},{key:"registerCsiHandler",value:function(e,i){var n=this._identifier(e);this._csiHandlers[n]===void 0&&(this._csiHandlers[n]=[]);var a=this._csiHandlers[n];return a.push(i),{dispose:function(){var u=a.indexOf(i);u!==-1&&a.splice(u,1)}}}},{key:"clearCsiHandler",value:function(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}},{key:"setCsiHandlerFallback",value:function(e){this._csiHandlerFb=e}},{key:"registerDcsHandler",value:function(e,i){return this._dcsParser.registerHandler(this._identifier(e),i)}},{key:"clearDcsHandler",value:function(e){this._dcsParser.clearHandler(this._identifier(e))}},{key:"setDcsHandlerFallback",value:function(e){this._dcsParser.setHandlerFallback(e)}},{key:"registerOscHandler",value:function(e,i){return this._oscParser.registerHandler(e,i)}},{key:"clearOscHandler",value:function(e){this._oscParser.clearHandler(e)}},{key:"setOscHandlerFallback",value:function(e){this._oscParser.setHandlerFallback(e)}},{key:"setErrorHandler",value:function(e){this._errorHandler=e}},{key:"clearErrorHandler",value:function(){this._errorHandler=this._errorHandlerFb}},{key:"reset",value:function(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}},{key:"_preserveStack",value:function(e,i,n,a,l){this._parseStack.state=e,this._parseStack.handlers=i,this._parseStack.handlerPos=n,this._parseStack.transition=a,this._parseStack.chunkPos=l}},{key:"parse",value:function(e,i,n){var a=0,l=0,u=0,h;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,u=this._parseStack.chunkPos+1;else{if(n===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");var c=this._parseStack.handlers,d=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(n===!1&&d>-1){for(;d>=0&&(h=c[d](this._params),h!==!0);d--)if(h instanceof Promise)return this._parseStack.handlerPos=d,h}this._parseStack.handlers=[];break;case 4:if(n===!1&&d>-1){for(;d>=0&&(h=c[d](),h!==!0);d--)if(h instanceof Promise)return this._parseStack.handlerPos=d,h}this._parseStack.handlers=[];break;case 6:if(a=e[this._parseStack.chunkPos],h=this._dcsParser.unhook(a!==24&&a!==26,n),h)return h;a===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(a=e[this._parseStack.chunkPos],h=this._oscParser.end(a!==24&&a!==26,n),h)return h;a===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,u=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(var _=u;_<i;++_){switch(a=e[_],l=this._transitions.table[this.currentState<<8|(a<160?a:Ke)],l>>4){case 2:for(var v=_+1;;++v){if(v>=i||(a=e[v])<32||a>126&&a<Ke){this._printHandler(e,_,v),_=v-1;break}if(++v>=i||(a=e[v])<32||a>126&&a<Ke){this._printHandler(e,_,v),_=v-1;break}if(++v>=i||(a=e[v])<32||a>126&&a<Ke){this._printHandler(e,_,v),_=v-1;break}if(++v>=i||(a=e[v])<32||a>126&&a<Ke){this._printHandler(e,_,v),_=v-1;break}}break;case 3:this._executeHandlers[a]?this._executeHandlers[a]():this._executeHandlerFb(a),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:_,code:a,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:for(var f=this._csiHandlers[this._collect<<8|a],m=f?f.length-1:-1;m>=0&&(h=f[m](this._params),h!==!0);m--)if(h instanceof Promise)return this._preserveStack(3,f,m,l,_),h;m<0&&this._csiHandlerFb(this._collect<<8|a,this._params),this.precedingJoinState=0;break;case 8:do switch(a){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(a-48)}while(++_<i&&(a=e[_])>47&&a<60);_--;break;case 9:this._collect<<=8,this._collect|=a;break;case 10:for(var g=this._escHandlers[this._collect<<8|a],w=g?g.length-1:-1;w>=0&&(h=g[w](),h!==!0);w--)if(h instanceof Promise)return this._preserveStack(4,g,w,l,_),h;w<0&&this._escHandlerFb(this._collect<<8|a),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|a,this._params);break;case 13:for(var y=_+1;;++y)if(y>=i||(a=e[y])===24||a===26||a===27||a>127&&a<Ke){this._dcsParser.put(e,_,y),_=y-1;break}break;case 14:if(h=this._dcsParser.unhook(a!==24&&a!==26),h)return this._preserveStack(6,[],0,l,_),h;a===27&&(l|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(var b=_+1;;b++)if(b>=i||(a=e[b])<32||a>127&&a<Ke){this._oscParser.put(e,_,b),_=b-1;break}break;case 6:if(h=this._oscParser.end(a!==24&&a!==26),h)return this._preserveStack(5,[],0,l,_),h;a===27&&(l|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=l&15}}}]),r}(G),tc=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,rc=/^[\da-f]+$/;function Bs(s){if(s){var o=s.toLowerCase();if(o.indexOf("rgb:")===0){o=o.slice(4);var r=tc.exec(o);if(r){var t=r[1]?15:r[4]?255:r[7]?4095:65535;return[Math.round(parseInt(r[1]||r[4]||r[7]||r[10],16)/t*255),Math.round(parseInt(r[2]||r[5]||r[8]||r[11],16)/t*255),Math.round(parseInt(r[3]||r[6]||r[9]||r[12],16)/t*255)]}}else if(o.indexOf("#")===0&&(o=o.slice(1),rc.exec(o)&&[3,6,9,12].includes(o.length))){for(var e=o.length/3,i=[0,0,0],n=0;n<3;++n){var a=parseInt(o.slice(e*n,e*n+e),16);i[n]=e===1?a<<4:e===2?a:e===3?a>>4:a>>8}return i}}}function Vi(s,o){var r=s.toString(16),t=r.length<2?"0"+r:r;switch(o){case 4:return r[0];case 8:return t;case 12:return(t+t).slice(0,3);default:return t+t}}function ic(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=ne(s,3),t=r[0],e=r[1],i=r[2];return"rgb:".concat(Vi(t,o),"/").concat(Vi(e,o),"/").concat(Vi(i,o))}var nc={"(":0,")":1,"*":2,"+":3,"-":1,".":2},vt=131072,Rs=10;function Ms(s,o){if(s>24)return o.setWinLines||!1;switch(s){case 1:return!!o.restoreWin;case 2:return!!o.minimizeWin;case 3:return!!o.setWinPosition;case 4:return!!o.setWinSizePixels;case 5:return!!o.raiseWin;case 6:return!!o.lowerWin;case 7:return!!o.refreshWin;case 8:return!!o.setWinSizeChars;case 9:return!!o.maximizeWin;case 10:return!!o.fullscreenWin;case 11:return!!o.getWinState;case 13:return!!o.getWinPosition;case 14:return!!o.getWinSizePixels;case 15:return!!o.getScreenSizePixels;case 16:return!!o.getCellSizePixels;case 18:return!!o.getWinSizeChars;case 19:return!!o.getScreenSizeChars;case 20:return!!o.getIconTitle;case 21:return!!o.getWinTitle;case 22:return!!o.pushTitle;case 23:return!!o.popTitle;case 24:return!!o.setWinLines}return!1}var As=5e3,Ts=0,sc=function(s){z(r,s);var o=U(r);function r(t,e,i,n,a,l,u,h){var c,d=arguments.length>8&&arguments[8]!==void 0?arguments[8]:new ec;S(this,r),c=o.call(this),c._bufferService=t,c._charsetService=e,c._coreService=i,c._logService=n,c._optionsService=a,c._oscLinkService=l,c._coreMouseService=u,c._unicodeService=h,c._parser=d,c._parseBuffer=new Uint32Array(4096),c._stringDecoder=new Xs,c._utf8Decoder=new Js,c._windowTitle="",c._iconName="",c._windowTitleStack=[],c._iconNameStack=[],c._curAttrData=ke.clone(),c._eraseAttrDataInternal=ke.clone(),c._onRequestBell=c._register(new M),c.onRequestBell=c._onRequestBell.event,c._onRequestRefreshRows=c._register(new M),c.onRequestRefreshRows=c._onRequestRefreshRows.event,c._onRequestReset=c._register(new M),c.onRequestReset=c._onRequestReset.event,c._onRequestSendFocus=c._register(new M),c.onRequestSendFocus=c._onRequestSendFocus.event,c._onRequestSyncScrollBar=c._register(new M),c.onRequestSyncScrollBar=c._onRequestSyncScrollBar.event,c._onRequestWindowsOptionsReport=c._register(new M),c.onRequestWindowsOptionsReport=c._onRequestWindowsOptionsReport.event,c._onA11yChar=c._register(new M),c.onA11yChar=c._onA11yChar.event,c._onA11yTab=c._register(new M),c.onA11yTab=c._onA11yTab.event,c._onCursorMove=c._register(new M),c.onCursorMove=c._onCursorMove.event,c._onLineFeed=c._register(new M),c.onLineFeed=c._onLineFeed.event,c._onScroll=c._register(new M),c.onScroll=c._onScroll.event,c._onTitleChange=c._register(new M),c.onTitleChange=c._onTitleChange.event,c._onColor=c._register(new M),c.onColor=c._onColor.event,c._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},c._specialColors=[256,257,258],c._register(c._parser),c._dirtyRowTracker=new Zi(c._bufferService),c._activeBuffer=c._bufferService.buffer,c._register(c._bufferService.buffers.onBufferActivate(function(f){return c._activeBuffer=f.activeBuffer})),c._parser.setCsiHandlerFallback(function(f,m){c._logService.debug("Unknown CSI code: ",{identifier:c._parser.identToString(f),params:m.toArray()})}),c._parser.setEscHandlerFallback(function(f){c._logService.debug("Unknown ESC code: ",{identifier:c._parser.identToString(f)})}),c._parser.setExecuteHandlerFallback(function(f){c._logService.debug("Unknown EXECUTE code: ",{code:f})}),c._parser.setOscHandlerFallback(function(f,m,g){c._logService.debug("Unknown OSC code: ",{identifier:f,action:m,data:g})}),c._parser.setDcsHandlerFallback(function(f,m,g){m==="HOOK"&&(g=g.toArray()),c._logService.debug("Unknown DCS code: ",{identifier:c._parser.identToString(f),action:m,payload:g})}),c._parser.setPrintHandler(function(f,m,g){return c.print(f,m,g)}),c._parser.registerCsiHandler({final:"@"},function(f){return c.insertChars(f)}),c._parser.registerCsiHandler({intermediates:" ",final:"@"},function(f){return c.scrollLeft(f)}),c._parser.registerCsiHandler({final:"A"},function(f){return c.cursorUp(f)}),c._parser.registerCsiHandler({intermediates:" ",final:"A"},function(f){return c.scrollRight(f)}),c._parser.registerCsiHandler({final:"B"},function(f){return c.cursorDown(f)}),c._parser.registerCsiHandler({final:"C"},function(f){return c.cursorForward(f)}),c._parser.registerCsiHandler({final:"D"},function(f){return c.cursorBackward(f)}),c._parser.registerCsiHandler({final:"E"},function(f){return c.cursorNextLine(f)}),c._parser.registerCsiHandler({final:"F"},function(f){return c.cursorPrecedingLine(f)}),c._parser.registerCsiHandler({final:"G"},function(f){return c.cursorCharAbsolute(f)}),c._parser.registerCsiHandler({final:"H"},function(f){return c.cursorPosition(f)}),c._parser.registerCsiHandler({final:"I"},function(f){return c.cursorForwardTab(f)}),c._parser.registerCsiHandler({final:"J"},function(f){return c.eraseInDisplay(f,!1)}),c._parser.registerCsiHandler({prefix:"?",final:"J"},function(f){return c.eraseInDisplay(f,!0)}),c._parser.registerCsiHandler({final:"K"},function(f){return c.eraseInLine(f,!1)}),c._parser.registerCsiHandler({prefix:"?",final:"K"},function(f){return c.eraseInLine(f,!0)}),c._parser.registerCsiHandler({final:"L"},function(f){return c.insertLines(f)}),c._parser.registerCsiHandler({final:"M"},function(f){return c.deleteLines(f)}),c._parser.registerCsiHandler({final:"P"},function(f){return c.deleteChars(f)}),c._parser.registerCsiHandler({final:"S"},function(f){return c.scrollUp(f)}),c._parser.registerCsiHandler({final:"T"},function(f){return c.scrollDown(f)}),c._parser.registerCsiHandler({final:"X"},function(f){return c.eraseChars(f)}),c._parser.registerCsiHandler({final:"Z"},function(f){return c.cursorBackwardTab(f)}),c._parser.registerCsiHandler({final:"`"},function(f){return c.charPosAbsolute(f)}),c._parser.registerCsiHandler({final:"a"},function(f){return c.hPositionRelative(f)}),c._parser.registerCsiHandler({final:"b"},function(f){return c.repeatPrecedingCharacter(f)}),c._parser.registerCsiHandler({final:"c"},function(f){return c.sendDeviceAttributesPrimary(f)}),c._parser.registerCsiHandler({prefix:">",final:"c"},function(f){return c.sendDeviceAttributesSecondary(f)}),c._parser.registerCsiHandler({final:"d"},function(f){return c.linePosAbsolute(f)}),c._parser.registerCsiHandler({final:"e"},function(f){return c.vPositionRelative(f)}),c._parser.registerCsiHandler({final:"f"},function(f){return c.hVPosition(f)}),c._parser.registerCsiHandler({final:"g"},function(f){return c.tabClear(f)}),c._parser.registerCsiHandler({final:"h"},function(f){return c.setMode(f)}),c._parser.registerCsiHandler({prefix:"?",final:"h"},function(f){return c.setModePrivate(f)}),c._parser.registerCsiHandler({final:"l"},function(f){return c.resetMode(f)}),c._parser.registerCsiHandler({prefix:"?",final:"l"},function(f){return c.resetModePrivate(f)}),c._parser.registerCsiHandler({final:"m"},function(f){return c.charAttributes(f)}),c._parser.registerCsiHandler({final:"n"},function(f){return c.deviceStatus(f)}),c._parser.registerCsiHandler({prefix:"?",final:"n"},function(f){return c.deviceStatusPrivate(f)}),c._parser.registerCsiHandler({intermediates:"!",final:"p"},function(f){return c.softReset(f)}),c._parser.registerCsiHandler({intermediates:" ",final:"q"},function(f){return c.setCursorStyle(f)}),c._parser.registerCsiHandler({final:"r"},function(f){return c.setScrollRegion(f)}),c._parser.registerCsiHandler({final:"s"},function(f){return c.saveCursor(f)}),c._parser.registerCsiHandler({final:"t"},function(f){return c.windowOptions(f)}),c._parser.registerCsiHandler({final:"u"},function(f){return c.restoreCursor(f)}),c._parser.registerCsiHandler({intermediates:"'",final:"}"},function(f){return c.insertColumns(f)}),c._parser.registerCsiHandler({intermediates:"'",final:"~"},function(f){return c.deleteColumns(f)}),c._parser.registerCsiHandler({intermediates:'"',final:"q"},function(f){return c.selectProtected(f)}),c._parser.registerCsiHandler({intermediates:"$",final:"p"},function(f){return c.requestMode(f,!0)}),c._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},function(f){return c.requestMode(f,!1)}),c._parser.setExecuteHandler(E.BEL,function(){return c.bell()}),c._parser.setExecuteHandler(E.LF,function(){return c.lineFeed()}),c._parser.setExecuteHandler(E.VT,function(){return c.lineFeed()}),c._parser.setExecuteHandler(E.FF,function(){return c.lineFeed()}),c._parser.setExecuteHandler(E.CR,function(){return c.carriageReturn()}),c._parser.setExecuteHandler(E.BS,function(){return c.backspace()}),c._parser.setExecuteHandler(E.HT,function(){return c.tab()}),c._parser.setExecuteHandler(E.SO,function(){return c.shiftOut()}),c._parser.setExecuteHandler(E.SI,function(){return c.shiftIn()}),c._parser.setExecuteHandler(zt.IND,function(){return c.index()}),c._parser.setExecuteHandler(zt.NEL,function(){return c.nextLine()}),c._parser.setExecuteHandler(zt.HTS,function(){return c.tabSet()}),c._parser.registerOscHandler(0,new Fe(function(f){return c.setTitle(f),c.setIconName(f),!0})),c._parser.registerOscHandler(1,new Fe(function(f){return c.setIconName(f)})),c._parser.registerOscHandler(2,new Fe(function(f){return c.setTitle(f)})),c._parser.registerOscHandler(4,new Fe(function(f){return c.setOrReportIndexedColor(f)})),c._parser.registerOscHandler(8,new Fe(function(f){return c.setHyperlink(f)})),c._parser.registerOscHandler(10,new Fe(function(f){return c.setOrReportFgColor(f)})),c._parser.registerOscHandler(11,new Fe(function(f){return c.setOrReportBgColor(f)})),c._parser.registerOscHandler(12,new Fe(function(f){return c.setOrReportCursorColor(f)})),c._parser.registerOscHandler(104,new Fe(function(f){return c.restoreIndexedColor(f)})),c._parser.registerOscHandler(110,new Fe(function(f){return c.restoreFgColor(f)})),c._parser.registerOscHandler(111,new Fe(function(f){return c.restoreBgColor(f)})),c._parser.registerOscHandler(112,new Fe(function(f){return c.restoreCursorColor(f)})),c._parser.registerEscHandler({final:"7"},function(){return c.saveCursor()}),c._parser.registerEscHandler({final:"8"},function(){return c.restoreCursor()}),c._parser.registerEscHandler({final:"D"},function(){return c.index()}),c._parser.registerEscHandler({final:"E"},function(){return c.nextLine()}),c._parser.registerEscHandler({final:"H"},function(){return c.tabSet()}),c._parser.registerEscHandler({final:"M"},function(){return c.reverseIndex()}),c._parser.registerEscHandler({final:"="},function(){return c.keypadApplicationMode()}),c._parser.registerEscHandler({final:">"},function(){return c.keypadNumericMode()}),c._parser.registerEscHandler({final:"c"},function(){return c.fullReset()}),c._parser.registerEscHandler({final:"n"},function(){return c.setgLevel(2)}),c._parser.registerEscHandler({final:"o"},function(){return c.setgLevel(3)}),c._parser.registerEscHandler({final:"|"},function(){return c.setgLevel(3)}),c._parser.registerEscHandler({final:"}"},function(){return c.setgLevel(2)}),c._parser.registerEscHandler({final:"~"},function(){return c.setgLevel(1)}),c._parser.registerEscHandler({intermediates:"%",final:"@"},function(){return c.selectDefaultCharset()}),c._parser.registerEscHandler({intermediates:"%",final:"G"},function(){return c.selectDefaultCharset()});var _=function(m){c._parser.registerEscHandler({intermediates:"(",final:m},function(){return c.selectCharset("("+m)}),c._parser.registerEscHandler({intermediates:")",final:m},function(){return c.selectCharset(")"+m)}),c._parser.registerEscHandler({intermediates:"*",final:m},function(){return c.selectCharset("*"+m)}),c._parser.registerEscHandler({intermediates:"+",final:m},function(){return c.selectCharset("+"+m)}),c._parser.registerEscHandler({intermediates:"-",final:m},function(){return c.selectCharset("-"+m)}),c._parser.registerEscHandler({intermediates:".",final:m},function(){return c.selectCharset("."+m)}),c._parser.registerEscHandler({intermediates:"/",final:m},function(){return c.selectCharset("/"+m)})};for(var v in we)_(v);return c._parser.registerEscHandler({intermediates:"#",final:"8"},function(){return c.screenAlignmentPattern()}),c._parser.setErrorHandler(function(f){return c._logService.error("Parsing error: ",f),f}),c._parser.registerDcsHandler({intermediates:"$",final:"q"},new Ls(function(f,m){return c.requestStatusString(f,m)})),c}return k(r,[{key:"getAttrData",value:function(){return this._curAttrData}},{key:"_preserveStack",value:function(e,i,n,a){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=i,this._parseStack.decodedLength=n,this._parseStack.position=a}},{key:"_logSlowResolvingAsync",value:function(e){this._logService.logLevel<=3&&Promise.race([e,new Promise(function(i,n){return setTimeout(function(){return n("#SLOW_TIMEOUT")},As)})]).catch(function(i){if(i!=="#SLOW_TIMEOUT")throw i;console.warn("async parser handler taking longer than ".concat(As," ms"))})}},{key:"_getCurrentLinkId",value:function(){return this._curAttrData.extended.urlId}},{key:"parse",value:function(e,i){var n,a=this._activeBuffer.x,l=this._activeBuffer.y,u=0,h=this._parseStack.paused;if(h){if(n=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,i))return this._logSlowResolvingAsync(n),n;a=this._parseStack.cursorStartX,l=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>vt&&(u=this._parseStack.position+vt)}if(this._logService.logLevel<=1&&this._logService.debug("parsing data ".concat(typeof e=="string"?' "'.concat(e,'"'):' "'.concat(Array.prototype.map.call(e,function(g){return String.fromCharCode(g)}).join(""),'"'))),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof e=="string"?e.split("").map(function(g){return g.charCodeAt(0)}):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<vt&&(this._parseBuffer=new Uint32Array(Math.min(e.length,vt))),h||this._dirtyRowTracker.clearRange(),e.length>vt)for(var c=u;c<e.length;c+=vt){var d=c+vt<e.length?c+vt:e.length,_=typeof e=="string"?this._stringDecoder.decode(e.substring(c,d),this._parseBuffer):this._utf8Decoder.decode(e.subarray(c,d),this._parseBuffer);if(n=this._parser.parse(this._parseBuffer,_))return this._preserveStack(a,l,_,c),this._logSlowResolvingAsync(n),n}else if(!h){var v=typeof e=="string"?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(n=this._parser.parse(this._parseBuffer,v))return this._preserveStack(a,l,v,0),this._logSlowResolvingAsync(n),n}(this._activeBuffer.x!==a||this._activeBuffer.y!==l)&&this._onCursorMove.fire();var f=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),m=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);m<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(m,this._bufferService.rows-1),end:Math.min(f,this._bufferService.rows-1)})}},{key:"print",value:function(e,i,n){var a,l,u=this._charsetService.charset,h=this._optionsService.rawOptions.screenReaderMode,c=this._bufferService.cols,d=this._coreService.decPrivateModes.wraparound,_=this._coreService.modes.insertMode,v=this._curAttrData,f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&n-i>0&&f.getWidth(this._activeBuffer.x-1)===2&&f.setCellFromCodepoint(this._activeBuffer.x-1,0,1,v);for(var m=this._parser.precedingJoinState,g=i;g<n;++g){if(a=e[g],a<127&&u){var w=u[String.fromCharCode(a)];w&&(a=w.charCodeAt(0))}var y=this._unicodeService.charProperties(a,m);l=xt.extractWidth(y);var b=xt.extractShouldJoin(y),A=b?xt.extractWidth(m):0;if(m=y,h&&this._onA11yChar.fire(ct(a)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+l-A>c){if(d){var ee=f,se=this._activeBuffer.x-A;for(this._activeBuffer.x=A,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),A>0&&f instanceof Gt&&f.copyCellsFrom(ee,se,0,A,!1);se<c;)ee.setCellFromCodepoint(se++,0,1,v)}else if(this._activeBuffer.x=c-1,l===2)continue}if(b&&this._activeBuffer.x){var he=f.getWidth(this._activeBuffer.x-1)?1:2;f.addCodepointToCell(this._activeBuffer.x-he,a,l);for(var te=l-A;--te>=0;)f.setCellFromCodepoint(this._activeBuffer.x++,0,0,v);continue}if(_&&(f.insertCells(this._activeBuffer.x,l-A,this._activeBuffer.getNullCell(v)),f.getWidth(c-1)===2&&f.setCellFromCodepoint(c-1,0,1,v)),f.setCellFromCodepoint(this._activeBuffer.x++,a,l,v),l>0)for(;--l;)f.setCellFromCodepoint(this._activeBuffer.x++,0,0,v)}this._parser.precedingJoinState=m,this._activeBuffer.x<c&&n-i>0&&f.getWidth(this._activeBuffer.x)===0&&!f.hasContent(this._activeBuffer.x)&&f.setCellFromCodepoint(this._activeBuffer.x,0,1,v),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}},{key:"registerCsiHandler",value:function(e,i){var n=this;return e.final==="t"&&!e.prefix&&!e.intermediates?this._parser.registerCsiHandler(e,function(a){return Ms(a.params[0],n._optionsService.rawOptions.windowOptions)?i(a):!0}):this._parser.registerCsiHandler(e,i)}},{key:"registerDcsHandler",value:function(e,i){return this._parser.registerDcsHandler(e,new Ls(i))}},{key:"registerEscHandler",value:function(e,i){return this._parser.registerEscHandler(e,i)}},{key:"registerOscHandler",value:function(e,i){return this._parser.registerOscHandler(e,new Fe(i))}},{key:"bell",value:function(){return this._onRequestBell.fire(),!0}},{key:"lineFeed",value:function(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}},{key:"carriageReturn",value:function(){return this._activeBuffer.x=0,!0}},{key:"backspace",value:function(){var e;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!==null&&e!==void 0&&e.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;var i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);i.hasWidth(this._activeBuffer.x)&&!i.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}},{key:"tab",value:function(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;var e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}},{key:"shiftOut",value:function(){return this._charsetService.setgLevel(1),!0}},{key:"shiftIn",value:function(){return this._charsetService.setgLevel(0),!0}},{key:"_restrictCursor",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._bufferService.cols-1;this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}},{key:"_setCursor",value:function(e,i){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+i):(this._activeBuffer.x=e,this._activeBuffer.y=i),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}},{key:"_moveCursor",value:function(e,i){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+i)}},{key:"cursorUp",value:function(e){var i=this._activeBuffer.y-this._activeBuffer.scrollTop;return i>=0?this._moveCursor(0,-Math.min(i,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}},{key:"cursorDown",value:function(e){var i=this._activeBuffer.scrollBottom-this._activeBuffer.y;return i>=0?this._moveCursor(0,Math.min(i,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}},{key:"cursorForward",value:function(e){return this._moveCursor(e.params[0]||1,0),!0}},{key:"cursorBackward",value:function(e){return this._moveCursor(-(e.params[0]||1),0),!0}},{key:"cursorNextLine",value:function(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}},{key:"cursorPrecedingLine",value:function(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}},{key:"cursorCharAbsolute",value:function(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}},{key:"cursorPosition",value:function(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}},{key:"charPosAbsolute",value:function(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}},{key:"hPositionRelative",value:function(e){return this._moveCursor(e.params[0]||1,0),!0}},{key:"linePosAbsolute",value:function(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}},{key:"vPositionRelative",value:function(e){return this._moveCursor(0,e.params[0]||1),!0}},{key:"hVPosition",value:function(e){return this.cursorPosition(e),!0}},{key:"tabClear",value:function(e){var i=e.params[0];return i===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:i===3&&(this._activeBuffer.tabs={}),!0}},{key:"cursorForwardTab",value:function(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;for(var i=e.params[0]||1;i--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}},{key:"cursorBackwardTab",value:function(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;for(var i=e.params[0]||1;i--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}},{key:"selectProtected",value:function(e){var i=e.params[0];return i===1&&(this._curAttrData.bg|=536870912),(i===2||i===0)&&(this._curAttrData.bg&=-536870913),!0}},{key:"_eraseInBufferLine",value:function(e,i,n){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,u=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);u.replaceCells(i,n,this._activeBuffer.getNullCell(this._eraseAttrData()),l),a&&(u.isWrapped=!1)}},{key:"_resetBufferLine",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n&&(n.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),i),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),n.isWrapped=!1)}},{key:"eraseInDisplay",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this._restrictCursor(this._bufferService.cols);var n;switch(e.params[0]){case 0:for(n=this._activeBuffer.y,this._dirtyRowTracker.markDirty(n),this._eraseInBufferLine(n++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,i);n<this._bufferService.rows;n++)this._resetBufferLine(n,i);this._dirtyRowTracker.markDirty(n);break;case 1:for(n=this._activeBuffer.y,this._dirtyRowTracker.markDirty(n),this._eraseInBufferLine(n,0,this._activeBuffer.x+1,!0,i),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(n+1).isWrapped=!1);n--;)this._resetBufferLine(n,i);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(n=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,n-1);n--&&!((a=this._activeBuffer.lines.get(this._activeBuffer.ybase+n))!==null&&a!==void 0&&a.getTrimmedLength());)var a;for(;n>=0;n--)this._bufferService.scroll(this._eraseAttrData())}else{for(n=this._bufferService.rows,this._dirtyRowTracker.markDirty(n-1);n--;)this._resetBufferLine(n,i);this._dirtyRowTracker.markDirty(0)}break;case 3:var l=this._activeBuffer.lines.length-this._bufferService.rows;l>0&&(this._activeBuffer.lines.trimStart(l),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-l,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-l,0),this._onScroll.fire(0));break}return!0}},{key:"eraseInLine",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,i);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,i);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,i);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}},{key:"insertLines",value:function(e){this._restrictCursor();var i=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var n=this._activeBuffer.ybase+this._activeBuffer.y,a=this._bufferService.rows-1-this._activeBuffer.scrollBottom,l=this._bufferService.rows-1+this._activeBuffer.ybase-a+1;i--;)this._activeBuffer.lines.splice(l-1,1),this._activeBuffer.lines.splice(n,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}},{key:"deleteLines",value:function(e){this._restrictCursor();var i=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;var n=this._activeBuffer.ybase+this._activeBuffer.y,a;for(a=this._bufferService.rows-1-this._activeBuffer.scrollBottom,a=this._bufferService.rows-1+this._activeBuffer.ybase-a;i--;)this._activeBuffer.lines.splice(n,1),this._activeBuffer.lines.splice(a,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}},{key:"insertChars",value:function(e){this._restrictCursor();var i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}},{key:"deleteChars",value:function(e){this._restrictCursor();var i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}},{key:"scrollUp",value:function(e){for(var i=e.params[0]||1;i--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"scrollDown",value:function(e){for(var i=e.params[0]||1;i--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(ke));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"scrollLeft",value:function(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var i=e.params[0]||1,n=this._activeBuffer.scrollTop;n<=this._activeBuffer.scrollBottom;++n){var a=this._activeBuffer.lines.get(this._activeBuffer.ybase+n);a.deleteCells(0,i,this._activeBuffer.getNullCell(this._eraseAttrData())),a.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"scrollRight",value:function(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var i=e.params[0]||1,n=this._activeBuffer.scrollTop;n<=this._activeBuffer.scrollBottom;++n){var a=this._activeBuffer.lines.get(this._activeBuffer.ybase+n);a.insertCells(0,i,this._activeBuffer.getNullCell(this._eraseAttrData())),a.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"insertColumns",value:function(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var i=e.params[0]||1,n=this._activeBuffer.scrollTop;n<=this._activeBuffer.scrollBottom;++n){var a=this._activeBuffer.lines.get(this._activeBuffer.ybase+n);a.insertCells(this._activeBuffer.x,i,this._activeBuffer.getNullCell(this._eraseAttrData())),a.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"deleteColumns",value:function(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var i=e.params[0]||1,n=this._activeBuffer.scrollTop;n<=this._activeBuffer.scrollBottom;++n){var a=this._activeBuffer.lines.get(this._activeBuffer.ybase+n);a.deleteCells(this._activeBuffer.x,i,this._activeBuffer.getNullCell(this._eraseAttrData())),a.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}},{key:"eraseChars",value:function(e){this._restrictCursor();var i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}},{key:"repeatPrecedingCharacter",value:function(e){var i=this._parser.precedingJoinState;if(!i)return!0;for(var n=e.params[0]||1,a=xt.extractWidth(i),l=this._activeBuffer.x-a,u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(l),h=new Uint32Array(u.length*n),c=0,d=0;d<u.length;){var _=u.codePointAt(d)||0;h[c++]=_,d+=_>65535?2:1}for(var v=c,f=1;f<n;++f)h.copyWithin(v,0,c),v+=c;return this.print(h,0,v),!0}},{key:"sendDeviceAttributesPrimary",value:function(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(E.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(E.ESC+"[?6c")),!0}},{key:"sendDeviceAttributesSecondary",value:function(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(E.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(E.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(E.ESC+"[>83;40003;0c")),!0}},{key:"_is",value:function(e){return(this._optionsService.rawOptions.termName+"").indexOf(e)===0}},{key:"setMode",value:function(e){for(var i=0;i<e.length;i++)switch(e.params[i]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}},{key:"setModePrivate",value:function(e){for(var i=0;i<e.length;i++)switch(e.params[i]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,Et),this._charsetService.setgCharset(1,Et),this._charsetService.setgCharset(2,Et),this._charsetService.setgCharset(3,Et);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}},{key:"resetMode",value:function(e){for(var i=0;i<e.length;i++)switch(e.params[i]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}},{key:"resetModePrivate",value:function(e){for(var i=0;i<e.length;i++)switch(e.params[i]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),e.params[i]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}},{key:"requestMode",value:function(e,i){var n;(function(A){return A[A.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",A[A.SET=1]="SET",A[A.RESET=2]="RESET",A[A.PERMANENTLY_SET=3]="PERMANENTLY_SET",A[A.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"})(n||(n={}));var a=this._coreService.decPrivateModes,l=this._coreMouseService,u=l.activeProtocol,h=l.activeEncoding,c=this._coreService,d=this._bufferService,_=d.buffers,v=d.cols,f=_.active,m=_.alt,g=this._optionsService.rawOptions,w=function(ee,se){return c.triggerDataEvent("".concat(E.ESC,"[").concat(i?"":"?").concat(ee,";").concat(se,"$y")),!0},y=function(ee){return ee?1:2},b=e.params[0];return i?b===2?w(b,4):b===4?w(b,y(c.modes.insertMode)):b===12?w(b,3):b===20?w(b,y(g.convertEol)):w(b,0):b===1?w(b,y(a.applicationCursorKeys)):b===3?w(b,g.windowOptions.setWinLines?v===80?2:v===132?1:0:0):b===6?w(b,y(a.origin)):b===7?w(b,y(a.wraparound)):b===8?w(b,3):b===9?w(b,y(u==="X10")):b===12?w(b,y(g.cursorBlink)):b===25?w(b,y(!c.isCursorHidden)):b===45?w(b,y(a.reverseWraparound)):b===66?w(b,y(a.applicationKeypad)):b===67?w(b,4):b===1e3?w(b,y(u==="VT200")):b===1002?w(b,y(u==="DRAG")):b===1003?w(b,y(u==="ANY")):b===1004?w(b,y(a.sendFocus)):b===1005?w(b,4):b===1006?w(b,y(h==="SGR")):b===1015?w(b,4):b===1016?w(b,y(h==="SGR_PIXELS")):b===1048?w(b,1):b===47||b===1047||b===1049?w(b,y(f===m)):b===2004?w(b,y(a.bracketedPasteMode)):b===2026?w(b,y(a.synchronizedOutput)):w(b,0)}},{key:"_updateAttrColor",value:function(e,i,n,a,l){return i===2?(e|=50331648,e&=-16777216,e|=Rt.fromColorRGB([n,a,l])):i===5&&(e&=-50331904,e|=33554432|n&255),e}},{key:"_extractColor",value:function(e,i,n){var a=[0,0,-1,0,0,0],l=0,u=0;do{if(a[u+l]=e.params[i+u],e.hasSubParams(i+u)){var h=e.getSubParams(i+u),c=0;do a[1]===5&&(l=1),a[u+c+1+l]=h[c];while(++c<h.length&&c+u+1+l<a.length);break}if(a[1]===5&&u+l>=2||a[1]===2&&u+l>=5)break;a[1]&&(l=1)}while(++u+i<e.length&&u+l<a.length);for(var d=2;d<a.length;++d)a[d]===-1&&(a[d]=0);switch(a[0]){case 38:n.fg=this._updateAttrColor(n.fg,a[1],a[3],a[4],a[5]);break;case 48:n.bg=this._updateAttrColor(n.bg,a[1],a[3],a[4],a[5]);break;case 58:n.extended=n.extended.clone(),n.extended.underlineColor=this._updateAttrColor(n.extended.underlineColor,a[1],a[3],a[4],a[5])}return u}},{key:"_processUnderline",value:function(e,i){i.extended=i.extended.clone(),(!~e||e>5)&&(e=1),i.extended.underlineStyle=e,i.fg|=268435456,e===0&&(i.fg&=-268435457),i.updateExtended()}},{key:"_processSGR0",value:function(e){e.fg=ke.fg,e.bg=ke.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}},{key:"charAttributes",value:function(e){if(e.length===1&&e.params[0]===0)return this._processSGR0(this._curAttrData),!0;for(var i=e.length,n,a=this._curAttrData,l=0;l<i;l++)n=e.params[l],n>=30&&n<=37?(a.fg&=-50331904,a.fg|=16777216|n-30):n>=40&&n<=47?(a.bg&=-50331904,a.bg|=16777216|n-40):n>=90&&n<=97?(a.fg&=-50331904,a.fg|=16777216|n-90|8):n>=100&&n<=107?(a.bg&=-50331904,a.bg|=16777216|n-100|8):n===0?this._processSGR0(a):n===1?a.fg|=134217728:n===3?a.bg|=67108864:n===4?(a.fg|=268435456,this._processUnderline(e.hasSubParams(l)?e.getSubParams(l)[0]:1,a)):n===5?a.fg|=536870912:n===7?a.fg|=67108864:n===8?a.fg|=1073741824:n===9?a.fg|=2147483648:n===2?a.bg|=134217728:n===21?this._processUnderline(2,a):n===22?(a.fg&=-134217729,a.bg&=-134217729):n===23?a.bg&=-67108865:n===24?(a.fg&=-268435457,this._processUnderline(0,a)):n===25?a.fg&=-536870913:n===27?a.fg&=-67108865:n===28?a.fg&=-1073741825:n===29?a.fg&=2147483647:n===39?(a.fg&=-67108864,a.fg|=ke.fg&16777215):n===49?(a.bg&=-67108864,a.bg|=ke.bg&16777215):n===38||n===48||n===58?l+=this._extractColor(e,l,a):n===53?a.bg|=1073741824:n===55?a.bg&=-1073741825:n===59?(a.extended=a.extended.clone(),a.extended.underlineColor=-1,a.updateExtended()):n===100?(a.fg&=-67108864,a.fg|=ke.fg&16777215,a.bg&=-67108864,a.bg|=ke.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",n);return!0}},{key:"deviceStatus",value:function(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent("".concat(E.ESC,"[0n"));break;case 6:var i=this._activeBuffer.y+1,n=this._activeBuffer.x+1;this._coreService.triggerDataEvent("".concat(E.ESC,"[").concat(i,";").concat(n,"R"));break}return!0}},{key:"deviceStatusPrivate",value:function(e){switch(e.params[0]){case 6:var i=this._activeBuffer.y+1,n=this._activeBuffer.x+1;this._coreService.triggerDataEvent("".concat(E.ESC,"[?").concat(i,";").concat(n,"R"));break;case 15:break;case 25:break;case 26:break;case 53:break}return!0}},{key:"softReset",value:function(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=ke.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}},{key:"setCursorStyle",value:function(e){var i=e.length===0?1:e.params[0];if(i===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(i){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}var n=i%2===1;this._coreService.decPrivateModes.cursorBlink=n}return!0}},{key:"setScrollRegion",value:function(e){var i=e.params[0]||1,n;return(e.length<2||(n=e.params[1])>this._bufferService.rows||n===0)&&(n=this._bufferService.rows),n>i&&(this._activeBuffer.scrollTop=i-1,this._activeBuffer.scrollBottom=n-1,this._setCursor(0,0)),!0}},{key:"windowOptions",value:function(e){if(!Ms(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;var i=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:i!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent("".concat(E.ESC,"[8;").concat(this._bufferService.rows,";").concat(this._bufferService.cols,"t"));break;case 22:(i===0||i===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>Rs&&this._windowTitleStack.shift()),(i===0||i===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>Rs&&this._iconNameStack.shift());break;case 23:(i===0||i===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(i===0||i===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}},{key:"saveCursor",value:function(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}},{key:"restoreCursor",value:function(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}},{key:"setTitle",value:function(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}},{key:"setIconName",value:function(e){return this._iconName=e,!0}},{key:"setOrReportIndexedColor",value:function(e){for(var i=[],n=e.split(";");n.length>1;){var a=n.shift(),l=n.shift();if(/^\d+$/.exec(a)){var u=parseInt(a);if(Os(u))if(l==="?")i.push({type:0,index:u});else{var h=Bs(l);h&&i.push({type:1,index:u,color:h})}}}return i.length&&this._onColor.fire(i),!0}},{key:"setHyperlink",value:function(e){var i=e.indexOf(";");if(i===-1)return!0;var n=e.slice(0,i).trim(),a=e.slice(i+1);return a?this._createHyperlink(n,a):n.trim()?!1:this._finishHyperlink()}},{key:"_createHyperlink",value:function(e,i){this._getCurrentLinkId()&&this._finishHyperlink();var n=e.split(":"),a,l=n.findIndex(function(u){return u.startsWith("id=")});return l!==-1&&(a=n[l].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:a,uri:i}),this._curAttrData.updateExtended(),!0}},{key:"_finishHyperlink",value:function(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}},{key:"_setOrReportSpecialColor",value:function(e,i){for(var n=e.split(";"),a=0;a<n.length&&!(i>=this._specialColors.length);++a,++i)if(n[a]==="?")this._onColor.fire([{type:0,index:this._specialColors[i]}]);else{var l=Bs(n[a]);l&&this._onColor.fire([{type:1,index:this._specialColors[i],color:l}])}return!0}},{key:"setOrReportFgColor",value:function(e){return this._setOrReportSpecialColor(e,0)}},{key:"setOrReportBgColor",value:function(e){return this._setOrReportSpecialColor(e,1)}},{key:"setOrReportCursorColor",value:function(e){return this._setOrReportSpecialColor(e,2)}},{key:"restoreIndexedColor",value:function(e){if(!e)return this._onColor.fire([{type:2}]),!0;for(var i=[],n=e.split(";"),a=0;a<n.length;++a)if(/^\d+$/.exec(n[a])){var l=parseInt(n[a]);Os(l)&&i.push({type:2,index:l})}return i.length&&this._onColor.fire(i),!0}},{key:"restoreFgColor",value:function(e){return this._onColor.fire([{type:2,index:256}]),!0}},{key:"restoreBgColor",value:function(e){return this._onColor.fire([{type:2,index:257}]),!0}},{key:"restoreCursorColor",value:function(e){return this._onColor.fire([{type:2,index:258}]),!0}},{key:"nextLine",value:function(){return this._activeBuffer.x=0,this.index(),!0}},{key:"keypadApplicationMode",value:function(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}},{key:"keypadNumericMode",value:function(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}},{key:"selectDefaultCharset",value:function(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,Et),!0}},{key:"selectCharset",value:function(e){return e.length!==2?(this.selectDefaultCharset(),!0):(e[0]==="/"||this._charsetService.setgCharset(nc[e[0]],we[e[1]]||Et),!0)}},{key:"index",value:function(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}},{key:"tabSet",value:function(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}},{key:"reverseIndex",value:function(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){var e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}},{key:"fullReset",value:function(){return this._parser.reset(),this._onRequestReset.fire(),!0}},{key:"reset",value:function(){this._curAttrData=ke.clone(),this._eraseAttrDataInternal=ke.clone()}},{key:"_eraseAttrData",value:function(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}},{key:"setgLevel",value:function(e){return this._charsetService.setgLevel(e),!0}},{key:"screenAlignmentPattern",value:function(){var e=new ze;e.content=1<<22|69,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(var i=0;i<this._bufferService.rows;++i){var n=this._activeBuffer.ybase+this._activeBuffer.y+i,a=this._activeBuffer.lines.get(n);a&&(a.fill(e),a.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}},{key:"requestStatusString",value:function(e,i){var n=this,a=function(d){return n._coreService.triggerDataEvent("".concat(E.ESC).concat(d).concat(E.ESC,"\\")),!0},l=this._bufferService.buffer,u=this._optionsService.rawOptions,h={block:2,underline:4,bar:6};return a(e==='"q'?"P1$r".concat(this._curAttrData.isProtected()?1:0,'"q'):e==='"p'?'P1$r61;1"p':e==="r"?"P1$r".concat(l.scrollTop+1,";").concat(l.scrollBottom+1,"r"):e==="m"?"P1$r0m":e===" q"?"P1$r".concat(h[u.cursorStyle]-(u.cursorBlink?1:0)," q"):"P0$r")}},{key:"markRangeDirty",value:function(e,i){this._dirtyRowTracker.markRangeDirty(e,i)}}]),r}(G),Zi=function(){function s(o){S(this,s),this._bufferService=o,this.clearRange()}return k(s,[{key:"clearRange",value:function(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}},{key:"markDirty",value:function(r){r<this.start?this.start=r:r>this.end&&(this.end=r)}},{key:"markRangeDirty",value:function(r,t){r>t&&(Ts=r,r=t,t=Ts),r<this.start&&(this.start=r),t>this.end&&(this.end=t)}},{key:"markAllDirty",value:function(){this.markRangeDirty(0,this._bufferService.rows-1)}}]),s}();Zi=ge([T(0,Te)],Zi);function Os(s){return 0<=s&&s<256}var oc=5e7,Is=12,ac=50,lc=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._action=t,e._writeBuffer=[],e._callbacks=[],e._pendingData=0,e._bufferOffset=0,e._isSyncWriting=!1,e._syncCalls=0,e._didUserInput=!1,e._onWriteParsed=e._register(new M),e.onWriteParsed=e._onWriteParsed.event,e}return k(r,[{key:"handleUserInput",value:function(){this._didUserInput=!0}},{key:"writeSync",value:function(e,i){if(i!==void 0&&this._syncCalls>i){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,!this._isSyncWriting){this._isSyncWriting=!0;for(var n;n=this._writeBuffer.shift();){this._action(n);var a=this._callbacks.shift();a&&a()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}}},{key:"write",value:function(e,i){var n=this;if(this._pendingData>oc)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(i),this._innerWrite();return}setTimeout(function(){return n._innerWrite()})}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(i)}},{key:"_innerWrite",value:function(){for(var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,a=i||performance.now();this._writeBuffer.length>this._bufferOffset;){var l=this._writeBuffer[this._bufferOffset],u=this._action(l,n);if(u){var h=function(_){return performance.now()-a>=Is?setTimeout(function(){return e._innerWrite(0,_)}):e._innerWrite(a,_)};u.catch(function(d){return queueMicrotask(function(){throw d}),Promise.resolve(!1)}).then(h);return}var c=this._callbacks[this._bufferOffset];if(c&&c(),this._bufferOffset++,this._pendingData-=l.length,performance.now()-a>=Is)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>ac&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(function(){return e._innerWrite()})):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}]),r}(G),ji=function(){function s(o){S(this,s),this._bufferService=o,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}return k(s,[{key:"registerLink",value:function(r){var t=this,e=this._bufferService.buffer;if(r.id===void 0){var i=e.addMarker(e.ybase+e.y),n={data:r,id:this._nextId++,lines:[i]};return i.onDispose(function(){return t._removeMarkerFromLink(n,i)}),this._dataByLinkId.set(n.id,n),n.id}var a=r,l=this._getEntryIdKey(a),u=this._entriesWithId.get(l);if(u)return this.addLineToLink(u.id,e.ybase+e.y),u.id;var h=e.addMarker(e.ybase+e.y),c={id:this._nextId++,key:this._getEntryIdKey(a),data:a,lines:[h]};return h.onDispose(function(){return t._removeMarkerFromLink(c,h)}),this._entriesWithId.set(c.key,c),this._dataByLinkId.set(c.id,c),c.id}},{key:"addLineToLink",value:function(r,t){var e=this,i=this._dataByLinkId.get(r);if(i&&i.lines.every(function(a){return a.line!==t})){var n=this._bufferService.buffer.addMarker(t);i.lines.push(n),n.onDispose(function(){return e._removeMarkerFromLink(i,n)})}}},{key:"getLinkData",value:function(r){var t;return(t=this._dataByLinkId.get(r))===null||t===void 0?void 0:t.data}},{key:"_getEntryIdKey",value:function(r){return"".concat(r.id,";;").concat(r.uri)}},{key:"_removeMarkerFromLink",value:function(r,t){var e=r.lines.indexOf(t);e!==-1&&(r.lines.splice(e,1),r.lines.length===0&&(r.data.id!==void 0&&this._entriesWithId.delete(r.key),this._dataByLinkId.delete(r.id)))}}]),s}();ji=ge([T(0,Te)],ji);var Ns=!1,cc=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._windowsWrappingHeuristics=e._register(new Pt),e._onBinary=e._register(new M),e.onBinary=e._onBinary.event,e._onData=e._register(new M),e.onData=e._onData.event,e._onLineFeed=e._register(new M),e.onLineFeed=e._onLineFeed.event,e._onResize=e._register(new M),e.onResize=e._onResize.event,e._onWriteParsed=e._register(new M),e.onWriteParsed=e._onWriteParsed.event,e._onScroll=e._register(new M),e._instantiationService=new Ml,e.optionsService=e._register(new Kl(t)),e._instantiationService.setService(Oe,e.optionsService),e._bufferService=e._register(e._instantiationService.createInstance(Hi)),e._instantiationService.setService(Te,e._bufferService),e._logService=e._register(e._instantiationService.createInstance(Ii)),e._instantiationService.setService(ln,e._logService),e.coreService=e._register(e._instantiationService.createInstance(Wi)),e._instantiationService.setService(yt,e.coreService),e.coreMouseService=e._register(e._instantiationService.createInstance(Ui)),e._instantiationService.setService(an,e.coreMouseService),e.unicodeService=e._register(e._instantiationService.createInstance(xt)),e._instantiationService.setService(ro,e.unicodeService),e._charsetService=e._instantiationService.createInstance($l),e._instantiationService.setService(to,e._charsetService),e._oscLinkService=e._instantiationService.createInstance(ji),e._instantiationService.setService(cn,e._oscLinkService),e._inputHandler=e._register(new sc(e._bufferService,e._charsetService,e.coreService,e._logService,e.optionsService,e._oscLinkService,e.coreMouseService,e.unicodeService)),e._register(xe.forward(e._inputHandler.onLineFeed,e._onLineFeed)),e._register(e._inputHandler),e._register(xe.forward(e._bufferService.onResize,e._onResize)),e._register(xe.forward(e.coreService.onData,e._onData)),e._register(xe.forward(e.coreService.onBinary,e._onBinary)),e._register(e.coreService.onRequestScrollToBottom(function(){return e.scrollToBottom(!0)})),e._register(e.coreService.onUserInput(function(){return e._writeBuffer.handleUserInput()})),e._register(e.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],function(){return e._handleWindowsPtyOptionChange()})),e._register(e._bufferService.onScroll(function(){e._onScroll.fire({position:e._bufferService.buffer.ydisp}),e._inputHandler.markRangeDirty(e._bufferService.buffer.scrollTop,e._bufferService.buffer.scrollBottom)})),e._writeBuffer=e._register(new lc(function(i,n){return e._inputHandler.parse(i,n)})),e._register(xe.forward(e._writeBuffer.onWriteParsed,e._onWriteParsed)),e}return k(r,[{key:"onScroll",get:function(){var e=this;return this._onScrollApi||(this._onScrollApi=this._register(new M),this._onScroll.event(function(i){var n;(n=e._onScrollApi)===null||n===void 0||n.fire(i.position)})),this._onScrollApi.event}},{key:"cols",get:function(){return this._bufferService.cols}},{key:"rows",get:function(){return this._bufferService.rows}},{key:"buffers",get:function(){return this._bufferService.buffers}},{key:"options",get:function(){return this.optionsService.options},set:function(e){for(var i in e)this.optionsService.options[i]=e[i]}},{key:"write",value:function(e,i){this._writeBuffer.write(e,i)}},{key:"writeSync",value:function(e,i){this._logService.logLevel<=3&&!Ns&&(this._logService.warn("writeSync is unreliable and will be removed soon."),Ns=!0),this._writeBuffer.writeSync(e,i)}},{key:"input",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this.coreService.triggerDataEvent(e,i)}},{key:"resize",value:function(e,i){isNaN(e)||isNaN(i)||(e=Math.max(e,ks),i=Math.max(i,bs),this._bufferService.resize(e,i))}},{key:"scroll",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this._bufferService.scroll(e,i)}},{key:"scrollLines",value:function(e,i){this._bufferService.scrollLines(e,i)}},{key:"scrollPages",value:function(e){this.scrollLines(e*(this.rows-1))}},{key:"scrollToTop",value:function(){this.scrollLines(-this._bufferService.buffer.ydisp)}},{key:"scrollToBottom",value:function(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}},{key:"scrollToLine",value:function(e){var i=e-this._bufferService.buffer.ydisp;i!==0&&this.scrollLines(i)}},{key:"registerEscHandler",value:function(e,i){return this._inputHandler.registerEscHandler(e,i)}},{key:"registerDcsHandler",value:function(e,i){return this._inputHandler.registerDcsHandler(e,i)}},{key:"registerCsiHandler",value:function(e,i){return this._inputHandler.registerCsiHandler(e,i)}},{key:"registerOscHandler",value:function(e,i){return this._inputHandler.registerOscHandler(e,i)}},{key:"_setup",value:function(){this._handleWindowsPtyOptionChange()}},{key:"reset",value:function(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}},{key:"_handleWindowsPtyOptionChange",value:function(){var e=!1,i=this.optionsService.rawOptions.windowsPty;i&&i.buildNumber!==void 0&&i.buildNumber!==void 0?e=i.backend==="conpty"&&i.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}},{key:"_enableWindowsWrappingHeuristics",value:function(){var e=this;if(!this._windowsWrappingHeuristics.value){var i=[];i.push(this.onLineFeed(Ds.bind(null,this._bufferService))),i.push(this.registerCsiHandler({final:"H"},function(){return Ds(e._bufferService),!1})),this._windowsWrappingHeuristics.value=ue(function(){for(var n=0,a=i;n<a.length;n++){var l=a[n];l.dispose()}})}}}]),r}(G),uc={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function hc(s,o,r,t){var e={type:0,cancel:!1,key:void 0},i=(s.shiftKey?1:0)|(s.altKey?2:0)|(s.ctrlKey?4:0)|(s.metaKey?8:0);switch(s.keyCode){case 0:s.key==="UIKeyInputUpArrow"?o?e.key=E.ESC+"OA":e.key=E.ESC+"[A":s.key==="UIKeyInputLeftArrow"?o?e.key=E.ESC+"OD":e.key=E.ESC+"[D":s.key==="UIKeyInputRightArrow"?o?e.key=E.ESC+"OC":e.key=E.ESC+"[C":s.key==="UIKeyInputDownArrow"&&(o?e.key=E.ESC+"OB":e.key=E.ESC+"[B");break;case 8:e.key=s.ctrlKey?"\b":E.DEL,s.altKey&&(e.key=E.ESC+e.key);break;case 9:if(s.shiftKey){e.key=E.ESC+"[Z";break}e.key=E.HT,e.cancel=!0;break;case 13:e.key=s.altKey?E.ESC+E.CR:E.CR,e.cancel=!0;break;case 27:e.key=E.ESC,s.altKey&&(e.key=E.ESC+E.ESC),e.cancel=!0;break;case 37:if(s.metaKey)break;i?e.key=E.ESC+"[1;"+(i+1)+"D":o?e.key=E.ESC+"OD":e.key=E.ESC+"[D";break;case 39:if(s.metaKey)break;i?e.key=E.ESC+"[1;"+(i+1)+"C":o?e.key=E.ESC+"OC":e.key=E.ESC+"[C";break;case 38:if(s.metaKey)break;i?e.key=E.ESC+"[1;"+(i+1)+"A":o?e.key=E.ESC+"OA":e.key=E.ESC+"[A";break;case 40:if(s.metaKey)break;i?e.key=E.ESC+"[1;"+(i+1)+"B":o?e.key=E.ESC+"OB":e.key=E.ESC+"[B";break;case 45:!s.shiftKey&&!s.ctrlKey&&(e.key=E.ESC+"[2~");break;case 46:i?e.key=E.ESC+"[3;"+(i+1)+"~":e.key=E.ESC+"[3~";break;case 36:i?e.key=E.ESC+"[1;"+(i+1)+"H":o?e.key=E.ESC+"OH":e.key=E.ESC+"[H";break;case 35:i?e.key=E.ESC+"[1;"+(i+1)+"F":o?e.key=E.ESC+"OF":e.key=E.ESC+"[F";break;case 33:s.shiftKey?e.type=2:s.ctrlKey?e.key=E.ESC+"[5;"+(i+1)+"~":e.key=E.ESC+"[5~";break;case 34:s.shiftKey?e.type=3:s.ctrlKey?e.key=E.ESC+"[6;"+(i+1)+"~":e.key=E.ESC+"[6~";break;case 112:i?e.key=E.ESC+"[1;"+(i+1)+"P":e.key=E.ESC+"OP";break;case 113:i?e.key=E.ESC+"[1;"+(i+1)+"Q":e.key=E.ESC+"OQ";break;case 114:i?e.key=E.ESC+"[1;"+(i+1)+"R":e.key=E.ESC+"OR";break;case 115:i?e.key=E.ESC+"[1;"+(i+1)+"S":e.key=E.ESC+"OS";break;case 116:i?e.key=E.ESC+"[15;"+(i+1)+"~":e.key=E.ESC+"[15~";break;case 117:i?e.key=E.ESC+"[17;"+(i+1)+"~":e.key=E.ESC+"[17~";break;case 118:i?e.key=E.ESC+"[18;"+(i+1)+"~":e.key=E.ESC+"[18~";break;case 119:i?e.key=E.ESC+"[19;"+(i+1)+"~":e.key=E.ESC+"[19~";break;case 120:i?e.key=E.ESC+"[20;"+(i+1)+"~":e.key=E.ESC+"[20~";break;case 121:i?e.key=E.ESC+"[21;"+(i+1)+"~":e.key=E.ESC+"[21~";break;case 122:i?e.key=E.ESC+"[23;"+(i+1)+"~":e.key=E.ESC+"[23~";break;case 123:i?e.key=E.ESC+"[24;"+(i+1)+"~":e.key=E.ESC+"[24~";break;default:if(s.ctrlKey&&!s.shiftKey&&!s.altKey&&!s.metaKey)s.keyCode>=65&&s.keyCode<=90?e.key=String.fromCharCode(s.keyCode-64):s.keyCode===32?e.key=E.NUL:s.keyCode>=51&&s.keyCode<=55?e.key=String.fromCharCode(s.keyCode-51+27):s.keyCode===56?e.key=E.DEL:s.keyCode===219?e.key=E.ESC:s.keyCode===220?e.key=E.FS:s.keyCode===221&&(e.key=E.GS);else if((!r||t)&&s.altKey&&!s.metaKey){var n,a=(n=uc[s.keyCode])===null||n===void 0?void 0:n[s.shiftKey?1:0];if(a)e.key=E.ESC+a;else if(s.keyCode>=65&&s.keyCode<=90){var l=s.ctrlKey?s.keyCode-64:s.keyCode+32,u=String.fromCharCode(l);s.shiftKey&&(u=u.toUpperCase()),e.key=E.ESC+u}else if(s.keyCode===32)e.key=E.ESC+(s.ctrlKey?E.NUL:" ");else if(s.key==="Dead"&&s.code.startsWith("Key")){var h=s.code.slice(3,4);s.shiftKey||(h=h.toLowerCase()),e.key=E.ESC+h,e.cancel=!0}}else r&&!s.altKey&&!s.ctrlKey&&!s.shiftKey&&s.metaKey?s.keyCode===65&&(e.type=1):s.key&&!s.ctrlKey&&!s.altKey&&!s.metaKey&&s.keyCode>=48&&s.key.length===1?e.key=s.key:s.key&&s.ctrlKey&&(s.key==="_"&&(e.key=E.US),s.key==="@"&&(e.key=E.NUL));break}return e}var ye=0,dc=function(){function s(o){S(this,s),this._getKey=o,this._array=[],this._insertedValues=[],this._flushInsertedTask=new Mr,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new Mr,this._isFlushingDeleted=!1}return k(s,[{key:"clear",value:function(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}},{key:"insert",value:function(r){var t=this;this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(function(){return t._flushInserted()}),this._insertedValues.push(r)}},{key:"_flushInserted",value:function(){for(var r=this,t=this._insertedValues.sort(function(l,u){return r._getKey(l)-r._getKey(u)}),e=0,i=0,n=new Array(this._array.length+this._insertedValues.length),a=0;a<n.length;a++)i>=this._array.length||this._getKey(t[e])<=this._getKey(this._array[i])?(n[a]=t[e],e++):n[a]=this._array[i++];this._array=n,this._insertedValues.length=0}},{key:"_flushCleanupInserted",value:function(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}},{key:"delete",value:function(r){var t=this;if(this._flushCleanupInserted(),this._array.length===0)return!1;var e=this._getKey(r);if(e===void 0||(ye=this._search(e),ye===-1)||this._getKey(this._array[ye])!==e)return!1;do if(this._array[ye]===r)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(function(){return t._flushDeleted()}),this._deletedIndices.push(ye),!0;while(++ye<this._array.length&&this._getKey(this._array[ye])===e);return!1}},{key:"_flushDeleted",value:function(){this._isFlushingDeleted=!0;for(var r=this._deletedIndices.sort(function(a,l){return a-l}),t=0,e=new Array(this._array.length-r.length),i=0,n=0;n<this._array.length;n++)r[t]===n?t++:e[i++]=this._array[n];this._array=e,this._deletedIndices.length=0,this._isFlushingDeleted=!1}},{key:"_flushCleanupDeleted",value:function(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}},{key:"getKeyIterator",value:I().mark(function o(r){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._flushCleanupInserted(),this._flushCleanupDeleted(),!(this._array.length!==0&&(ye=this._search(r),!(ye<0||ye>=this._array.length)&&this._getKey(this._array[ye])===r))){e.next=4;break}case 1:return e.next=3,this._array[ye];case 3:if(++ye<this._array.length&&this._getKey(this._array[ye])===r){e.next=1;break}case 4:case"end":return e.stop()}},o,this)})},{key:"forEachByKey",value:function(r,t){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(ye=this._search(r),!(ye<0||ye>=this._array.length)&&this._getKey(this._array[ye])===r))do t(this._array[ye]);while(++ye<this._array.length&&this._getKey(this._array[ye])===r)}},{key:"values",value:function(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),ae(this._array).values()}},{key:"_search",value:function(r){for(var t=0,e=this._array.length-1;e>=t;){var i=t+e>>1,n=this._getKey(this._array[i]);if(n>r)e=i-1;else if(n<r)t=i+1;else{for(;i>0&&this._getKey(this._array[i-1])===r;)i--;return i}}return t}}]),s}(),qi=0,Hs=0,fc=function(s){z(r,s);var o=U(r);function r(){var t;return S(this,r),t=o.call(this),t._decorations=new dc(function(e){return e==null?void 0:e.marker.line}),t._onDecorationRegistered=t._register(new M),t.onDecorationRegistered=t._onDecorationRegistered.event,t._onDecorationRemoved=t._register(new M),t.onDecorationRemoved=t._onDecorationRemoved.event,t._register(ue(function(){return t.reset()})),t}return k(r,[{key:"decorations",get:function(){return this._decorations.values()}},{key:"registerDecoration",value:function(e){var i=this;if(!e.marker.isDisposed){var n=new _c(e);if(n){var a=n.marker.onDispose(function(){return n.dispose()}),l=n.onDispose(function(){l.dispose(),n&&(i._decorations.delete(n)&&i._onDecorationRemoved.fire(n),a.dispose())});this._decorations.insert(n),this._onDecorationRegistered.fire(n)}return n}}},{key:"reset",value:function(){var e=Z(this._decorations.values()),i;try{for(e.s();!(i=e.n()).done;){var n=i.value;n.dispose()}}catch(a){e.e(a)}finally{e.f()}this._decorations.clear()}},{key:"getDecorationsAtCell",value:I().mark(function t(e,i,n){var a,l,u,h,c,d,_,v;return I().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a=0,l=0,u=Z(this._decorations.getKeyIterator(i)),m.prev=2,u.s();case 4:if((h=u.n()).done){m.next=14;break}if(v=h.value,a=(c=v.options.x)!==null&&c!==void 0?c:0,l=a+((d=v.options.width)!==null&&d!==void 0?d:1),m.t0=e>=a&&e<l&&(!n||((_=v.options.layer)!==null&&_!==void 0?_:"bottom")===n),!m.t0){m.next=12;break}return m.next=12,v;case 12:m.next=4;break;case 14:m.next=19;break;case 16:m.prev=16,m.t1=m.catch(2),u.e(m.t1);case 19:return m.prev=19,u.f(),m.finish(19);case 22:case"end":return m.stop()}},t,this,[[2,16,19,22]])})},{key:"forEachDecorationAtCell",value:function(e,i,n,a){this._decorations.forEachByKey(i,function(l){var u,h,c;qi=(u=l.options.x)!==null&&u!==void 0?u:0,Hs=qi+((h=l.options.width)!==null&&h!==void 0?h:1),e>=qi&&e<Hs&&(!n||((c=l.options.layer)!==null&&c!==void 0?c:"bottom")===n)&&a(l)})}}]),r}(G),_c=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e.options=t,e.onRenderEmitter=e.add(new M),e.onRender=e.onRenderEmitter.event,e._onDispose=e.add(new M),e.onDispose=e._onDispose.event,e._cachedBg=null,e._cachedFg=null,e.marker=t.marker,e.options.overviewRulerOptions&&!e.options.overviewRulerOptions.position&&(e.options.overviewRulerOptions.position="full"),e}return k(r,[{key:"backgroundColorRGB",get:function(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=de.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}},{key:"foregroundColorRGB",get:function(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=de.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}},{key:"dispose",value:function(){this._onDispose.fire(),V(K(r.prototype),"dispose",this).call(this)}}]),r}(ht),vc=1e3,gc=function(){function s(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vc;S(this,s),this._renderCallback=o,this._debounceThresholdMS=r,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}return k(s,[{key:"dispose",value:function(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}},{key:"refresh",value:function(r,t,e){var i=this;this._rowCount=e,r=r!==void 0?r:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,r):r,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t;var n=performance.now();if(n-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=n,this._innerRefresh();else if(!this._additionalRefreshRequested){var a=n-this._lastRefreshMs,l=this._debounceThresholdMS-a;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(function(){i._lastRefreshMs=performance.now(),i._innerRefresh(),i._additionalRefreshRequested=!1,i._refreshTimeoutID=void 0},l)}}},{key:"_innerRefresh",value:function(){if(!(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)){var r=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(r,t)}}}]),s}(),Ws=20,Fs=!1,Or=function(s){z(r,s);var o=U(r);function r(t,e,i,n){var a;S(this,r),a=o.call(this),a._terminal=t,a._coreBrowserService=i,a._renderService=n,a._rowColumns=new WeakMap,a._liveRegionLineCount=0,a._charsToConsume=[],a._charsToAnnounce="";var l=a._coreBrowserService.mainDocument;a._accessibilityContainer=l.createElement("div"),a._accessibilityContainer.classList.add("xterm-accessibility"),a._rowContainer=l.createElement("div"),a._rowContainer.setAttribute("role","list"),a._rowContainer.classList.add("xterm-accessibility-tree"),a._rowElements=[];for(var u=0;u<a._terminal.rows;u++)a._rowElements[u]=a._createAccessibilityTreeNode(),a._rowContainer.appendChild(a._rowElements[u]);if(a._topBoundaryFocusListener=function(h){return a._handleBoundaryFocus(h,0)},a._bottomBoundaryFocusListener=function(h){return a._handleBoundaryFocus(h,1)},a._rowElements[0].addEventListener("focus",a._topBoundaryFocusListener),a._rowElements[a._rowElements.length-1].addEventListener("focus",a._bottomBoundaryFocusListener),a._accessibilityContainer.appendChild(a._rowContainer),a._liveRegion=l.createElement("div"),a._liveRegion.classList.add("live-region"),a._liveRegion.setAttribute("aria-live","assertive"),a._accessibilityContainer.appendChild(a._liveRegion),a._liveRegionDebouncer=a._register(new gc(a._renderRows.bind(Ie(a)))),!a._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");return Fs?(a._accessibilityContainer.classList.add("debug"),a._rowContainer.classList.add("debug"),a._debugRootContainer=l.createElement("div"),a._debugRootContainer.classList.add("xterm"),a._debugRootContainer.appendChild(l.createTextNode("------start a11y------")),a._debugRootContainer.appendChild(a._accessibilityContainer),a._debugRootContainer.appendChild(l.createTextNode("------end a11y------")),a._terminal.element.insertAdjacentElement("afterend",a._debugRootContainer)):a._terminal.element.insertAdjacentElement("afterbegin",a._accessibilityContainer),a._register(a._terminal.onResize(function(h){return a._handleResize(h.rows)})),a._register(a._terminal.onRender(function(h){return a._refreshRows(h.start,h.end)})),a._register(a._terminal.onScroll(function(){return a._refreshRows()})),a._register(a._terminal.onA11yChar(function(h){return a._handleChar(h)})),a._register(a._terminal.onLineFeed(function(){return a._handleChar(`
`)})),a._register(a._terminal.onA11yTab(function(h){return a._handleTab(h)})),a._register(a._terminal.onKey(function(h){return a._handleKey(h.key)})),a._register(a._terminal.onBlur(function(){return a._clearLiveRegion()})),a._register(a._renderService.onDimensionsChange(function(){return a._refreshRowsDimensions()})),a._register($(l,"selectionchange",function(){return a._handleSelectionChange()})),a._register(a._coreBrowserService.onDprChange(function(){return a._refreshRowsDimensions()})),a._refreshRowsDimensions(),a._refreshRows(),a._register(ue(function(){Fs?a._debugRootContainer.remove():a._accessibilityContainer.remove(),a._rowElements.length=0})),a}return k(r,[{key:"_handleTab",value:function(e){for(var i=0;i<e;i++)this._handleChar(" ")}},{key:"_handleChar",value:function(e){this._liveRegionLineCount<Ws+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===Ws+1&&(this._liveRegion.textContent+=Ur.get())))}},{key:"_clearLiveRegion",value:function(){this._liveRegion.textContent="",this._liveRegionLineCount=0}},{key:"_handleKey",value:function(e){this._clearLiveRegion(),/[\0-\x1F\x7F-\x9F]/.test(e)||this._charsToConsume.push(e)}},{key:"_refreshRows",value:function(e,i){this._liveRegionDebouncer.refresh(e,i,this._terminal.rows)}},{key:"_renderRows",value:function(e,i){for(var n=this._terminal.buffer,a=n.lines.length.toString(),l=e;l<=i;l++){var u=n.lines.get(n.ydisp+l),h=[],c=(u==null?void 0:u.translateToString(!0,void 0,void 0,h))||"",d=(n.ydisp+l+1).toString(),_=this._rowElements[l];_&&(c.length===0?(_.textContent="\xA0",this._rowColumns.set(_,[0,1])):(_.textContent=c,this._rowColumns.set(_,h)),_.setAttribute("aria-posinset",d),_.setAttribute("aria-setsize",a),this._alignRowWidth(_))}this._announceCharacters()}},{key:"_announceCharacters",value:function(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}},{key:"_handleBoundaryFocus",value:function(e,i){var n=e.target,a=this._rowElements[i===0?1:this._rowElements.length-2],l=n.getAttribute("aria-posinset"),u=i===0?"1":"".concat(this._terminal.buffer.lines.length);if(!(l===u||e.relatedTarget!==a)){var h,c;if(i===0?(h=n,c=this._rowElements.pop(),this._rowContainer.removeChild(c)):(h=this._rowElements.shift(),c=n,this._rowContainer.removeChild(h)),h.removeEventListener("focus",this._topBoundaryFocusListener),c.removeEventListener("focus",this._bottomBoundaryFocusListener),i===0){var d=this._createAccessibilityTreeNode();this._rowElements.unshift(d),this._rowContainer.insertAdjacentElement("afterbegin",d)}else{var _=this._createAccessibilityTreeNode();this._rowElements.push(_),this._rowContainer.appendChild(_)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(i===0?-1:1),this._rowElements[i===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}}},{key:"_handleSelectionChange",value:function(){var e,i,n,a=this;if(this._rowElements.length!==0){var l=this._coreBrowserService.mainDocument.getSelection();if(l){if(l.isCollapsed){this._rowContainer.contains(l.anchorNode)&&this._terminal.clearSelection();return}if(!l.anchorNode||!l.focusNode){console.error("anchorNode and/or focusNode are null");return}var u={node:l.anchorNode,offset:l.anchorOffset},h={node:l.focusNode,offset:l.focusOffset};if((u.node.compareDocumentPosition(h.node)&Node.DOCUMENT_POSITION_PRECEDING||u.node===h.node&&u.offset>h.offset)&&(e=[h,u],u=e[0],h=e[1]),u.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(u={node:this._rowElements[0].childNodes[0],offset:0}),!!this._rowContainer.contains(u.node)){var c=this._rowElements.slice(-1)[0];if(h.node.compareDocumentPosition(c)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(h={node:c,offset:(i=(n=c.textContent)===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0}),!!this._rowContainer.contains(h.node)){var d=function(m){var g=m.node,w=m.offset,y=g instanceof Text?g.parentNode:g,b=parseInt(y==null?void 0:y.getAttribute("aria-posinset"),10)-1;if(isNaN(b))return console.warn("row is invalid. Race condition?"),null;var A=a._rowColumns.get(y);if(!A)return console.warn("columns is null. Race condition?"),null;var ee=w<A.length?A[w]:A.slice(-1)[0]+1;return ee>=a._terminal.cols&&(++b,ee=0),{row:b,column:ee}},_=d(u),v=d(h);if(!(!_||!v)){if(_.row>v.row||_.row===v.row&&_.column>=v.column)throw new Error("invalid range");this._terminal.select(_.column,_.row,(v.row-_.row)*this._terminal.cols-_.column+v.column)}}}}}}},{key:"_handleResize",value:function(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(var i=this._rowContainer.children.length;i<this._terminal.rows;i++)this._rowElements[i]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[i]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}},{key:"_createAccessibilityTreeNode",value:function(){var e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}},{key:"_refreshRowsDimensions",value:function(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:"".concat(this._renderService.dimensions.css.canvas.width,"px"),fontSize:"".concat(this._terminal.options.fontSize,"px")}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(var e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}},{key:"_refreshRowDimensions",value:function(e){e.style.height="".concat(this._renderService.dimensions.css.cell.height,"px")}},{key:"_alignRowWidth",value:function(e){var i;e.style.transform="";var n=e.getBoundingClientRect().width,a=(i=this._rowColumns.get(e))===null||i===void 0||(i=i.slice(-1))===null||i===void 0?void 0:i[0];if(a){var l=a*this._renderService.dimensions.css.cell.width;e.style.transform="scaleX(".concat(l/n,")")}}}]),r}(G);Or=ge([T(1,Zr),T(2,tt),T(3,rt)],Or);var $i=function(s){z(r,s);var o=U(r);function r(t,e,i,n,a){var l;return S(this,r),l=o.call(this),l._element=t,l._mouseService=e,l._renderService=i,l._bufferService=n,l._linkProviderService=a,l._linkCacheDisposables=[],l._isMouseOut=!0,l._wasResized=!1,l._activeLine=-1,l._onShowLinkUnderline=l._register(new M),l.onShowLinkUnderline=l._onShowLinkUnderline.event,l._onHideLinkUnderline=l._register(new M),l.onHideLinkUnderline=l._onHideLinkUnderline.event,l._register(ue(function(){var u;kt(l._linkCacheDisposables),l._linkCacheDisposables.length=0,l._lastMouseEvent=void 0,(u=l._activeProviderReplies)===null||u===void 0||u.clear()})),l._register(l._bufferService.onResize(function(){l._clearCurrentLink(),l._wasResized=!0})),l._register($(l._element,"mouseleave",function(){l._isMouseOut=!0,l._clearCurrentLink()})),l._register($(l._element,"mousemove",l._handleMouseMove.bind(Ie(l)))),l._register($(l._element,"mousedown",l._handleMouseDown.bind(Ie(l)))),l._register($(l._element,"mouseup",l._handleMouseUp.bind(Ie(l)))),l}return k(r,[{key:"currentLink",get:function(){return this._currentLink}},{key:"_handleMouseMove",value:function(e){this._lastMouseEvent=e;var i=this._positionFromMouseEvent(e,this._element,this._mouseService);if(i){this._isMouseOut=!1;for(var n=e.composedPath(),a=0;a<n.length;a++){var l=n[a];if(l.classList.contains("xterm"))break;if(l.classList.contains("xterm-hover"))return}(!this._lastBufferCell||i.x!==this._lastBufferCell.x||i.y!==this._lastBufferCell.y)&&(this._handleHover(i),this._lastBufferCell=i)}}},{key:"_handleHover",value:function(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}},{key:"_askForLink",value:function(e,i){var n,a=this;(!this._activeProviderReplies||!i)&&((n=this._activeProviderReplies)!==null&&n!==void 0&&n.forEach(function(d){d==null||d.forEach(function(_){_.link.dispose&&_.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);var l=!1,u=Z(this._linkProviderService.linkProviders.entries()),h;try{var c=function(){var _,v=ne(h.value,2),f=v[0],m=v[1];i?!((_=a._activeProviderReplies)===null||_===void 0)&&_.get(f)&&(l=a._checkLinkProviderResult(f,e,l)):m.provideLinks(e.y,function(g){var w,y;if(!a._isMouseOut){var b=g==null?void 0:g.map(function(A){return{link:A}});(w=a._activeProviderReplies)!==null&&w!==void 0&&w.set(f,b),l=a._checkLinkProviderResult(f,e,l),((y=a._activeProviderReplies)===null||y===void 0?void 0:y.size)===a._linkProviderService.linkProviders.length&&a._removeIntersectingLinks(e.y,a._activeProviderReplies)}})};for(u.s();!(h=u.n()).done;)c()}catch(d){u.e(d)}finally{u.f()}}},{key:"_removeIntersectingLinks",value:function(e,i){for(var n=new Set,a=0;a<i.size;a++){var l=i.get(a);if(l)for(var u=0;u<l.length;u++)for(var h=l[u],c=h.link.range.start.y<e?0:h.link.range.start.x,d=h.link.range.end.y>e?this._bufferService.cols:h.link.range.end.x,_=c;_<=d;_++){if(n.has(_)){l.splice(u--,1);break}n.add(_)}}}},{key:"_checkLinkProviderResult",value:function(e,i,n){var a=this;if(!this._activeProviderReplies)return n;for(var l=this._activeProviderReplies.get(e),u=!1,h=0;h<e;h++)(!this._activeProviderReplies.has(h)||this._activeProviderReplies.get(h))&&(u=!0);if(!u&&l){var c=l.find(function(f){return a._linkAtPosition(f.link,i)});c&&(n=!0,this._handleNewLink(c))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!n)for(var d=0;d<this._activeProviderReplies.size;d++){var _,v=(_=this._activeProviderReplies.get(d))===null||_===void 0?void 0:_.find(function(f){return a._linkAtPosition(f.link,i)});if(v){n=!0,this._handleNewLink(v);break}}return n}},{key:"_handleMouseDown",value:function(){this._mouseDownLink=this._currentLink}},{key:"_handleMouseUp",value:function(e){if(this._currentLink){var i=this._positionFromMouseEvent(e,this._element,this._mouseService);i&&this._mouseDownLink&&pc(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,i)&&this._currentLink.link.activate(e,this._currentLink.link.text)}}},{key:"_clearCurrentLink",value:function(e,i){!this._currentLink||!this._lastMouseEvent||(!e||!i||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=i)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,kt(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}},{key:"_handleNewLink",value:function(e){var i=this;if(this._lastMouseEvent){var n=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);n&&this._linkAtPosition(e.link,n)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0?!0:e.link.decorations.underline,pointerCursor:e.link.decorations===void 0?!0:e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:function(){var l;return(l=i._currentLink)===null||l===void 0||(l=l.state)===null||l===void 0?void 0:l.decorations.pointerCursor},set:function(l){var u;!((u=i._currentLink)===null||u===void 0)&&u.state&&i._currentLink.state.decorations.pointerCursor!==l&&(i._currentLink.state.decorations.pointerCursor=l,i._currentLink.state.isHovered&&i._element.classList.toggle("xterm-cursor-pointer",l))}},underline:{get:function(){var l;return(l=i._currentLink)===null||l===void 0||(l=l.state)===null||l===void 0?void 0:l.decorations.underline},set:function(l){var u,h;!((u=i._currentLink)===null||u===void 0)&&u.state&&((h=i._currentLink)===null||h===void 0||(h=h.state)===null||h===void 0?void 0:h.decorations.underline)!==l&&(i._currentLink.state.decorations.underline=l,i._currentLink.state.isHovered&&i._fireUnderlineEvent(e.link,l))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(function(a){if(i._currentLink){var l=a.start===0?0:a.start+1+i._bufferService.buffer.ydisp,u=i._bufferService.buffer.ydisp+1+a.end;if(i._currentLink.link.range.start.y>=l&&i._currentLink.link.range.end.y<=u&&(i._clearCurrentLink(l,u),i._lastMouseEvent)){var h=i._positionFromMouseEvent(i._lastMouseEvent,i._element,i._mouseService);h&&i._askForLink(h,!1)}}})))}}},{key:"_linkHover",value:function(e,i,n){var a;(a=this._currentLink)!==null&&a!==void 0&&a.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(i,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),i.hover&&i.hover(n,i.text)}},{key:"_fireUnderlineEvent",value:function(e,i){var n=e.range,a=this._bufferService.buffer.ydisp,l=this._createLinkUnderlineEvent(n.start.x-1,n.start.y-a-1,n.end.x,n.end.y-a-1,void 0);(i?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(l)}},{key:"_linkLeave",value:function(e,i,n){var a;(a=this._currentLink)!==null&&a!==void 0&&a.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(i,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),i.leave&&i.leave(n,i.text)}},{key:"_linkAtPosition",value:function(e,i){var n=e.range.start.y*this._bufferService.cols+e.range.start.x,a=e.range.end.y*this._bufferService.cols+e.range.end.x,l=i.y*this._bufferService.cols+i.x;return n<=l&&l<=a}},{key:"_positionFromMouseEvent",value:function(e,i,n){var a=n.getCoords(e,i,this._bufferService.cols,this._bufferService.rows);if(a)return{x:a[0],y:a[1]+this._bufferService.buffer.ydisp}}},{key:"_createLinkUnderlineEvent",value:function(e,i,n,a,l){return{x1:e,y1:i,x2:n,y2:a,cols:this._bufferService.cols,fg:l}}}]),r}(G);$i=ge([T(1,qr),T(2,rt),T(3,Te),T(4,hn)],$i);function pc(s,o){return s.text===o.text&&s.range.start.x===o.range.start.x&&s.range.start.y===o.range.start.y&&s.range.end.x===o.range.end.x&&s.range.end.y===o.range.end.y}var mc=function(s){z(r,s);var o=U(r);function r(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return S(this,r),t=o.call(this,e),t._linkifier=t._register(new Pt),t.browser=ns,t._keyDownHandled=!1,t._keyDownSeen=!1,t._keyPressHandled=!1,t._unprocessedDeadKey=!1,t._accessibilityManager=t._register(new Pt),t._onCursorMove=t._register(new M),t.onCursorMove=t._onCursorMove.event,t._onKey=t._register(new M),t.onKey=t._onKey.event,t._onRender=t._register(new M),t.onRender=t._onRender.event,t._onSelectionChange=t._register(new M),t.onSelectionChange=t._onSelectionChange.event,t._onTitleChange=t._register(new M),t.onTitleChange=t._onTitleChange.event,t._onBell=t._register(new M),t.onBell=t._onBell.event,t._onFocus=t._register(new M),t._onBlur=t._register(new M),t._onA11yCharEmitter=t._register(new M),t._onA11yTabEmitter=t._register(new M),t._onWillOpen=t._register(new M),t._setup(),t._decorationService=t._instantiationService.createInstance(fc),t._instantiationService.setService(Mt,t._decorationService),t._linkProviderService=t._instantiationService.createInstance(ol),t._instantiationService.setService(hn,t._linkProviderService),t._linkProviderService.registerLinkProvider(t._instantiationService.createInstance(jr)),t._register(t._inputHandler.onRequestBell(function(){return t._onBell.fire()})),t._register(t._inputHandler.onRequestRefreshRows(function(i){var n,a;return t.refresh((n=i==null?void 0:i.start)!==null&&n!==void 0?n:0,(a=i==null?void 0:i.end)!==null&&a!==void 0?a:t.rows-1)})),t._register(t._inputHandler.onRequestSendFocus(function(){return t._reportFocus()})),t._register(t._inputHandler.onRequestReset(function(){return t.reset()})),t._register(t._inputHandler.onRequestWindowsOptionsReport(function(i){return t._reportWindowsOptions(i)})),t._register(t._inputHandler.onColor(function(i){return t._handleColorEvent(i)})),t._register(xe.forward(t._inputHandler.onCursorMove,t._onCursorMove)),t._register(xe.forward(t._inputHandler.onTitleChange,t._onTitleChange)),t._register(xe.forward(t._inputHandler.onA11yChar,t._onA11yCharEmitter)),t._register(xe.forward(t._inputHandler.onA11yTab,t._onA11yTabEmitter)),t._register(t._bufferService.onResize(function(i){return t._afterResize(i.cols,i.rows)})),t._register(ue(function(){var i;t._customKeyEventHandler=void 0,(i=t.element)===null||i===void 0||(i=i.parentNode)===null||i===void 0||i.removeChild(t.element)})),t}return k(r,[{key:"linkifier",get:function(){return this._linkifier.value}},{key:"onFocus",get:function(){return this._onFocus.event}},{key:"onBlur",get:function(){return this._onBlur.event}},{key:"onA11yChar",get:function(){return this._onA11yCharEmitter.event}},{key:"onA11yTab",get:function(){return this._onA11yTabEmitter.event}},{key:"onWillOpen",get:function(){return this._onWillOpen.event}},{key:"_handleColorEvent",value:function(e){var i=this;if(this._themeService){var n=Z(e),a;try{var l=function(){var h=a.value,c,d="";switch(h.index){case 256:c="foreground",d="10";break;case 257:c="background",d="11";break;case 258:c="cursor",d="12";break;default:c="ansi",d="4;"+h.index}switch(h.type){case 0:var _=ce.toColorRGB(c==="ansi"?i._themeService.colors.ansi[h.index]:i._themeService.colors[c]);i.coreService.triggerDataEvent("".concat(E.ESC,"]").concat(d,";").concat(ic(_)).concat(wi.ST));break;case 1:if(c==="ansi")i._themeService.modifyColors(function(f){var m;return f.ansi[h.index]=(m=me).toColor.apply(m,ae(h.color))});else{var v=c;i._themeService.modifyColors(function(f){var m;return f[v]=(m=me).toColor.apply(m,ae(h.color))})}break;case 2:i._themeService.restoreColor(h.index);break}};for(n.s();!(a=n.n()).done;)l()}catch(u){n.e(u)}finally{n.f()}}}},{key:"_setup",value:function(){V(K(r.prototype),"_setup",this).call(this),this._customKeyEventHandler=void 0}},{key:"buffer",get:function(){return this.buffers.active}},{key:"focus",value:function(){this.textarea&&this.textarea.focus({preventScroll:!0})}},{key:"_handleScreenReaderModeOptionChange",value:function(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(Or,this)):this._accessibilityManager.clear()}},{key:"_handleTextAreaFocus",value:function(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(E.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}},{key:"blur",value:function(){var e;return(e=this.textarea)===null||e===void 0?void 0:e.blur()}},{key:"_handleTextAreaBlur",value:function(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(E.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}},{key:"_syncTextArea",value:function(){if(!(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)){var e=this.buffer.ybase+this.buffer.y,i=this.buffer.lines.get(e);if(i){var n=Math.min(this.buffer.x,this.cols-1),a=this._renderService.dimensions.css.cell.height,l=i.getWidth(n),u=this._renderService.dimensions.css.cell.width*l,h=this.buffer.y*this._renderService.dimensions.css.cell.height,c=n*this._renderService.dimensions.css.cell.width;this.textarea.style.left=c+"px",this.textarea.style.top=h+"px",this.textarea.style.width=u+"px",this.textarea.style.height=a+"px",this.textarea.style.lineHeight=a+"px",this.textarea.style.zIndex="-5"}}}},{key:"_initGlobal",value:function(){var e=this;this._bindKeys(),this._register($(this.element,"copy",function(n){e.hasSelection()&&Ys(n,e._selectionService)}));var i=function(a){return Gs(a,e.textarea,e.coreService,e.optionsService)};this._register($(this.textarea,"paste",i)),this._register($(this.element,"paste",i)),ss?this._register($(this.element,"mousedown",function(n){n.button===2&&nn(n,e.textarea,e.screenElement,e._selectionService,e.options.rightClickSelectsWord)})):this._register($(this.element,"contextmenu",function(n){nn(n,e.textarea,e.screenElement,e._selectionService,e.options.rightClickSelectsWord)})),Ri&&this._register($(this.element,"auxclick",function(n){n.button===1&&rn(n,e.textarea,e.screenElement)}))}},{key:"_bindKeys",value:function(){var e=this;this._register($(this.textarea,"keyup",function(i){return e._keyUp(i)},!0)),this._register($(this.textarea,"keydown",function(i){return e._keyDown(i)},!0)),this._register($(this.textarea,"keypress",function(i){return e._keyPress(i)},!0)),this._register($(this.textarea,"compositionstart",function(){return e._compositionHelper.compositionstart()})),this._register($(this.textarea,"compositionupdate",function(i){return e._compositionHelper.compositionupdate(i)})),this._register($(this.textarea,"compositionend",function(){return e._compositionHelper.compositionend()})),this._register($(this.textarea,"input",function(i){return e._inputEvent(i)},!0)),this._register(this.onRender(function(){return e._compositionHelper.updateCompositionElements()}))}},{key:"open",value:function(e){var i,n=this,a,l;if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),(i=this.element)!==null&&i!==void 0&&i.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);var u=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),u.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register($(this.screenElement,"mousemove",function(d){return n.updateCursorStyle(d)})),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),u.appendChild(this.screenElement);var h=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",zr.get()),ls||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",function(){return h.readOnly=n.optionsService.rawOptions.disableStdin})),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(nl,this.textarea,(a=e.ownerDocument.defaultView)!==null&&a!==void 0?a:window,((l=this._document)!==null&&l!==void 0?l:(typeof window=="undefined"?"undefined":R(window))<"u")?window.document:null)),this._instantiationService.setService(tt,this._coreBrowserService),this._register($(this.textarea,"focus",function(d){return n._handleTextAreaFocus(d)})),this._register($(this.textarea,"blur",function(){return n._handleTextAreaBlur()})),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(Pi,this._document,this._helperContainer),this._instantiationService.setService(cr,this._charSizeService),this._themeService=this._instantiationService.createInstance(Oi),this._instantiationService.setService(Dt,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(xr),this._instantiationService.setService(un,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(Mi,this.rows,this.screenElement)),this._instantiationService.setService(rt,this._renderService),this._register(this._renderService.onRenderedViewportChange(function(d){return n._onRender.fire(d)})),this.onResize(function(d){return n._renderService.resize(d.cols,d.rows)}),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(Ci,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(Bi),this._instantiationService.setService(qr,this._mouseService);var c=this._linkifier.value=this._register(this._instantiationService.createInstance($i,this.screenElement));this.element.appendChild(u);try{this._onWillOpen.fire(this.element)}catch(d){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(function(){n._renderService.handleCursorMove(),n._syncTextArea()})),this._register(this.onResize(function(){return n._renderService.handleResize(n.cols,n.rows)})),this._register(this.onBlur(function(){return n._renderService.handleBlur()})),this._register(this.onFocus(function(){return n._renderService.handleFocus()})),this._viewport=this._register(this._instantiationService.createInstance(ki,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(function(d){V(K(r.prototype),"scrollLines",n).call(n,d,!1),n.refresh(0,n.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(Ti,this.element,this.screenElement,c)),this._instantiationService.setService(no,this._selectionService),this._register(this._selectionService.onRequestScrollLines(function(d){return n.scrollLines(d.amount,d.suppressScrollEvent)})),this._register(this._selectionService.onSelectionChange(function(){return n._onSelectionChange.fire()})),this._register(this._selectionService.onRequestRedraw(function(d){return n._renderService.handleSelectionChanged(d.start,d.end,d.columnSelectMode)})),this._register(this._selectionService.onLinuxMouseSelection(function(d){n.textarea.value=d,n.textarea.focus(),n.textarea.select()})),this._register(xe.any(this._onScroll.event,this._inputHandler.onScroll)(function(){var d;n._selectionService.refresh(),(d=n._viewport)===null||d===void 0||d.queueSync()})),this._register(this._instantiationService.createInstance(bi,this.screenElement)),this._register($(this.element,"mousedown",function(d){return n._selectionService.handleMouseDown(d)})),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(Or,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",function(d){return n._handleScreenReaderModeOptionChange(d)})),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Er,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",function(d){!n._overviewRulerRenderer&&d&&n._viewportElement&&n.screenElement&&(n._overviewRulerRenderer=n._register(n._instantiationService.createInstance(Er,n._viewportElement,n.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}},{key:"_createRenderer",value:function(){return this._instantiationService.createInstance(Di,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}},{key:"bindMouse",value:function(){var e=this,i=this,n=this.element;function a(h){var c,d,_=i._mouseService.getMouseReportCoords(h,i.screenElement);if(!_)return!1;var v,f;switch(h.overrideType||h.type){case"mousemove":f=32,h.buttons===void 0?(v=3,h.button!==void 0&&(v=h.button<3?h.button:3)):v=h.buttons&1?0:h.buttons&4?1:h.buttons&2?2:3;break;case"mouseup":f=0,v=h.button<3?h.button:3;break;case"mousedown":f=1,v=h.button<3?h.button:3;break;case"wheel":if(i._customWheelEventHandler&&i._customWheelEventHandler(h)===!1)return!1;var m=h.deltaY;if(m===0||i.coreMouseService.consumeWheelEvent(h,(c=i._renderService)===null||c===void 0||(c=c.dimensions)===null||c===void 0||(c=c.device)===null||c===void 0||(c=c.cell)===null||c===void 0?void 0:c.height,(d=i._coreBrowserService)===null||d===void 0?void 0:d.dpr)===0)return!1;f=m<0?0:1,v=4;break;default:return!1}return f===void 0||v===void 0||v>4?!1:i.coreMouseService.triggerMouseEvent({col:_.col,row:_.row,x:_.x,y:_.y,button:v,action:f,ctrl:h.ctrlKey,alt:h.altKey,shift:h.shiftKey})}var l={mouseup:null,wheel:null,mousedrag:null,mousemove:null},u={mouseup:function(c){return a(c),c.buttons||(e._document.removeEventListener("mouseup",l.mouseup),l.mousedrag&&e._document.removeEventListener("mousemove",l.mousedrag)),e.cancel(c)},wheel:function(c){return a(c),e.cancel(c,!0)},mousedrag:function(c){c.buttons&&a(c)},mousemove:function(c){c.buttons||a(c)}};this._register(this.coreMouseService.onProtocolChange(function(h){h?(e.optionsService.rawOptions.logLevel==="debug"&&e._logService.debug("Binding to mouse events:",e.coreMouseService.explainEvents(h)),e.element.classList.add("enable-mouse-events"),e._selectionService.disable()):(e._logService.debug("Unbinding from mouse events."),e.element.classList.remove("enable-mouse-events"),e._selectionService.enable()),h&8?l.mousemove||(n.addEventListener("mousemove",u.mousemove),l.mousemove=u.mousemove):(n.removeEventListener("mousemove",l.mousemove),l.mousemove=null),h&16?l.wheel||(n.addEventListener("wheel",u.wheel,{passive:!1}),l.wheel=u.wheel):(n.removeEventListener("wheel",l.wheel),l.wheel=null),h&2?l.mouseup||(l.mouseup=u.mouseup):(e._document.removeEventListener("mouseup",l.mouseup),l.mouseup=null),h&4?l.mousedrag||(l.mousedrag=u.mousedrag):(e._document.removeEventListener("mousemove",l.mousedrag),l.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register($(n,"mousedown",function(h){if(h.preventDefault(),e.focus(),!(!e.coreMouseService.areMouseEventsActive||e._selectionService.shouldForceSelection(h)))return a(h),l.mouseup&&e._document.addEventListener("mouseup",l.mouseup),l.mousedrag&&e._document.addEventListener("mousemove",l.mousedrag),e.cancel(h)})),this._register($(n,"wheel",function(h){if(!l.wheel){if(e._customWheelEventHandler&&e._customWheelEventHandler(h)===!1)return!1;if(!e.buffer.hasScrollback){var c,d;if(h.deltaY===0)return!1;if(i.coreMouseService.consumeWheelEvent(h,(c=i._renderService)===null||c===void 0||(c=c.dimensions)===null||c===void 0||(c=c.device)===null||c===void 0||(c=c.cell)===null||c===void 0?void 0:c.height,(d=i._coreBrowserService)===null||d===void 0?void 0:d.dpr)===0)return e.cancel(h,!0);var _=E.ESC+(e.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(h.deltaY<0?"A":"B");return e.coreService.triggerDataEvent(_,!0),e.cancel(h,!0)}}},{passive:!1}))}},{key:"refresh",value:function(e,i){var n;(n=this._renderService)===null||n===void 0||n.refreshRows(e,i)}},{key:"updateCursorStyle",value:function(e){var i;(i=this._selectionService)!==null&&i!==void 0&&i.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}},{key:"_showCursor",value:function(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}},{key:"scrollLines",value:function(e,i){this._viewport?this._viewport.scrollLines(e):V(K(r.prototype),"scrollLines",this).call(this,e,i),this.refresh(0,this.rows-1)}},{key:"scrollPages",value:function(e){this.scrollLines(e*(this.rows-1))}},{key:"scrollToTop",value:function(){this.scrollLines(-this._bufferService.buffer.ydisp)}},{key:"scrollToBottom",value:function(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}},{key:"scrollToLine",value:function(e){var i=e-this._bufferService.buffer.ydisp;i!==0&&this.scrollLines(i)}},{key:"paste",value:function(e){tn(e,this.textarea,this.coreService,this.optionsService)}},{key:"attachCustomKeyEventHandler",value:function(e){this._customKeyEventHandler=e}},{key:"attachCustomWheelEventHandler",value:function(e){this._customWheelEventHandler=e}},{key:"registerLinkProvider",value:function(e){return this._linkProviderService.registerLinkProvider(e)}},{key:"registerCharacterJoiner",value:function(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");var i=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),i}},{key:"deregisterCharacterJoiner",value:function(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}},{key:"markers",get:function(){return this.buffer.markers}},{key:"registerMarker",value:function(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}},{key:"registerDecoration",value:function(e){return this._decorationService.registerDecoration(e)}},{key:"hasSelection",value:function(){return this._selectionService?this._selectionService.hasSelection:!1}},{key:"select",value:function(e,i,n){this._selectionService.setSelection(e,i,n)}},{key:"getSelection",value:function(){return this._selectionService?this._selectionService.selectionText:""}},{key:"getSelectionPosition",value:function(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}},{key:"clearSelection",value:function(){var e;(e=this._selectionService)===null||e===void 0||e.clearSelection()}},{key:"selectAll",value:function(){var e;(e=this._selectionService)===null||e===void 0||e.selectAll()}},{key:"selectLines",value:function(e,i){var n;(n=this._selectionService)===null||n===void 0||n.selectLines(e,i)}},{key:"_keyDown",value:function(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;var i=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!i&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!i&&(e.key==="Dead"||e.key==="AltGraph")&&(this._unprocessedDeadKey=!0);var n=hc(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),n.type===3||n.type===2){var a=this.rows-1;return this.scrollLines(n.type===2?-a:a),this.cancel(e,!0)}if(n.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,e)||(n.cancel&&this.cancel(e,!0),!n.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key.length===1&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((n.key===E.ETX||n.key===E.CR)&&(this.textarea.value=""),this._onKey.fire({key:n.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(n.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)return this.cancel(e,!0);this._keyDownHandled=!0}},{key:"_isThirdLevelShift",value:function(e,i){var n=e.isMac&&!this.options.macOptionIsMeta&&i.altKey&&!i.ctrlKey&&!i.metaKey||e.isWindows&&i.altKey&&i.ctrlKey&&!i.metaKey||e.isWindows&&i.getModifierState("AltGraph");return i.type==="keypress"?n:n&&(!i.keyCode||i.keyCode>47)}},{key:"_keyUp",value:function(e){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)&&(yc(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}},{key:"_keyPress",value:function(e){var i;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;if(this.cancel(e),e.charCode)i=e.charCode;else if(e.which===null||e.which===void 0)i=e.keyCode;else if(e.which!==0&&e.charCode!==0)i=e.which;else return!1;return!i||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)?!1:(i=String.fromCharCode(i),this._onKey.fire({key:i,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(i,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}},{key:"_inputEvent",value:function(e){if(e.data&&e.inputType==="insertText"&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;var i=e.data;return this.coreService.triggerDataEvent(i,!0),this.cancel(e),!0}return!1}},{key:"resize",value:function(e,i){if(e===this.cols&&i===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}V(K(r.prototype),"resize",this).call(this,e,i)}},{key:"_afterResize",value:function(e,i){var n;(n=this._charSizeService)===null||n===void 0||n.measure()}},{key:"clear",value:function(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(var e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(ke));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}},{key:"reset",value:function(){var e;this.options.rows=this.rows,this.options.cols=this.cols;var i=this._customKeyEventHandler;this._setup(),V(K(r.prototype),"reset",this).call(this),(e=this._selectionService)!==null&&e!==void 0&&e.reset(),this._decorationService.reset(),this._customKeyEventHandler=i,this.refresh(0,this.rows-1)}},{key:"clearTextureAtlas",value:function(){var e;(e=this._renderService)===null||e===void 0||e.clearTextureAtlas()}},{key:"_reportFocus",value:function(){var e;(e=this.element)!==null&&e!==void 0&&e.classList.contains("focus")?this.coreService.triggerDataEvent(E.ESC+"[I"):this.coreService.triggerDataEvent(E.ESC+"[O")}},{key:"_reportWindowsOptions",value:function(e){if(this._renderService)switch(e){case 0:var i=this._renderService.dimensions.css.canvas.width.toFixed(0),n=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent("".concat(E.ESC,"[4;").concat(n,";").concat(i,"t"));break;case 1:var a=this._renderService.dimensions.css.cell.width.toFixed(0),l=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent("".concat(E.ESC,"[6;").concat(l,";").concat(a,"t"));break}}},{key:"cancel",value:function(e,i){if(!(!this.options.cancelEvents&&!i))return e.preventDefault(),e.stopPropagation(),!1}}]),r}(cc);function yc(s){return s.keyCode===16||s.keyCode===17||s.keyCode===18}var Sc=function(){function s(){S(this,s),this._addons=[]}return k(s,[{key:"dispose",value:function(){for(var r=this._addons.length-1;r>=0;r--)this._addons[r].instance.dispose()}},{key:"loadAddon",value:function(r,t){var e=this,i={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(i),t.dispose=function(){return e._wrappedAddonDispose(i)},t.activate(r)}},{key:"_wrappedAddonDispose",value:function(r){if(!r.isDisposed){for(var t=-1,e=0;e<this._addons.length;e++)if(this._addons[e]===r){t=e;break}if(t===-1)throw new Error("Could not dispose an addon that has not been loaded");r.isDisposed=!0,r.dispose.apply(r.instance),this._addons.splice(t,1)}}}]),s}(),kc=function(){function s(o){S(this,s),this._line=o}return k(s,[{key:"isWrapped",get:function(){return this._line.isWrapped}},{key:"length",get:function(){return this._line.length}},{key:"getCell",value:function(r,t){if(!(r<0||r>=this._line.length))return t?(this._line.loadCell(r,t),t):this._line.loadCell(r,new ze)}},{key:"translateToString",value:function(r,t,e){return this._line.translateToString(r,t,e)}}]),s}(),zs=function(){function s(o,r){S(this,s),this._buffer=o,this.type=r}return k(s,[{key:"init",value:function(r){return this._buffer=r,this}},{key:"cursorY",get:function(){return this._buffer.y}},{key:"cursorX",get:function(){return this._buffer.x}},{key:"viewportY",get:function(){return this._buffer.ydisp}},{key:"baseY",get:function(){return this._buffer.ybase}},{key:"length",get:function(){return this._buffer.lines.length}},{key:"getLine",value:function(r){var t=this._buffer.lines.get(r);if(t)return new kc(t)}},{key:"getNullCell",value:function(){return new ze}}]),s}(),bc=function(s){z(r,s);var o=U(r);function r(t){var e;return S(this,r),e=o.call(this),e._core=t,e._onBufferChange=e._register(new M),e.onBufferChange=e._onBufferChange.event,e._normal=new zs(e._core.buffers.normal,"normal"),e._alternate=new zs(e._core.buffers.alt,"alternate"),e._core.buffers.onBufferActivate(function(){return e._onBufferChange.fire(e.active)}),e}return k(r,[{key:"active",get:function(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}},{key:"normal",get:function(){return this._normal.init(this._core.buffers.normal)}},{key:"alternate",get:function(){return this._alternate.init(this._core.buffers.alt)}}]),r}(G),wc=function(){function s(o){S(this,s),this._core=o}return k(s,[{key:"registerCsiHandler",value:function(r,t){return this._core.registerCsiHandler(r,function(e){return t(e.toArray())})}},{key:"addCsiHandler",value:function(r,t){return this.registerCsiHandler(r,t)}},{key:"registerDcsHandler",value:function(r,t){return this._core.registerDcsHandler(r,function(e,i){return t(e,i.toArray())})}},{key:"addDcsHandler",value:function(r,t){return this.registerDcsHandler(r,t)}},{key:"registerEscHandler",value:function(r,t){return this._core.registerEscHandler(r,t)}},{key:"addEscHandler",value:function(r,t){return this.registerEscHandler(r,t)}},{key:"registerOscHandler",value:function(r,t){return this._core.registerOscHandler(r,t)}},{key:"addOscHandler",value:function(r,t){return this.registerOscHandler(r,t)}}]),s}(),Cc=function(){function s(o){S(this,s),this._core=o}return k(s,[{key:"register",value:function(r){this._core.unicodeService.register(r)}},{key:"versions",get:function(){return this._core.unicodeService.versions}},{key:"activeVersion",get:function(){return this._core.unicodeService.activeVersion},set:function(r){this._core.unicodeService.activeVersion=r}}]),s}(),Ec=["cols","rows"],Qe=0,xc=function(s){z(r,s);var o=U(r);function r(t){var e;S(this,r),e=o.call(this),e._core=e._register(new mc(t)),e._addonManager=e._register(new Sc),e._publicOptions=J({},e._core.options);var i=function(h){return e._core.options[h]},n=function(h,c){e._checkReadonlyOptions(h),e._core.options[h]=c};for(var a in e._core.options){var l={get:i.bind(Ie(e),a),set:n.bind(Ie(e),a)};Object.defineProperty(e._publicOptions,a,l)}return e}return k(r,[{key:"_checkReadonlyOptions",value:function(e){if(Ec.includes(e))throw new Error('Option "'.concat(e,'" can only be set in the constructor'))}},{key:"_checkProposedApi",value:function(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}},{key:"onBell",get:function(){return this._core.onBell}},{key:"onBinary",get:function(){return this._core.onBinary}},{key:"onCursorMove",get:function(){return this._core.onCursorMove}},{key:"onData",get:function(){return this._core.onData}},{key:"onKey",get:function(){return this._core.onKey}},{key:"onLineFeed",get:function(){return this._core.onLineFeed}},{key:"onRender",get:function(){return this._core.onRender}},{key:"onResize",get:function(){return this._core.onResize}},{key:"onScroll",get:function(){return this._core.onScroll}},{key:"onSelectionChange",get:function(){return this._core.onSelectionChange}},{key:"onTitleChange",get:function(){return this._core.onTitleChange}},{key:"onWriteParsed",get:function(){return this._core.onWriteParsed}},{key:"element",get:function(){return this._core.element}},{key:"parser",get:function(){return this._parser||(this._parser=new wc(this._core)),this._parser}},{key:"unicode",get:function(){return this._checkProposedApi(),new Cc(this._core)}},{key:"textarea",get:function(){return this._core.textarea}},{key:"rows",get:function(){return this._core.rows}},{key:"cols",get:function(){return this._core.cols}},{key:"buffer",get:function(){return this._buffer||(this._buffer=this._register(new bc(this._core))),this._buffer}},{key:"markers",get:function(){return this._checkProposedApi(),this._core.markers}},{key:"modes",get:function(){var e=this._core.coreService.decPrivateModes,i="none";switch(this._core.coreMouseService.activeProtocol){case"X10":i="x10";break;case"VT200":i="vt200";break;case"DRAG":i="drag";break;case"ANY":i="any";break}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:i,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}},{key:"options",get:function(){return this._publicOptions},set:function(e){for(var i in e)this._publicOptions[i]=e[i]}},{key:"blur",value:function(){this._core.blur()}},{key:"focus",value:function(){this._core.focus()}},{key:"input",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;this._core.input(e,i)}},{key:"resize",value:function(e,i){this._verifyIntegers(e,i),this._core.resize(e,i)}},{key:"open",value:function(e){this._core.open(e)}},{key:"attachCustomKeyEventHandler",value:function(e){this._core.attachCustomKeyEventHandler(e)}},{key:"attachCustomWheelEventHandler",value:function(e){this._core.attachCustomWheelEventHandler(e)}},{key:"registerLinkProvider",value:function(e){return this._core.registerLinkProvider(e)}},{key:"registerCharacterJoiner",value:function(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}},{key:"deregisterCharacterJoiner",value:function(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}},{key:"registerMarker",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this._verifyIntegers(e),this._core.registerMarker(e)}},{key:"registerDecoration",value:function(e){var i,n,a;return this._checkProposedApi(),this._verifyPositiveIntegers((i=e.x)!==null&&i!==void 0?i:0,(n=e.width)!==null&&n!==void 0?n:0,(a=e.height)!==null&&a!==void 0?a:0),this._core.registerDecoration(e)}},{key:"hasSelection",value:function(){return this._core.hasSelection()}},{key:"select",value:function(e,i,n){this._verifyIntegers(e,i,n),this._core.select(e,i,n)}},{key:"getSelection",value:function(){return this._core.getSelection()}},{key:"getSelectionPosition",value:function(){return this._core.getSelectionPosition()}},{key:"clearSelection",value:function(){this._core.clearSelection()}},{key:"selectAll",value:function(){this._core.selectAll()}},{key:"selectLines",value:function(e,i){this._verifyIntegers(e,i),this._core.selectLines(e,i)}},{key:"dispose",value:function(){V(K(r.prototype),"dispose",this).call(this)}},{key:"scrollLines",value:function(e){this._verifyIntegers(e),this._core.scrollLines(e)}},{key:"scrollPages",value:function(e){this._verifyIntegers(e),this._core.scrollPages(e)}},{key:"scrollToTop",value:function(){this._core.scrollToTop()}},{key:"scrollToBottom",value:function(){this._core.scrollToBottom()}},{key:"scrollToLine",value:function(e){this._verifyIntegers(e),this._core.scrollToLine(e)}},{key:"clear",value:function(){this._core.clear()}},{key:"write",value:function(e,i){this._core.write(e,i)}},{key:"writeln",value:function(e,i){this._core.write(e),this._core.write(`\r
`,i)}},{key:"paste",value:function(e){this._core.paste(e)}},{key:"refresh",value:function(e,i){this._verifyIntegers(e,i),this._core.refresh(e,i)}},{key:"reset",value:function(){this._core.reset()}},{key:"clearTextureAtlas",value:function(){this._core.clearTextureAtlas()}},{key:"loadAddon",value:function(e){this._addonManager.loadAddon(this,e)}},{key:"_verifyIntegers",value:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];for(var a=0,l=i;a<l.length;a++)if(Qe=l[a],Qe===1/0||isNaN(Qe)||Qe%1!==0)throw new Error("This API only accepts integers")}},{key:"_verifyPositiveIntegers",value:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];for(var a=0,l=i;a<l.length;a++)if(Qe=l[a],Qe&&(Qe===1/0||isNaN(Qe)||Qe%1!==0||Qe<0))throw new Error("This API only accepts positive integers")}}],[{key:"strings",get:function(){return{get promptLabel(){return zr.get()},set promptLabel(e){zr.set(e)},get tooMuchOutput(){return Ur.get()},set tooMuchOutput(e){Ur.set(e)}}}}]),r}(G)}}]);
